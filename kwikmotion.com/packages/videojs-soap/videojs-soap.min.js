/*! @name videojs-soap @version 0.0.1 @license MIT */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("video.js")):"function"==typeof define&&define.amd?define(["video.js"],t):e.videojsSoap=t(e.videojs)}(this,function(e){"use strict";e=e&&e.hasOwnProperty("default")?e.default:e;var t=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},s=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)},o=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t},i=function(e){function i(){return t(this,i),o(this,e.apply(this,arguments))}return s(i,e),i}(videojs.getComponent("Menu")),n='<svg viewBox="0 0 1792 1792" xmlns="http://www.w3.org/2000/svg"><path d="M1363 877l-742 742q-19 19-45 19t-45-19l-166-166q-19-19-19-45t19-45l531-531-531-531q-19-19-19-45t19-45L531 45q19-19 45-19t45 19l742 742q19 19 19 45t-19 45z"/></svg>';var a=function(e){function i(){return t(this,i),o(this,e.apply(this,arguments))}return s(i,e),i.prototype.handleClick=function(e){var t,s,o,a,r,l,p=this,d=this.player().getChild("ControlBar").getChild("soap").menu;if(this.options_.mainmenu){for(d.lockShowing(),d.el().classList.remove("vjs-soap-menu-select"),d.el().querySelector(".vjs-episodes-list.active")&&d.el().querySelector(".vjs-episodes-list.active").classList.remove("active");d.children_.length;){var c=d.children_.shift();d.removeChild(c),c.dispose()}d.player().getChild("ControlBar").getChild("soap").createMenu()}else if(this.options_.episodes){for(d.el().classList.add("vjs-episodes-list");d.children_.length;){var u=d.children_.shift();d.removeChild(u),u.dispose()}d.el().classList.add("vjs-soap-menu-select");var h={name:"seasonstitle",label:'<span class="left-arrow">'+n+"</span>"+d.options_.title+' <span class="addon-title">'+this.options_.controlText+"</span>",className:"vjs-seasons-title",selectable:!1,mainmenu:!0},f=new i(d.player(),h);if(d.addItem(f),this.options_.episodes&&this.options_.episodes.length)for(var v=function(e){var t="episode_"+p.options_.episodes[e].season+"_"+e,s="episode_"+p.options_.episodes[e].season;h={label:'<input type="radio" name="'+s+'" id="'+t+'"><label for="'+t+'" class="vjs-episode-title">'+p.options_.episodes[e].title+'<span class="up-arrow">'+n+'</span></label><a class="vjs-episode-description" target="_blank" href="'+p.options_.episodes[e].url+'"><img src="'+p.options_.episodes[e].image+'"/>'+p.options_.episodes[e].description+"</a>",selectable:!0,className:"vjs-episode-item"};var o,a=new i(d.player(),h);o=p.options_.episodes[e].url,a.el().querySelector(".vjs-episode-description").addEventListener("touchstart",function(){window.top.location.href=o}),d.addItem(a)},m=0;m<this.options_.episodes.length;m++)v(m);d.lockShowing()}else if(e.target.href||e.target.parentNode&&e.target.parentNode.href)window.top.location.href=e.target.href?e.target.href:e.target.parentNode.href;else if(this.el()){var g=this.el().querySelector('input[type="radio"]');g&&(g.checked=!g.checked,t=d.el(),s=this.el().querySelector(".vjs-episode-description"),o=t.scrollTop,a=o+t.clientHeight,r=s.offsetTop,l=r+s.clientHeight,r<o?t.scrollTop-=o-r:l>a&&(t.scrollTop+=l-a))}return!0},i.prototype.createEl=function(t,s,o){var i=e.prototype.createEl.call(this,t,s,o);return this.options_.className&&i.classList.add(this.options_.className),i},i}(videojs.getComponent("MenuItem")),r='<svg version="1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 116 89"><path d="M43 22.5V27h-9v9H22v40h50V65h12V55h8V18H43v4.5zM83 38c0 10.3-.1 11-2 11s-2-.7-2-9v-9H64c-14.3 0-15-.1-15-2s.7-2 17-2h17v11zm-8 8.5V58h-6V39H55c-13.3 0-14-.1-14-2s.7-2 17-2h17v11.5zm-10 10V69H31V44h34v12.5z"/></svg>',l=function(e){function l(s,i){t(this,l);var n=o(this,e.call(this,s,i));return n.el().querySelector("button").insertAdjacentHTML("afterbegin",'<div class="vjs-soap-ico">'+r+"</div>"),n}return s(l,e),l.prototype.createMenu=function(){var e,t,s=this.menu?this.menu:new i(this.player(),this.options_);this.options_.title&&""!=this.options_.title&&(t={name:"seasonstitle",label:'<span class="left-arrow">'+n+"</span>"+this.options_.title+' <span class="addon-title"></span>',className:"vjs-seasons-title",selectable:!1,mainmenu:!0},e=new a(this.player(),t),s.addItem(e));for(var o=this.options_.seasons.firstChild;o;){if(1===o.nodeType&&o.nodeName&&o.nodeName.match(/(\d+)/i)){for(var r=RegExp.$1,l=o.nodeName,p=[],d=o.firstChild;d;){if(d.nodeName&&d.nodeName.match(/^episode(\d+)/i)){for(var c={season:r,id:RegExp.$1},u=d.querySelectorAll("title,image,description,url"),h=0;h<u.length;h++)c[u[h].nodeName]=u[h].innerHTML;p.push(c)}d=d.nextSibling}t={label:"<span>"+l+'</span><span class="right-arrow">'+n+"</span>",selectable:!0,episodes:p,className:"vjs-soap-seasons",controlText:l},e=new a(this.player(),t),s.addItem(e)}o=o.nextSibling}return s},l.prototype.createEl=function(){var t=e.prototype.createEl.call(this);return t.classList.add("vjs-soap-button"),t},l.prototype.buildCSSClass=function(){return"vjs-icon-soap"},l}(videojs.getComponent("MenuButton")),p={},d=function(i){function n(s,a){t(this,n);var r=o(this,i.call(this,s));return r.options=e.mergeOptions(p,a),r.buildMenu=function(t,o,i){if(t)return e.log.error(t);var n=s.controlBar.getChild("soap");if(n&&(n.dispose(),s.controlBar.removeChild(n)),i&&i.childNodes&&i.childNodes.length){var a=i.evaluate("//title[1]",i,null,XPathResult.FIRST_ORDERED_NODE_TYPE,null),r=i.evaluate("//playlist[1]/seasons[1]",i,null,XPathResult.FIRST_ORDERED_NODE_TYPE,null);r.singleNodeValue&&(n=new l(s,{name:"soap",title:a?a.singleNodeValue.innerHTML:"",seasons:r.singleNodeValue}),s.controlBar.addChild(n))}},a.url&&e.xhr({uri:a.url,responseType:"document"},r.buildMenu.bind(r)),r.player.ready(function(){r.player.addClass("vjs-soap")}),r}return s(n,i),n}(e.getPlugin("plugin"));return d.defaultState={},d.VERSION="0.0.1",e.registerPlugin("soap",d),d});
