/*! @name videojs-soap @version 0.0.2 @license MIT */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("video.js")):"function"==typeof define&&define.amd?define(["video.js"],t):e.videojsSoap=t(e.videojs)}(this,function(e){"use strict";e=e&&e.hasOwnProperty("default")?e.default:e;var t=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},s=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)},i=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t},o=function(e){function o(){return t(this,o),i(this,e.apply(this,arguments))}return s(o,e),o}(videojs.getComponent("Menu")),n='<svg xmlns="http://www.w3.org/2000/svg" width="8" height="4" viewBox="0 0 8 4"><g><g><path fill="#fff" d="M4 4L0 0h8z"/></g></g></svg>';var r=function(e){function o(){return t(this,o),i(this,e.apply(this,arguments))}return s(o,e),o.prototype.handleClick=function(e){var t,s,i,o,n,r,l=this.player().getChild("ControlBar").getChild("soap").menu;if(this.options_.mainmenu){for(l.lockShowing(),l.el().classList.remove("vjs-soap-menu-select"),l.el().querySelector(".vjs-episodes-list.active")&&l.el().querySelector(".vjs-episodes-list.active").classList.remove("active");l.children_.length;){var a=l.children_.shift();l.removeChild(a),a.dispose()}l.player().getChild("ControlBar").getChild("soap").createSeasonsMenu()}else if(this.options_.episodes){for(l.el().classList.add("vjs-episodes-list");l.children_.length;){var d=l.children_.shift();l.removeChild(d),d.dispose()}l.el().classList.add("vjs-soap-menu-select"),l.player().getChild("ControlBar").getChild("soap").createEpisodesMenu(l,this.options_),l.lockShowing()}else if(e.target.href||e.target.parentNode&&e.target.parentNode.href)window.top.location.href=e.target.href?e.target.href:e.target.parentNode.href;else if(this.el()){var p=this.el().querySelector('input[type="radio"]');p&&(p.checked=!p.checked,t=l.el(),s=this.el().querySelector(".vjs-episode-description"),i=t.scrollTop,o=i+t.clientHeight,n=s.offsetTop,r=n+s.clientHeight,n<i?t.scrollTop-=i-n:r>o&&(t.scrollTop+=r-o))}return!0},o.prototype.createEl=function(t,s,i){var o=e.prototype.createEl.call(this,t,s,i);return this.options_.className&&o.classList.add(this.options_.className),o},o}(videojs.getComponent("MenuItem")),l='<svg version="1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 116 89"><path d="M43 22.5V27h-9v9H22v40h50V65h12V55h8V18H43v4.5zM83 38c0 10.3-.1 11-2 11s-2-.7-2-9v-9H64c-14.3 0-15-.1-15-2s.7-2 17-2h17v11zm-8 8.5V58h-6V39H55c-13.3 0-14-.1-14-2s.7-2 17-2h17v11.5zm-10 10V69H31V44h34v12.5z"/></svg>',a=function(e){function a(s,o){t(this,a);var n=i(this,e.call(this,s,o));return n.el().querySelector("button").insertAdjacentHTML("afterbegin",'<div class="vjs-soap-ico">'+l+"</div>"),n}return s(a,e),a.prototype.createMenu=function(){for(var e=this.options_.seasons.firstChild,t=!1;e;)if(1===e.nodeType&&e.nodeName&&e.nodeName.match(/(\d+)/i)){for(var s=e.firstChild;s;){if(s.nodeName&&s.nodeName.match(/^episode(\d+)/i)){var i=s.querySelector("url");if(i=i.firstChild.data,decodeURI(window.location.href).includes(decodeURI(i))){t=e;break}}s=s.nextSibling}if(t)break;e=e.nextSibling}else e=e.nextSibling;var r=!!t;if(!t)for(e=this.options_.seasons.firstChild;e;){if(1===e.nodeType&&e.nodeName&&e.nodeName.match(/(\d+)/i)){t=e;break}e=e.nextSibling}var l,a=this.menu?this.menu:new o(this.player(),this.options_),d=RegExp.$1,p=t.nodeName,c=[];for(s=t.firstChild;s;){if(s.nodeName&&s.nodeName.match(/^episode(\d+)/i)){for(var u={season:d,id:RegExp.$1},h=s.querySelectorAll("title,image,description,url"),f=0;f<h.length;f++)u[h[f].nodeName]=h[f].firstChild.data;c.push(u)}s=s.nextSibling}return l={label:n+p,selectable:!0,episodes:c,currentExists:r,className:"vjs-soap-seasons",controlText:p,designStudio:this.options_.designStudio},this.createEpisodesMenu(a,l),a},a.prototype.createSeasonsMenu=function(){var e,t,s=this.menu?this.menu:new o(this.player(),this.options_);this.options_.title&&""!=this.options_.title&&(t={name:"seasonstitle",label:this.options_.title,className:"vjs-seasons-title",selectable:!1,mainmenu:!0},(e=new r(this.player(),t)).el().style="border-color: "+this.options_.designStudio.highlight,s.addItem(e));for(var i=this.options_.seasons.firstChild;i;){if(1===i.nodeType&&i.nodeName&&i.nodeName.match(/(\d+)/i)){for(var l=RegExp.$1,a=i.nodeName,d=[],p=i.firstChild;p;){if(p.nodeName&&p.nodeName.match(/^episode(\d+)/i)){for(var c={season:l,id:RegExp.$1},u=p.querySelectorAll("title,image,description,url"),h=0;h<u.length;h++)c[u[h].nodeName]=u[h].firstChild.data;d.push(c)}p=p.nextSibling}t={label:n+a,selectable:!0,episodes:d,className:"vjs-soap-seasons",controlText:a,designStudio:this.options_.designStudio},e=new r(this.player(),t),s.addItem(e)}i=i.nextSibling}return s},a.prototype.createEpisodesMenu=function(e,t){if(t){e.el().classList.add("vjs-episodes-list"),e.el().classList.add("vjs-soap-menu-select");var s={name:"seasonstitle",label:n+t.controlText,className:"vjs-seasons-title",selectable:!0,mainmenu:!0},i=new r(e.player(),s);if(i.el().style="cursor: pointer; border-color: "+t.designStudio.highlight,e.addItem(i),t.episodes&&t.episodes.length)for(var o=function(s){var i="episode_"+t.episodes[s].season+"_"+s,o="episode_"+t.episodes[s].season,n="";(decodeURI(window.location.href).includes(decodeURI(t.episodes[s].url))||!t.currentExists&&0===s)&&(n='checked="checked"');var l="";t.episodes[s].description&&(l="max-width:100px");var a,d={label:'<input type="radio" name="'+o+'" id="'+i+'" '+n+'"><label for="'+i+'" class="vjs-episode-title">'+t.episodes[s].title+'</label><a class="vjs-episode-description" target="_blank" href="'+t.episodes[s].url+'"><span>'+t.episodes[s].description+'</span><img src="'+t.episodes[s].image+'" style="'+l+'"/></a>',selectable:!0,className:"vjs-episode-item"},p=new r(e.player(),d);a=t.episodes[s].url,p.el().querySelector(".vjs-episode-description").addEventListener("touchstart",function(){window.top.location.href=a}),e.addItem(p)},l=0;l<t.episodes.length;l++)o(l)}},a.prototype.createEl=function(){var t=e.prototype.createEl.call(this);return t.classList.add("vjs-soap-button"),t},a.prototype.buildCSSClass=function(){return"vjs-icon-soap"},a}(videojs.getComponent("MenuButton")),d=e.getPlugin("plugin"),p={},c=function(o){function n(s,r){t(this,n);var l=i(this,o.call(this,s));return l.options=e.mergeOptions(p,r),l.buildMenu=function(t,i,o){if(t)return e.log.error(t);var n=s.controlBar.getChild("soap");if(n&&(n.dispose(),s.controlBar.removeChild(n)),o&&o.childNodes&&o.childNodes.length){var l=o.evaluate("//title[1]",o,null,XPathResult.FIRST_ORDERED_NODE_TYPE,null),d=o.evaluate("//playlist[1]/seasons[1]",o,null,XPathResult.FIRST_ORDERED_NODE_TYPE,null);d.singleNodeValue&&(n=new a(s,{name:"soap",title:l&&l.singleNodeValue?l.singleNodeValue.firstChild.data:"",seasons:d.singleNodeValue,designStudio:r.designStudio}),s.controlBar.addChild(n))}},r.url&&e.xhr({uri:r.url,responseType:"document"},l.buildMenu.bind(l)),l.player.ready(function(){l.player.addClass("vjs-soap")}),l}return s(n,o),n}(d);return c.defaultState={},c.VERSION="0.0.1",e.registerPlugin("soap",c),c});
