/*! @name videojs-imadai @version 0.0.1 @license Apache-2.0 */
"use strict";!function(e,a){"object"==typeof exports&&"undefined"!=typeof module?module.exports=a(require("video.js")):"function"==typeof define&&define.amd?define(["video.js"],a):e.videojsImaDaiPlugin=a(e.videojs)}(this,function(e){e=e&&e.hasOwnProperty("default")?e.default:e;var a=function(e,a){if(!(e instanceof a))throw new TypeError("Cannot call a class as a function")},t=function(e,a){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!a||"object"!=typeof a&&"function"!=typeof a?e:a},i=function(e){function i(o,n){a(this,i);var r=t(this,e.call(this,o)),s=!(void 0===n.live||!n.live);s=b({live:n.live});var d,l,c,u=b({urlJump:n.urlJump}),p=b({backupStream:n.backupStream}),m=b({apiKey:n.apiKey});s?d=b({assetKey:n.assetKey}):(l=b({cmsId:n.cmsId}),c=b({videoId:n.videoId})),o.options().imadai=Object.assign({},o.options().imadai,{live:s},{urlJump:u},{backupStream:p},{apiKey:m},{assetKey:d},{cmsId:l},{videoId:c}),I(Object.assign({},{str:"Configured with params: ",obj:o.options().imadai}));var v,g=o.el().querySelector("video");g?f():g.addEventListener("load",f);var y=bowser.ios||bowser.safari||bowser.mac;function f(){var e;v=function(){if(u){var e=document.getElementById(n.outerId),a=document.createElement("DIV"),t="daiWrapper";a.id=t,a.style.position="relative",e.appendChild(a);var i=(a=document.getElementById(t)).previousSibling;a.style.width="100%",a.style.height=e.offsetHeight+"px",i.style.position="absolute",a.appendChild(i),t="daiClickElement";var o=document.createElement("DIV");return o.id=t,o.style.display="none",o.style.width="100%",o.style.height=e.offsetHeight+"px",o.style.cursor="pointer",o.style.position="absolute",a.appendChild(o),document.getElementById(t)}return null}(),function(){r.streamManager=new google.ima.dai.api.StreamManager(g),r.streamManager.setClickElement(v),r.streamManager.addEventListener([google.ima.dai.api.StreamEvent.Type.LOADED,google.ima.dai.api.StreamEvent.Type.ERROR,google.ima.dai.api.StreamEvent.Type.AD_BREAK_STARTED,google.ima.dai.api.StreamEvent.Type.AD_BREAK_ENDED,google.ima.dai.api.StreamEvent.Type.CLICK,google.ima.dai.api.StreamEvent.Type.STARTED],S,!1),y||o.tech_.on("hlsManifestParsed",function(e,a){r.streamManager&&a&&a.samples.forEach(function(e){r.streamManager.processMetadata("ID3",e.data,e.pts)})});r.daiAdIsPlaying=!1,I("Initialized.")}(),s?function(){var e=new google.ima.dai.api.LiveStreamRequest;e.assetKey=d,e.apiKey=m,r.streamManager.requestStream(e)}():((e=new google.ima.dai.api.VODStreamRequest).contentSourceId=l,e.videoId=c,e.apiKey=m,r.streamManager.requestStream(e))}function E(){var e="http://storage.googleapis.com/testtopbox-public/video_content/bbb/master.m3u8",a={live:!1,backupStream:e,apiKey:"",urlJump:!0,required:{cmsId:"2528370",videoId:"tears-of-steel"}},t={backupStream:e,apiKey:"",urlJump:!0,required:{live:!0,assetKey:"sN_IYUG8STe1ZzhIIE_ksA"}};return Object.assign({},{vodFields:a},{liveFields:t})}function b(e){var a=Object.keys(e)[0],t=e[a];if(void 0!==t&&""!==t)return t;if(n.mode&&"test"===n.mode)return s?void 0!==E().liveFields[a]?E().liveFields[a]:E().liveFields.required[a]:void 0!==E().vodFields[a]?E().vodFields[a]:E().vodFields.required[a];var i=s?E().liveFields[a]:E().vodFields[a];return void 0!==i?i:(k("Necessary data was not provided: ".concat(a)),null)}function S(e){switch(e.type){case google.ima.dai.api.StreamEvent.Type.LOADED:I("Stream loaded."),function(e){var a=e.url;I("Loading: "+a),o.src(a),y&&g.textTracks.addEventListener("addtrack",h);I("Video is Ready to Play...")}(e.getStreamData());break;case google.ima.dai.api.StreamEvent.Type.ERROR:k("Error loading stream, playing backup stream: ".concat(s?E().liveFields.backupStream:E().vodFields.backupStream)),o.controls(!0),v&&(v.style.display="none"),r.daiAdIsPlaying=!1,o.src(p);break;case google.ima.dai.api.StreamEvent.Type.AD_BREAK_STARTED:o.one("timeupdate",function(){I("Ad Break Started"),o.controls(!1),v&&(v.style.display="block"),r.daiAdIsPlaying=!0});break;case google.ima.dai.api.StreamEvent.Type.AD_BREAK_ENDED:I("Ad Break Ended"),o.controls(!0),v&&(v.style.display="none"),r.daiAdIsPlaying=!1;break;case google.ima.dai.api.StreamEvent.Type.CLICK:I("URL jump!");break;case google.ima.dai.api.StreamEvent.Type.STARTED:}}function h(e){var a=e.track;"metadata"===a.kind&&(a.mode="hidden",a.addEventListener("cuechange",function(){for(var e in a.activeCues){var t={};t[e.value.key]=e.value.data,r.streamManager.onTimedMetadata(t)}}))}function I(e){var a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"orange";function t(e){console.log("%c[DAI] ".concat(e),"color:".concat(a,"; font-weight: bold"))}n.debug&&("string"==typeof e?t(e):(t(e.str),console.log(e.obj)))}function k(e){console.error("[DAI] ".concat(e))}return r}return function(e,a){if("function"!=typeof a&&null!==a)throw new TypeError("Super expression must either be null or a function, not "+typeof a);e.prototype=Object.create(a&&a.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),a&&(Object.setPrototypeOf?Object.setPrototypeOf(e,a):e.__proto__=a)}(i,e),i}(e.getPlugin("plugin"));return i.VERSION="0.0.1",e.registerPlugin("imadai",i),i});
