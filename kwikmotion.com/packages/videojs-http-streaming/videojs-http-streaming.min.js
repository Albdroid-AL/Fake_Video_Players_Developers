(function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("video.js")):"function"==typeof define&&define.amd?define(["exports","video.js"],t):t(e.videojsHttpStreaming={},e.videojs)})(this,function(e,t){'use strict';function a(){return a=Object.assign||function(e){for(var t=1,a;t<arguments.length;t++)for(var n in a=arguments[t],a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n]);return e},a.apply(this,arguments)}function i(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e.__proto__=t}function n(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function r(e){for(var t=h.atob(e||""),a=new Uint8Array(t.length),n=0;n<t.length;n++)a[n]=t.charCodeAt(n);return a}function s(e){return e.subarray(0,e.byteLength-e[e.byteLength-1])}function d(e,t){return function(a){var i=this;if(!t)return new dt(e);if(dt&&!a){var n=t.toString().replace(/^function.+?{/,"").slice(0,-1),r=o(n);return this[nt]=new dt(r),l(this[nt],r),this[nt]}var s={postMessage:function(e){i.onmessage&&setTimeout(function(){i.onmessage({data:e,target:s})})}};t.call(s),this.postMessage=function(e){setTimeout(function(){s.onmessage({data:e,target:i})})},this.isThisThread=!0}}function o(t){try{return st.createObjectURL(new Blob([t],{type:"application/javascript"}))}catch(i){var a=new rt;return a.append(t),st.createObjectURL(a.getBlob(type))}}function l(e,t){if(e&&t){var a=e.terminate;e.objURL=t,e.terminate=function(){e.objURL&&st.revokeObjectURL(e.objURL),a.call(e)}}}function u(e){for(var t=h.atob(e),a=new Uint8Array(t.length),n=0;n<t.length;n++)a[n]=t.charCodeAt(n);return a}function p(){}t=t&&t.hasOwnProperty("default")?t["default"]:t;var m="undefined"==typeof globalThis?"undefined"==typeof window?"undefined"==typeof global?"undefined"==typeof self?{}:self:global:window:globalThis,g="undefined"==typeof m?"undefined"==typeof window?{}:window:m,c;"undefined"==typeof document?(c=g["__GLOBAL_DOCUMENT_CACHE@4"],!c&&(c=g["__GLOBAL_DOCUMENT_CACHE@4"]={})):c=document;var y=c,f=function(e,t){return t={exports:{}},e(t,t.exports),t.exports}(function(e){(function(){var t=/^((?:[a-zA-Z0-9+\-.]+:)?)(\/\/[^\/?#]*)?((?:[^\/\?#]*\/)*.*?)??(;.*?)?(\?.*?)?(#.*?)?$/,a=/^([^\/?#]*)(.*)$/,i=/(?:\/|^)\.(?=\/)/g,n=/(?:\/|^)\.\.\/(?!\.\.\/).*?(?=\/)/g,r={buildAbsoluteURL:function(e,t,i){if(i=i||{},e=e.trim(),t=t.trim(),!t){if(!i.alwaysNormalize)return e;var n=r.parseURL(e);if(!n)throw new Error("Error trying to parse base URL.");return n.path=r.normalizePath(n.path),r.buildURLFromParts(n)}var s=r.parseURL(t);if(!s)throw new Error("Error trying to parse relative URL.");if(s.scheme)return i.alwaysNormalize?(s.path=r.normalizePath(s.path),r.buildURLFromParts(s)):t;var d=r.parseURL(e);if(!d)throw new Error("Error trying to parse base URL.");if(!d.netLoc&&d.path&&"/"!==d.path[0]){var o=a.exec(d.path);d.netLoc=o[1],d.path=o[2]}d.netLoc&&!d.path&&(d.path="/");var l={scheme:d.scheme,netLoc:s.netLoc,path:null,params:s.params,query:s.query,fragment:s.fragment};if(!s.netLoc&&(l.netLoc=d.netLoc,"/"!==s.path[0]))if(!s.path)l.path=d.path,s.params||(l.params=d.params,!s.query&&(l.query=d.query));else{var u=d.path,p=u.substring(0,u.lastIndexOf("/")+1)+s.path;l.path=r.normalizePath(p)}return null===l.path&&(l.path=i.alwaysNormalize?r.normalizePath(s.path):s.path),r.buildURLFromParts(l)},parseURL:function(e){var a=t.exec(e);return a?{scheme:a[1]||"",netLoc:a[2]||"",path:a[3]||"",params:a[4]||"",query:a[5]||"",fragment:a[6]||""}:null},normalizePath:function(e){for(e=e.split("").reverse().join("").replace(i,"");e.length!==(e=e.replace(n,"")).length;);return e.split("").reverse().join("")},buildURLFromParts:function(e){return e.scheme+e.netLoc+e.path+e.params+e.query+e.fragment}};e.exports=r})(m)}),_;_="undefined"==typeof window?"undefined"==typeof m?"undefined"==typeof self?{}:self:m:window;var h=_,b=function(e,t){return /^[a-z]+:/i.test(t)?t:(/\/\//i.test(e)||(e=f.buildAbsoluteURL(h.location.href,e)),f.buildAbsoluteURL(e,t))},T=function(e,t,a){return e&&a.responseURL&&t!==a.responseURL?a.responseURL:t},S=function(){function e(){this.listeners={}}var t=e.prototype;return t.on=function(e,t){this.listeners[e]||(this.listeners[e]=[]),this.listeners[e].push(t)},t.off=function(e,t){if(!this.listeners[e])return!1;var a=this.listeners[e].indexOf(t);return this.listeners[e].splice(a,1),-1<a},t.trigger=function(e){var t=this.listeners[e],a,n,r;if(t)if(2===arguments.length)for(n=t.length,a=0;a<n;++a)t[a].call(this,arguments[1]);else for(r=Array.prototype.slice.call(arguments,1),n=t.length,a=0;a<n;++a)t[a].apply(this,r)},t.dispose=function(){this.listeners={}},t.pipe=function(e){this.on("data",function(t){e.push(t)})},e}(),k=function(e){function t(){var t;return t=e.call(this)||this,t.buffer="",t}i(t,e);var a=t.prototype;return a.push=function(e){var t;for(this.buffer+=e,t=this.buffer.indexOf("\n");-1<t;t=this.buffer.indexOf("\n"))this.trigger("data",this.buffer.substring(0,t)),this.buffer=this.buffer.substring(t+1)},t}(S),v=function(){return new RegExp("(?:^|,)("+("(?:[^=]*)=(?:"+"\"[^\"]*\"|[^,]*"+")")+")")},L=function(e){for(var t=e.split(v()),a={},n=t.length,r;n--;)""!==t[n]&&(r=/([^=]*)=(.*)/.exec(t[n]).slice(1),r[0]=r[0].replace(/^\s+|\s+$/g,""),r[1]=r[1].replace(/^\s+|\s+$/g,""),r[1]=r[1].replace(/^['"](.*)['"]$/g,"$1"),a[r[0]]=r[1]);return a},I=function(e){function t(){var t;return t=e.call(this)||this,t.customParsers=[],t.tagMappers=[],t}i(t,e);var a=t.prototype;return a.push=function(e){var t=this,a,n;if(e=e.trim(),0!==e.length){if("#"!==e[0])return void this.trigger("data",{type:"uri",uri:e});var r=this.tagMappers.reduce(function(t,a){var i=a(e);return i===e?t:t.concat([i])},[e]);r.forEach(function(e){for(var r=0;r<t.customParsers.length;r++)if(t.customParsers[r].call(t,e))return;if(0!==e.indexOf("#EXT"))return void t.trigger("data",{type:"comment",text:e.slice(1)});if(e=e.replace("\r",""),a=/^#EXTM3U/.exec(e),a)return void t.trigger("data",{type:"tag",tagType:"m3u"});if(a=/^#EXTINF:?([0-9\.]*)?,?(.*)?$/.exec(e),a)return n={type:"tag",tagType:"inf"},a[1]&&(n.duration=parseFloat(a[1])),a[2]&&(n.title=a[2]),void t.trigger("data",n);if(a=/^#EXT-X-TARGETDURATION:?([0-9.]*)?/.exec(e),a)return n={type:"tag",tagType:"targetduration"},a[1]&&(n.duration=parseInt(a[1],10)),void t.trigger("data",n);if(a=/^#ZEN-TOTAL-DURATION:?([0-9.]*)?/.exec(e),a)return n={type:"tag",tagType:"totalduration"},a[1]&&(n.duration=parseInt(a[1],10)),void t.trigger("data",n);if(a=/^#EXT-X-VERSION:?([0-9.]*)?/.exec(e),a)return n={type:"tag",tagType:"version"},a[1]&&(n.version=parseInt(a[1],10)),void t.trigger("data",n);if(a=/^#EXT-X-MEDIA-SEQUENCE:?(\-?[0-9.]*)?/.exec(e),a)return n={type:"tag",tagType:"media-sequence"},a[1]&&(n.number=parseInt(a[1],10)),void t.trigger("data",n);if(a=/^#EXT-X-DISCONTINUITY-SEQUENCE:?(\-?[0-9.]*)?/.exec(e),a)return n={type:"tag",tagType:"discontinuity-sequence"},a[1]&&(n.number=parseInt(a[1],10)),void t.trigger("data",n);if(a=/^#EXT-X-PLAYLIST-TYPE:?(.*)?$/.exec(e),a)return n={type:"tag",tagType:"playlist-type"},a[1]&&(n.playlistType=a[1]),void t.trigger("data",n);if(a=/^#EXT-X-BYTERANGE:?([0-9.]*)?@?([0-9.]*)?/.exec(e),a)return n={type:"tag",tagType:"byterange"},a[1]&&(n.length=parseInt(a[1],10)),a[2]&&(n.offset=parseInt(a[2],10)),void t.trigger("data",n);if(a=/^#EXT-X-ALLOW-CACHE:?(YES|NO)?/.exec(e),a)return n={type:"tag",tagType:"allow-cache"},a[1]&&(n.allowed=!/NO/.test(a[1])),void t.trigger("data",n);if(a=/^#EXT-X-MAP:?(.*)$/.exec(e),a){if(n={type:"tag",tagType:"map"},a[1]){var s=L(a[1]);if(s.URI&&(n.uri=s.URI),s.BYTERANGE){var d=s.BYTERANGE.split("@"),o=d[0],l=d[1];n.byterange={},o&&(n.byterange.length=parseInt(o,10)),l&&(n.byterange.offset=parseInt(l,10))}}return void t.trigger("data",n)}if(a=/^#EXT-X-STREAM-INF:?(.*)$/.exec(e),a){if(n={type:"tag",tagType:"stream-inf"},a[1]){if(n.attributes=L(a[1]),n.attributes.RESOLUTION){var u=n.attributes.RESOLUTION.split("x"),p={};u[0]&&(p.width=parseInt(u[0],10)),u[1]&&(p.height=parseInt(u[1],10)),n.attributes.RESOLUTION=p}n.attributes.BANDWIDTH&&(n.attributes.BANDWIDTH=parseInt(n.attributes.BANDWIDTH,10)),n.attributes["PROGRAM-ID"]&&(n.attributes["PROGRAM-ID"]=parseInt(n.attributes["PROGRAM-ID"],10))}return void t.trigger("data",n)}return(a=/^#EXT-X-MEDIA:?(.*)$/.exec(e),a)?(n={type:"tag",tagType:"media"},a[1]&&(n.attributes=L(a[1])),void t.trigger("data",n)):(a=/^#EXT-X-ENDLIST/.exec(e),a)?void t.trigger("data",{type:"tag",tagType:"endlist"}):(a=/^#EXT-X-DISCONTINUITY/.exec(e),a)?void t.trigger("data",{type:"tag",tagType:"discontinuity"}):(a=/^#EXT-X-PROGRAM-DATE-TIME:?(.*)$/.exec(e),a)?(n={type:"tag",tagType:"program-date-time"},a[1]&&(n.dateTimeString=a[1],n.dateTimeObject=new Date(a[1])),void t.trigger("data",n)):(a=/^#EXT-X-KEY:?(.*)$/.exec(e),a)?(n={type:"tag",tagType:"key"},a[1]&&(n.attributes=L(a[1]),n.attributes.IV&&("0x"===n.attributes.IV.substring(0,2).toLowerCase()&&(n.attributes.IV=n.attributes.IV.substring(2)),n.attributes.IV=n.attributes.IV.match(/.{8}/g),n.attributes.IV[0]=parseInt(n.attributes.IV[0],16),n.attributes.IV[1]=parseInt(n.attributes.IV[1],16),n.attributes.IV[2]=parseInt(n.attributes.IV[2],16),n.attributes.IV[3]=parseInt(n.attributes.IV[3],16),n.attributes.IV=new Uint32Array(n.attributes.IV))),void t.trigger("data",n)):(a=/^#EXT-X-START:?(.*)$/.exec(e),a)?(n={type:"tag",tagType:"start"},a[1]&&(n.attributes=L(a[1]),n.attributes["TIME-OFFSET"]=parseFloat(n.attributes["TIME-OFFSET"]),n.attributes.PRECISE=/YES/.test(n.attributes.PRECISE)),void t.trigger("data",n)):(a=/^#EXT-X-CUE-OUT-CONT:?(.*)?$/.exec(e),a)?(n={type:"tag",tagType:"cue-out-cont"},n.data=a[1]?a[1]:"",void t.trigger("data",n)):(a=/^#EXT-X-CUE-OUT:?(.*)?$/.exec(e),a)?(n={type:"tag",tagType:"cue-out"},n.data=a[1]?a[1]:"",void t.trigger("data",n)):(a=/^#EXT-X-CUE-IN:?(.*)?$/.exec(e),a?(n={type:"tag",tagType:"cue-in"},n.data=a[1]?a[1]:"",void t.trigger("data",n)):void t.trigger("data",{type:"tag",data:e.slice(4)}))})}},a.addParser=function(e){var t=this,a=e.expression,i=e.customType,n=e.dataParser,r=e.segment;"function"!=typeof n&&(n=function(e){return e}),this.customParsers.push(function(e){var s=a.exec(e);if(s)return t.trigger("data",{type:"custom",data:n(e),customType:i,segment:r}),!0})},a.addTagMapper=function(e){var t=e.expression,a=e.map;this.tagMappers.push(function(e){return t.test(e)?a(e):e})},t}(S),E=function(e){function t(){var t;t=e.call(this)||this,t.lineStream=new k,t.parseStream=new I,t.lineStream.pipe(t.parseStream);var i=n(t),s=[],d={},o=function(){},l={AUDIO:{},VIDEO:{},"CLOSED-CAPTIONS":{},SUBTITLES:{}},u=0,p,m;return t.manifest={allowCache:!0,discontinuityStarts:[],segments:[]},t.parseStream.on("data",function(e){var t,n;({tag:function(){(({"allow-cache":function(){this.manifest.allowCache=e.allowed,"allowed"in e||(this.trigger("info",{message:"defaulting allowCache to YES"}),this.manifest.allowCache=!0)},byterange:function t(){var t={};"length"in e&&(d.byterange=t,t.length=e.length,!("offset"in e)&&(this.trigger("info",{message:"defaulting offset to zero"}),e.offset=0)),"offset"in e&&(d.byterange=t,t.offset=e.offset)},endlist:function(){this.manifest.endList=!0},inf:function(){"mediaSequence"in this.manifest||(this.manifest.mediaSequence=0,this.trigger("info",{message:"defaulting media sequence to zero"})),"discontinuitySequence"in this.manifest||(this.manifest.discontinuitySequence=0,this.trigger("info",{message:"defaulting discontinuity sequence to zero"})),0<e.duration&&(d.duration=e.duration),0===e.duration&&(d.duration=.01,this.trigger("info",{message:"updating zero segment duration to a small value"})),this.manifest.segments=s},key:function(){if(!e.attributes)return void this.trigger("warn",{message:"ignoring key declaration without attribute list"});if("NONE"===e.attributes.METHOD)return void(m=null);if(!e.attributes.URI)return void this.trigger("warn",{message:"ignoring key declaration without URI"});if(e.attributes.KEYFORMAT==="urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed"){return-1===["SAMPLE-AES","SAMPLE-AES-CTR","SAMPLE-AES-CENC"].indexOf(e.attributes.METHOD)?void this.trigger("warn",{message:"invalid key method provided for Widevine"}):("SAMPLE-AES-CENC"===e.attributes.METHOD&&this.trigger("warn",{message:"SAMPLE-AES-CENC is deprecated, please use SAMPLE-AES-CTR instead"}),"data:text/plain;base64,"!==e.attributes.URI.substring(0,23))?void this.trigger("warn",{message:"invalid key URI provided for Widevine"}):e.attributes.KEYID&&"0x"===e.attributes.KEYID.substring(0,2)?void(this.manifest.contentProtection={"com.widevine.alpha":{attributes:{schemeIdUri:e.attributes.KEYFORMAT,keyId:e.attributes.KEYID.substring(2)},pssh:r(e.attributes.URI.split(",")[1])}}):void this.trigger("warn",{message:"invalid key ID provided for Widevine"})}e.attributes.METHOD||this.trigger("warn",{message:"defaulting key method to AES-128"}),m={method:e.attributes.METHOD||"AES-128",uri:e.attributes.URI},"undefined"!=typeof e.attributes.IV&&(m.iv=e.attributes.IV)},"media-sequence":function(){return isFinite(e.number)?void(this.manifest.mediaSequence=e.number):void this.trigger("warn",{message:"ignoring invalid media sequence: "+e.number})},"discontinuity-sequence":function(){return isFinite(e.number)?void(this.manifest.discontinuitySequence=e.number,u=e.number):void this.trigger("warn",{message:"ignoring invalid discontinuity sequence: "+e.number})},"playlist-type":function(){return /VOD|EVENT/.test(e.playlistType)?void(this.manifest.playlistType=e.playlistType):void this.trigger("warn",{message:"ignoring unknown playlist type: "+e.playlist})},map:function(){p={},e.uri&&(p.uri=e.uri),e.byterange&&(p.byterange=e.byterange)},"stream-inf":function(){return this.manifest.playlists=s,this.manifest.mediaGroups=this.manifest.mediaGroups||l,e.attributes?void(!d.attributes&&(d.attributes={}),a(d.attributes,e.attributes)):void this.trigger("warn",{message:"ignoring empty stream-inf attributes"})},media:function(){if(this.manifest.mediaGroups=this.manifest.mediaGroups||l,!(e.attributes&&e.attributes.TYPE&&e.attributes["GROUP-ID"]&&e.attributes.NAME))return void this.trigger("warn",{message:"ignoring incomplete or missing media group"});var a=this.manifest.mediaGroups[e.attributes.TYPE];a[e.attributes["GROUP-ID"]]=a[e.attributes["GROUP-ID"]]||{},t=a[e.attributes["GROUP-ID"]],n={default:/yes/i.test(e.attributes.DEFAULT)},n.autoselect=!!n.default||/yes/i.test(e.attributes.AUTOSELECT),e.attributes.LANGUAGE&&(n.language=e.attributes.LANGUAGE),e.attributes.URI&&(n.uri=e.attributes.URI),e.attributes["INSTREAM-ID"]&&(n.instreamId=e.attributes["INSTREAM-ID"]),e.attributes.CHARACTERISTICS&&(n.characteristics=e.attributes.CHARACTERISTICS),e.attributes.FORCED&&(n.forced=/yes/i.test(e.attributes.FORCED)),t[e.attributes.NAME]=n},discontinuity:function(){u+=1,d.discontinuity=!0,this.manifest.discontinuityStarts.push(s.length)},"program-date-time":function(){"undefined"==typeof this.manifest.dateTimeString&&(this.manifest.dateTimeString=e.dateTimeString,this.manifest.dateTimeObject=e.dateTimeObject),d.dateTimeString=e.dateTimeString,d.dateTimeObject=e.dateTimeObject},targetduration:function(){return!isFinite(e.duration)||0>e.duration?void this.trigger("warn",{message:"ignoring invalid target duration: "+e.duration}):void(this.manifest.targetDuration=e.duration)},totalduration:function(){return!isFinite(e.duration)||0>e.duration?void this.trigger("warn",{message:"ignoring invalid total duration: "+e.duration}):void(this.manifest.totalDuration=e.duration)},start:function(){return!e.attributes||isNaN(e.attributes["TIME-OFFSET"])?void this.trigger("warn",{message:"ignoring start declaration without appropriate attribute list"}):void(this.manifest.start={timeOffset:e.attributes["TIME-OFFSET"],precise:e.attributes.PRECISE})},"cue-out":function(){d.cueOut=e.data},"cue-out-cont":function(){d.cueOutCont=e.data},"cue-in":function(){d.cueIn=e.data}})[e.tagType]||o).call(i)},uri:function(){d.uri=e.uri,s.push(d),this.manifest.targetDuration&&!("duration"in d)&&(this.trigger("warn",{message:"defaulting segment duration to the target duration"}),d.duration=this.manifest.targetDuration),m&&(d.key=m),d.timeline=u,p&&(d.map=p),d={}},comment:function(){},custom:function(){e.segment?(d.custom=d.custom||{},d.custom[e.customType]=e.data):(this.manifest.custom=this.manifest.custom||{},this.manifest.custom[e.customType]=e.data)}})[e.type].call(i)}),t}i(t,e);var s=t.prototype;return s.push=function(e){this.lineStream.push(e)},s.end=function(){this.lineStream.push("\n")},s.addParser=function(e){this.parseStream.addParser(e)},s.addTagMapper=function(e){this.parseStream.addTagMapper(e)},t}(S),P=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},U=function(){function e(e,t){for(var a=0,n;a<t.length;a++)n=t[a],n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}return function(t,a,i){return a&&e(t.prototype,a),i&&e(t,i),t}}(),C=function e(t,a,i){null===t&&(t=Function.prototype);var n=Object.getOwnPropertyDescriptor(t,a);if(n===void 0){var r=Object.getPrototypeOf(t);return null===r?void 0:e(r,a,i)}if("value"in n)return n.value;var s=n.get;return void 0===s?void 0:s.call(i)},O=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)},R=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t&&("object"==typeof t||"function"==typeof t)?t:e},D=function(){function e(e,t){var a=[],i=!0,n=!1,r=void 0;try{for(var s=e[Symbol.iterator](),d;!(i=(d=s.next()).done)&&(a.push(d.value),!(t&&a.length===t));i=!0);}catch(e){n=!0,r=e}finally{try{!i&&s["return"]&&s["return"]()}finally{if(n)throw r}}return a}return function(t,a){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,a);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),A=t.mergeOptions,x=t.EventTarget,B=t.log,M=function(e,t){["AUDIO","SUBTITLES"].forEach(function(a){for(var i in e.mediaGroups[a])for(var n in e.mediaGroups[a][i]){var r=e.mediaGroups[a][i][n];t(r,a,i,n)}})},w=function(e,t,a){var n=t.slice();a=a||0;for(var r=Math.min(e.length,t.length+a),s=a;s<r;s++)n[s-a]=A(e[s],n[s-a]);return n},N=function(e,t){e.resolvedUri||(e.resolvedUri=b(t,e.uri)),e.key&&!e.key.resolvedUri&&(e.key.resolvedUri=b(t,e.key.uri)),e.map&&!e.map.resolvedUri&&(e.map.resolvedUri=b(t,e.map.uri))},q=function(e,t){var a=A(e,{}),n=a.playlists[t.uri];if(!n)return null;if(n.segments&&t.segments&&n.segments.length===t.segments.length&&n.endList===t.endList&&n.mediaSequence===t.mediaSequence)return null;var r=A(n,t);n.segments&&(r.segments=w(n.segments,t.segments,t.mediaSequence-n.mediaSequence)),r.segments.forEach(function(e){N(e,r.resolvedUri)});for(var s=0;s<a.playlists.length;s++)a.playlists[s].uri===t.uri&&(a.playlists[s]=r);return a.playlists[t.uri]=r,a},F=function(e){for(var t=e.playlists.length;t--;){var a=e.playlists[t];e.playlists[a.uri]=a,a.resolvedUri=b(e.uri,a.uri),a.id=t,a.attributes||(a.attributes={},B.warn("Invalid playlist STREAM-INF detected. Missing BANDWIDTH attribute."))}},G=function(e){M(e,function(t){t.uri&&(t.resolvedUri=b(e.uri,t.uri))})},H=function(e,t){var a=e.segments[e.segments.length-1],i=void 0;return i=t&&a&&a.duration?1e3*a.duration:500*(e.targetDuration||10),i},W=function(e){function t(e,a){var i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{};P(this,t);var n=R(this,(t.__proto__||Object.getPrototypeOf(t)).call(this)),r=i.withCredentials,s=i.handleManifestRedirects;n.srcUrl=e,n.hls_=a,n.withCredentials=void 0!==r&&r,n.handleManifestRedirects=void 0!==s&&s;var d=a.options_;if(n.customTagParsers=d&&d.customTagParsers||[],n.customTagMappers=d&&d.customTagMappers||[],!n.srcUrl)throw new Error("A non-empty playlist URL is required");return n.state="HAVE_NOTHING",n.on("mediaupdatetimeout",function(){"HAVE_METADATA"!==n.state||(n.state="HAVE_CURRENT_METADATA",n.request=n.hls_.xhr({uri:b(n.master.uri,n.media().uri),withCredentials:n.withCredentials},function(e){return n.request?e?n.playlistRequestError(n.request,n.media().uri,"HAVE_METADATA"):void n.haveMetadata(n.request,n.media().uri):void 0}))}),n}return O(t,e),U(t,[{key:"playlistRequestError",value:function(e,t,a){this.request=null,a&&(this.state=a),this.error={playlist:this.master.playlists[t],status:e.status,message:"HLS playlist request error at URL: "+t+".",responseText:e.responseText,code:500<=e.status?4:2},this.trigger("error")}},{key:"haveMetadata",value:function(e,t){var a=this;this.request=null,this.state="HAVE_METADATA";var i=new E;this.customTagParsers.forEach(function(e){return i.addParser(e)}),this.customTagMappers.forEach(function(e){return i.addTagMapper(e)}),i.push(e.responseText),i.end(),i.manifest.uri=t,i.manifest.attributes=i.manifest.attributes||{};var n=q(this.master,i.manifest);this.targetDuration=i.manifest.targetDuration,n?(this.master=n,this.media_=this.master.playlists[i.manifest.uri]):this.trigger("playlistunchanged"),this.media().endList||(h.clearTimeout(this.mediaUpdateTimeout),this.mediaUpdateTimeout=h.setTimeout(function(){a.trigger("mediaupdatetimeout")},H(this.media(),!!n))),this.trigger("loadedplaylist")}},{key:"dispose",value:function(){this.stopRequest(),h.clearTimeout(this.mediaUpdateTimeout),h.clearTimeout(this.finalRenditionTimeout)}},{key:"stopRequest",value:function(){if(this.request){var e=this.request;this.request=null,e.onreadystatechange=null,e.abort()}}},{key:"media",value:function(e,t){var a=this;if(!e)return this.media_;if("HAVE_NOTHING"===this.state)throw new Error("Cannot switch media playlist from "+this.state);if("string"==typeof e){if(!this.master.playlists[e])throw new Error("Unknown playlist URI: "+e);e=this.master.playlists[e]}if(h.clearTimeout(this.finalRenditionTimeout),t){var i=1e3*(e.targetDuration/2)||5000;return void(this.finalRenditionTimeout=h.setTimeout(this.media.bind(this,e,!1),i))}var n=this.state,r=!this.media_||e.uri!==this.media_.uri;if(this.master.playlists[e.uri].endList)return this.request&&(this.request.onreadystatechange=null,this.request.abort(),this.request=null),this.state="HAVE_METADATA",this.media_=e,void(r&&(this.trigger("mediachanging"),this.trigger("mediachange")));if(r){if(this.state="SWITCHING_MEDIA",this.request){if(e.resolvedUri===this.request.url)return;this.request.onreadystatechange=null,this.request.abort(),this.request=null}this.media_&&this.trigger("mediachanging"),this.request=this.hls_.xhr({uri:e.resolvedUri,withCredentials:this.withCredentials},function(t,i){if(a.request)return e.resolvedUri=T(a.handleManifestRedirects,e.resolvedUri,i),t?a.playlistRequestError(a.request,e.uri,n):void(a.haveMetadata(i,e.uri),"HAVE_MASTER"===n?a.trigger("loadedmetadata"):a.trigger("mediachange"))})}}},{key:"pause",value:function(){this.stopRequest(),h.clearTimeout(this.mediaUpdateTimeout),"HAVE_NOTHING"===this.state&&(this.started=!1),"SWITCHING_MEDIA"===this.state?this.media_?this.state="HAVE_METADATA":this.state="HAVE_MASTER":"HAVE_CURRENT_METADATA"===this.state&&(this.state="HAVE_METADATA")}},{key:"load",value:function(e){var t=this;h.clearTimeout(this.mediaUpdateTimeout);var a=this.media();if(e){var i=a?1e3*(a.targetDuration/2):5000;return void(this.mediaUpdateTimeout=h.setTimeout(function(){return t.load()},i))}return this.started?void(a&&!a.endList?this.trigger("mediaupdatetimeout"):this.trigger("loadedplaylist")):void this.start()}},{key:"start",value:function(){var e=this;this.started=!0,this.request=this.hls_.xhr({uri:this.srcUrl,withCredentials:this.withCredentials},function(t,a){if(e.request){if(e.request=null,t)return e.error={status:a.status,message:"HLS playlist request error at URL: "+e.srcUrl+".",responseText:a.responseText,code:2},"HAVE_NOTHING"===e.state&&(e.started=!1),e.trigger("error");var i=new E;return(e.customTagParsers.forEach(function(e){return i.addParser(e)}),e.customTagMappers.forEach(function(e){return i.addTagMapper(e)}),i.push(a.responseText),i.end(),e.state="HAVE_MASTER",e.srcUrl=T(e.handleManifestRedirects,e.srcUrl,a),i.manifest.uri=e.srcUrl,i.manifest.playlists)?(e.master=i.manifest,F(e.master),G(e.master),e.trigger("loadedplaylist"),void(e.request||e.media(i.manifest.playlists[0]))):(e.master={mediaGroups:{AUDIO:{},VIDEO:{},"CLOSED-CAPTIONS":{},SUBTITLES:{}},uri:h.location.href,playlists:[{uri:e.srcUrl,id:0,resolvedUri:e.srcUrl,attributes:{}}]},e.master.playlists[e.srcUrl]=e.master.playlists[0],e.haveMetadata(a,e.srcUrl),e.trigger("loadedmetadata"))}})}}]),t}(x),V=t.createTimeRange,z=function(e,t){var a=0,n=t-e.mediaSequence,r=e.segments[n];if(r){if("undefined"!=typeof r.start)return{result:r.start,precise:!0};if("undefined"!=typeof r.end)return{result:r.end-r.duration,precise:!0}}for(;n--;){if(r=e.segments[n],"undefined"!=typeof r.end)return{result:a+r.end,precise:!0};if(a+=r.duration,"undefined"!=typeof r.start)return{result:a+r.start,precise:!0}}return{result:a,precise:!1}},j=function(e,t){for(var a=0,n=void 0,r=t-e.mediaSequence;r<e.segments.length;r++){if(n=e.segments[r],"undefined"!=typeof n.start)return{result:n.start-a,precise:!0};if(a+=n.duration,"undefined"!=typeof n.end)return{result:n.end-a,precise:!0}}return{result:-1,precise:!1}},Y=function(e,t,a){var i=void 0,n=void 0;return("undefined"==typeof t&&(t=e.mediaSequence+e.segments.length),t<e.mediaSequence)?0:(i=z(e,t),i.precise)?i.result:(n=j(e,t),n.precise?n.result:i.result+a)},X=function(e,t,a){if(!e)return 0;if("number"!=typeof a&&(a=0),"undefined"==typeof t){if(e.totalDuration)return e.totalDuration;if(!e.endList)return h.Infinity}return Y(e,t,a)},K=function(e,t,a){var n=0;if(t>a){var r=[a,t];t=r[0],a=r[1]}if(0>t){for(var s=t;s<Math.min(0,a);s++)n+=e.targetDuration;t=0}for(var d=t;d<a;d++)n+=e.segments[d].duration;return n},Q=function(e){if(!e.segments.length)return 0;for(var t=e.segments.length-1,a=e.segments[t].duration||e.targetDuration,n=a+2*e.targetDuration;t--&&(a+=e.segments[t].duration,!(a>=n)););return Math.max(0,t)},J=function(e,t,a){if(!e||!e.segments)return null;if(e.endList)return X(e);if(null===t)return null;t=t||0;var i=a?Q(e):e.segments.length;return Y(e,e.mediaSequence+i,t)},Z=function(e){return 0==e-Math.floor(e)},$=function(e,t){if(Z(t))return t+.1*e;for(var a=t.toString().split(".")[1].length,n=1;n<=a;n++){var r=Math.pow(10,n),s=t*r;if(Z(s)||n===a)return(s+e)/r}},ee=$.bind(null,1),te=$.bind(null,-1),ae=function(e,t,a,n){var r=void 0,s=void 0,d=e.segments.length,o=t-n;if(0>o){if(0<a)for(r=a-1;0<=r;r--)if(s=e.segments[r],o+=te(s.duration),0<o)return{mediaIndex:r,startTime:n-K(e,a,r)};return{mediaIndex:0,startTime:t}}if(0>a){for(r=a;0>r;r++)if(o-=e.targetDuration,0>o)return{mediaIndex:0,startTime:t};a=0}for(r=a;r<d;r++)if(s=e.segments[r],o-=ee(s.duration),0>o)return{mediaIndex:r,startTime:n+K(e,a,r)};return{mediaIndex:d-1,startTime:t}},ie=function(e){return e.excludeUntil&&e.excludeUntil>Date.now()},ne=function(e){return e.excludeUntil&&e.excludeUntil===1/0},re=function(e){var t=ie(e);return!e.disabled&&!t},se=function(e,t){return t.attributes&&t.attributes[e]},de=function(e,t){if(1===e.playlists.length)return!0;var a=t.attributes.BANDWIDTH||Number.MAX_VALUE;return 0===e.playlists.filter(function(e){return!!re(e)&&(e.attributes.BANDWIDTH||0)<a}).length},oe={duration:X,seekable:function(e,t){var a=J(e,t,!0);return null===a?V():V(t||0,a)},safeLiveIndex:Q,getMediaInfoForTime:ae,isEnabled:re,isDisabled:function(e){return e.disabled},isBlacklisted:ie,isIncompatible:ne,playlistEnd:J,isAes:function(e){for(var t=0;t<e.segments.length;t++)if(e.segments[t].key)return!0;return!1},isFmp4:function(e){for(var t=0;t<e.segments.length;t++)if(e.segments[t].map)return!0;return!1},hasAttribute:se,estimateSegmentRequestTime:function(e,t,a){var i=3<arguments.length&&arguments[3]!==void 0?arguments[3]:0;if(!se("BANDWIDTH",a))return NaN;var n=e*a.attributes.BANDWIDTH;return(n-8*i)/t},isLowestEnabledRendition:de},le=t.xhr,ue=t.mergeOptions,pe=function(){var e=function e(a,i){a=ue({timeout:45e3},a);var n=e.beforeRequest||t.Hls.xhr.beforeRequest;if(n&&"function"==typeof n){var r=n(a);r&&(a=r)}var s=le(a,function(e,t){var a=s.response;!e&&a&&(s.responseTime=Date.now(),s.roundTripTime=s.responseTime-s.requestTime,s.bytesReceived=a.byteLength||a.length,!s.bandwidth&&(s.bandwidth=Math.floor(1e3*(8*(s.bytesReceived/s.roundTripTime))))),t.headers&&(s.responseHeaders=t.headers),e&&"ETIMEDOUT"===e.code&&(s.timedout=!0),e||s.aborted||200===t.statusCode||206===t.statusCode||0===t.statusCode||(e=new Error("XHR Failed with a response of: "+(s&&(a||s.responseText)))),i(e,s)}),d=s.abort;return s.abort=function(){return s.aborted=!0,d.apply(s,arguments)},s.uri=a.uri,s.requestTime=Date.now(),s};return e},me=function(e){var t=void 0,a=void 0;return a=e.offset+e.length-1,t=e.offset,"bytes="+t+"-"+a},ge=function(e){var t={};return e.byterange&&(t.Range=me(e.byterange)),t},ce=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},ye=function(){function e(e,t){for(var a=0,n;a<t.length;a++)n=t[a],n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}return function(t,a,i){return a&&e(t.prototype,a),i&&e(t,i),t}}(),fe=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)},_e=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t&&("object"==typeof t||"function"==typeof t)?t:e},he=function(){var e=[[[],[],[],[],[]],[[],[],[],[],[]]],t=e[0],a=e[1],n=t[4],r=a[4],o=void 0,l=void 0,u=void 0,p=[],d=[],m=void 0,g=void 0,c=void 0,y=void 0,f=void 0,_=void 0;for(o=0;256>o;o++)d[(p[o]=o<<1^283*(o>>7))^o]=o;for(l=u=0;!n[l];l^=m||1,u=d[u]||1)for(y=u^u<<1^u<<2^u<<3^u<<4,y=99^(y>>8^255&y),n[l]=y,r[y]=l,c=p[g=p[m=p[l]]],_=16843009*c^65537*g^257*m^16843008*l,f=257*p[y]^16843008*y,o=0;4>o;o++)t[o][l]=f=f<<24^f>>>8,a[o][y]=_=_<<24^_>>>8;for(o=0;5>o;o++)t[o]=t[o].slice(0),a[o]=a[o].slice(0);return e},be=null,Te=function(){function e(t){ce(this,e),be||(be=he()),this._tables=[[be[0][0].slice(),be[0][1].slice(),be[0][2].slice(),be[0][3].slice(),be[0][4].slice()],[be[1][0].slice(),be[1][1].slice(),be[1][2].slice(),be[1][3].slice(),be[1][4].slice()]];var a=void 0,n=void 0,r=void 0,s=void 0,d=void 0,o=this._tables[0][4],l=this._tables[1],u=t.length,p=1;if(4!==u&&6!==u&&8!==u)throw new Error("Invalid aes key size");for(s=t.slice(0),d=[],this._key=[s,d],a=u;a<4*u+28;a++)r=s[a-1],(0==a%u||8===u&&4==a%u)&&(r=o[r>>>24]<<24^o[255&r>>16]<<16^o[255&r>>8]<<8^o[255&r],0==a%u&&(r=r<<8^r>>>24^p<<24,p=p<<1^283*(p>>7))),s[a]=s[a-u]^r;for(n=0;a;n++,a--)r=s[3&n?a:a-4],d[n]=4>=a||4>n?r:l[0][o[r>>>24]]^l[1][o[255&r>>16]]^l[2][o[255&r>>8]]^l[3][o[255&r]]}return e.prototype.decrypt=function(e,t,n,r,s,o){var l=this._key[1],u=e^l[0],p=r^l[1],m=n^l[2],g=t^l[3],y=void 0,f=void 0,_=void 0,h=l.length/4-2,T=void 0,S=4,k=this._tables[1],v=k[0],L=k[1],I=k[2],E=k[3],P=k[4];for(T=0;T<h;T++)y=v[u>>>24]^L[255&p>>16]^I[255&m>>8]^E[255&g]^l[S],f=v[p>>>24]^L[255&m>>16]^I[255&g>>8]^E[255&u]^l[S+1],_=v[m>>>24]^L[255&g>>16]^I[255&u>>8]^E[255&p]^l[S+2],g=v[g>>>24]^L[255&u>>16]^I[255&p>>8]^E[255&m]^l[S+3],S+=4,u=y,p=f,m=_;for(T=0;4>T;T++)s[(3&-T)+o]=P[u>>>24]<<24^P[255&p>>16]<<16^P[255&m>>8]<<8^P[255&g]^l[S++],y=u,u=p,p=m,m=g,g=y},e}(),Se=function(){function e(){ce(this,e),this.listeners={}}return e.prototype.on=function(e,t){this.listeners[e]||(this.listeners[e]=[]),this.listeners[e].push(t)},e.prototype.off=function(e,t){if(!this.listeners[e])return!1;var a=this.listeners[e].indexOf(t);return this.listeners[e].splice(a,1),-1<a},e.prototype.trigger=function(e){var t=this.listeners[e];if(t)if(2===arguments.length)for(var a=t.length,n=0;n<a;++n)t[n].call(this,arguments[1]);else for(var r=Array.prototype.slice.call(arguments,1),s=t.length,d=0;d<s;++d)t[d].apply(this,r)},e.prototype.dispose=function(){this.listeners={}},e.prototype.pipe=function(e){this.on("data",function(t){e.push(t)})},e}(),ke=function(e){function t(){ce(this,t);var a=_e(this,e.call(this,Se));return a.jobs=[],a.delay=1,a.timeout_=null,a}return fe(t,e),t.prototype.processJob_=function(){this.jobs.shift()(),this.timeout_=this.jobs.length?setTimeout(this.processJob_.bind(this),this.delay):null},t.prototype.push=function(e){this.jobs.push(e),this.timeout_||(this.timeout_=setTimeout(this.processJob_.bind(this),this.delay))},t}(Se),ve=function(e){return e<<24|(65280&e)<<8|(16711680&e)>>8|e>>>24},Le=function(e,t,a){var i=new Int32Array(e.buffer,e.byteOffset,e.byteLength>>2),n=new Te(Array.prototype.slice.call(t)),r=new Uint8Array(e.byteLength),s=new Int32Array(r.buffer),d=void 0,o=void 0,l=void 0,u=void 0,p=void 0,m=void 0,g=void 0,c=void 0,y=void 0;for(d=a[0],o=a[1],l=a[2],u=a[3],y=0;y<i.length;y+=4)p=ve(i[y]),m=ve(i[y+1]),g=ve(i[y+2]),c=ve(i[y+3]),n.decrypt(p,m,g,c,s,y),s[y]=ve(s[y]^d),s[y+1]=ve(s[y+1]^o),s[y+2]=ve(s[y+2]^l),s[y+3]=ve(s[y+3]^u),d=p,o=m,l=g,u=c;return r},Ie=function(){function e(t,a,n,r){ce(this,e);var d=e.STEP,o=new Int32Array(t.buffer),l=new Uint8Array(t.byteLength),u=0;for(this.asyncStream_=new ke,this.asyncStream_.push(this.decryptChunk_(o.subarray(u,u+d),a,n,l)),u=d;u<o.length;u+=d)n=new Uint32Array([ve(o[u-4]),ve(o[u-3]),ve(o[u-2]),ve(o[u-1])]),this.asyncStream_.push(this.decryptChunk_(o.subarray(u,u+d),a,n,l));this.asyncStream_.push(function(){r(null,s(l))})}return e.prototype.decryptChunk_=function(e,t,a,i){return function(){var n=Le(e,t,a);i.set(n,e.byteOffset)}},ye(e,null,[{key:"STEP",get:function(){return 32e3}}]),e}(),Ee=function(e,t){return e.start(t)+"-"+e.end(t)},Pe=function(t,e){var a=t.toString(16);return"00".substring(0,2-a.length)+a+(e%2?" ":"")},Ue=function(t){return 32<=t&&126>t?String.fromCharCode(t):"."},Ce=function(e){var t={};return Object.keys(e).forEach(function(a){var i=e[a];t[a]=ArrayBuffer.isView(i)?{bytes:i.buffer,byteOffset:i.byteOffset,byteLength:i.byteLength}:i}),t},Oe=function(e){var t=e.byterange||{length:1/0,offset:0};return[t.length,t.offset,e.resolvedUri].join(",")},Re=function(e){return e.resolvedUri},De=function(e){for(var t=Array.prototype.slice.call(e),a=16,i="",n=void 0,r=void 0,s=0;s<t.length/a;s++)n=t.slice(s*a,s*a+a).map(Pe).join(""),r=t.slice(s*a,s*a+a).map(Ue).join(""),i+=n+" "+r+"\n";return i},Ae=Object.freeze({createTransferableMessage:Ce,initSegmentId:Oe,segmentKeyId:Re,hexDump:De,tagDump:function(e){var t=e.bytes;return De(t)},textRanges:function(e){var t="",a=void 0;for(a=0;a<e.length;a++)t+=Ee(e,a)+" ";return t}}),xe=.25,Be=function(e,t){if(!t.dateTimeObject)return null;var a=t.videoTimingInfo.transmuxerPrependedSeconds,i=t.videoTimingInfo.transmuxedPresentationStart;return new Date(t.dateTimeObject.getTime()+1e3*(e-(i+a)))},Me=function(e){return e.transmuxedPresentationEnd-e.transmuxedPresentationStart-e.transmuxerPrependedSeconds},we=function(e,t){var a;try{a=new Date(e)}catch(t){return null}if(!t||!t.segments||0===t.segments.length)return null;var n=t.segments[0];if(a<n.dateTimeObject)return null;for(var r=0;r<t.segments.length-1;r++){n=t.segments[r];var s=t.segments[r+1].dateTimeObject;if(a<s)break}var d=t.segments[t.segments.length-1],o=d.dateTimeObject,l=d.videoTimingInfo?Me(d.videoTimingInfo):d.duration+d.duration*xe,u=new Date(o.getTime()+1e3*l);return a>u?null:(a>o&&(n=d),{segment:n,estimatedStart:n.videoTimingInfo?n.videoTimingInfo.transmuxedPresentationStart:oe.duration(t,t.mediaSequence+t.segments.indexOf(n)),type:n.videoTimingInfo?"accurate":"estimate"})},Ne=function(e,t){if(!t||!t.segments||0===t.segments.length)return null;for(var a=0,n=void 0,r=0;r<t.segments.length&&(n=t.segments[r],a=n.videoTimingInfo?n.videoTimingInfo.transmuxedPresentationEnd:a+n.duration,!(e<=a));r++);var s=t.segments[t.segments.length-1];if(s.videoTimingInfo&&s.videoTimingInfo.transmuxedPresentationEnd<e)return null;if(e>a){if(e>a+s.duration*xe)return null;n=s}return{segment:n,estimatedStart:n.videoTimingInfo?n.videoTimingInfo.transmuxedPresentationStart:a-n.duration,type:n.videoTimingInfo?"accurate":"estimate"}},qe=function(e,t){var a=void 0,i=void 0;try{a=new Date(e),i=new Date(t)}catch(t){}var n=a.getTime(),r=i.getTime();return(r-n)/1e3},Fe=function(e){if(!e.segments||0===e.segments.length)return!1;for(var t=0,a;t<e.segments.length;t++)if(a=e.segments[t],!a.dateTimeObject)return!1;return!0},Ge=function(e){var t=e.playlist,a=e.time,i=void 0===a?void 0:a,n=e.callback;if(!n)throw new Error("getProgramTime: callback must be provided");if(!t||void 0===i)return n({message:"getProgramTime: playlist and time must be provided"});var r=Ne(i,t);if(!r)return n({message:"valid programTime was not found"});if("estimate"===r.type)return n({message:"Accurate programTime could not be determined. Please seek to e.seekTime and try again",seekTime:r.estimatedStart});var s={mediaSeconds:i},d=Be(i,r.segment);return d&&(s.programDateTime=d.toISOString()),n(null,s)},He=function e(t){var a=t.programTime,i=t.playlist,n=t.retryCount,r=n===void 0?2:n,s=t.seekTo,d=t.pauseAfterSeek,o=!(d!==void 0)||d,l=t.tech,u=t.callback;if(!u)throw new Error("seekToProgramTime: callback must be provided");if("undefined"==typeof a||!i||!s)return u({message:"seekToProgramTime: programTime, seekTo and playlist must be provided"});if(!i.endList&&!l.hasStarted_)return u({message:"player must be playing a live stream to start buffering"});if(!Fe(i))return u({message:"programDateTime tags must be provided in the manifest "+i.resolvedUri});var p=we(a,i);if(!p)return u({message:a+" was not found in the stream"});var m=p.segment,g=qe(m.dateTimeObject,a);if("estimate"===p.type)return 0===r?u({message:a+" is not buffered yet. Try again"}):(s(p.estimatedStart+g),void l.one("seeked",function(){e({programTime:a,playlist:i,retryCount:r-1,seekTo:s,pauseAfterSeek:o,tech:l,callback:u})}));var c=m.start+g;l.one("seeked",function(){return u(null,l.currentTime())}),o&&l.pause(),s(c)},We=1/30,Ve=3*We,ze=function(e,a){var n=[],r=void 0;if(e&&e.length)for(r=0;r<e.length;r++)a(e.start(r),e.end(r))&&n.push([e.start(r),e.end(r)]);return t.createTimeRanges(n)},je=function(e,t){return ze(e,function(e,a){return e-Ve<=t&&a+Ve>=t})},Ye=function(e,t){return ze(e,function(e){return e-We>=t})},Xe=function(e){if(2>e.length)return t.createTimeRanges();for(var a=[],n=1;n<e.length;n++){var r=e.end(n-1),s=e.start(n);a.push([r,s])}return t.createTimeRanges(a)},Ke=function(e){var t=[];if(!e||!e.length)return"";for(var a=0;a<e.length;a++)t.push(e.start(a)+" => "+e.end(a));return t.join(", ")},Qe=function(e,t){var a=2<arguments.length&&arguments[2]!==void 0?arguments[2]:1,i=e.length?e.end(e.length-1):0;return(i-t)/a},Je=function(e){for(var t=[],a=0;a<e.length;a++)t.push({start:e.start(a),end:e.end(a)});return t},Ze=function(e,t,a){var i=t.player_;if(a.captions&&a.captions.length)for(var n in e.inbandTextTracks_||(e.inbandTextTracks_={}),a.captionStreams)if(!e.inbandTextTracks_[n]){i.tech_.trigger({type:"usage",name:"hls-608"});var r=i.textTracks().getTrackById(n);e.inbandTextTracks_[n]=r?r:i.addRemoteTextTrack({kind:"captions",id:n,label:n},!1).track}a.metadata&&a.metadata.length&&!e.metadataTrack_&&(e.metadataTrack_=i.addRemoteTextTrack({kind:"metadata",label:"Timed Metadata"},!1).track,e.metadataTrack_.inBandMetadataTrackDispatchType=a.metadata.dispatchType)},$e=function(e,t,a){var n=void 0,r=void 0;if(a&&a.cues)for(n=a.cues.length;n--;)r=a.cues[n],r.startTime<=t&&r.endTime>=e&&a.removeCue(r)},et=function(e){Object.defineProperties(e.frame,{id:{get:function(){return t.log.warn("cue.frame.id is deprecated. Use cue.value.key instead."),e.value.key}},value:{get:function(){return t.log.warn("cue.frame.value is deprecated. Use cue.value.data instead."),e.value.data}},privateData:{get:function(){return t.log.warn("cue.frame.privateData is deprecated. Use cue.value.data instead."),e.value.data}}})},tt=function(e){var t;return t=isNaN(e)||Math.abs(e)===1/0?Number.MAX_VALUE:e,t},at=function(e,t,a){var n=h.WebKitDataCue||h.VTTCue;if(t&&t.forEach(function(e){var t=e.stream;this.inbandTextTracks_[t].addCue(new n(e.startTime+this.timestampOffset,e.endTime+this.timestampOffset,e.text))},e),a){var r=tt(e.mediaSource_.duration);if(a.forEach(function(e){var t=e.cueTime+this.timestampOffset;"number"!=typeof t||h.isNaN(t)||0>t||!(t<1/0)||e.frames.forEach(function(e){var a=new n(t,t,e.value||e.url||e.data||"");a.frame=e,a.value=e,et(a),this.metadataTrack_.addCue(a)},this)},e),e.metadataTrack_&&e.metadataTrack_.cues&&e.metadataTrack_.cues.length){for(var s=e.metadataTrack_.cues,d=[],o=0;o<s.length;o++)s[o]&&d.push(s[o]);var l=d.reduce(function(e,t){var a=e[t.startTime]||[];return a.push(t),e[t.startTime]=a,e},{}),u=Object.keys(l).sort(function(e,t){return+e-+t});u.forEach(function(e,t){var a=l[e],i=+u[t+1]||r;a.forEach(function(e){e.endTime=i})})}}},it="undefined"==typeof window?{}:window,nt="undefined"==typeof Symbol?"__target":Symbol(),rt=it.BlobBuilder||it.WebKitBlobBuilder||it.MozBlobBuilder||it.MSBlobBuilder,st=it.URL||it.webkitURL||st&&st.msURL,dt=it.Worker;if(dt){var ot=o("self.onmessage = function () {}"),lt=new Uint8Array(1),ut;try{ut=new dt(ot),ut.postMessage(lt,[lt.buffer])}catch(t){dt=null}finally{st.revokeObjectURL(ot),ut&&ut.terminate()}}var pt=new d("./transmuxer-worker.worker.js",function(){var e=this,t=function(){var t=function(){this.init=function(){var e={};this.on=function(t,a){e[t]||(e[t]=[]),e[t]=e[t].concat(a)},this.off=function(t,a){var i;return!!e[t]&&(i=e[t].indexOf(a),e[t]=e[t].slice(),e[t].splice(i,1),-1<i)},this.trigger=function(t){var a,n,r,s;if(a=e[t],!!a)if(2===arguments.length)for(r=a.length,n=0;n<r;++n)a[n].call(this,arguments[1]);else{for(s=[],n=arguments.length,n=1;n<arguments.length;++n)s.push(arguments[n]);for(r=a.length,n=0;n<r;++n)a[n].apply(this,s)}},this.dispose=function(){e={}}}};t.prototype.pipe=function(e){return this.on("data",function(t){e.push(t)}),this.on("done",function(t){e.flush(t)}),this.on("partialdone",function(t){e.partialFlush(t)}),this.on("endedtimeline",function(t){e.endTimeline(t)}),this.on("reset",function(t){e.reset(t)}),e},t.prototype.push=function(e){this.trigger("data",e)},t.prototype.flush=function(e){this.trigger("done",e)},t.prototype.partialFlush=function(e){this.trigger("partialdone",e)},t.prototype.endTimeline=function(e){this.trigger("endedtimeline",e)},t.prototype.reset=function(e){this.trigger("reset",e)};var a=t,i=Math.pow(2,32)-1,n,r,s,d,o,l,u,p,m,g,c,y,f,_,h,b,T,S,k,v,L,I,E,P,U,C,O,R,D,A,x,B,M,w,N,q;(function(){if(E={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],mvex:[],mvhd:[],pasp:[],sdtp:[],smhd:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],styp:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[]},"undefined"!=typeof Uint8Array){for(var e in E)E.hasOwnProperty(e)&&(E[e]=[e.charCodeAt(0),e.charCodeAt(1),e.charCodeAt(2),e.charCodeAt(3)]);P=new Uint8Array([105,115,111,109]),C=new Uint8Array([97,118,99,49]),U=new Uint8Array([0,0,0,1]),O=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),R=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]),D={video:O,audio:R},B=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),x=new Uint8Array([0,0,0,0,0,0,0,0]),M=new Uint8Array([0,0,0,0,0,0,0,0]),w=M,N=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),q=M,A=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0])}})(),n=function(e){var t=[],a=0,n,r,s;for(n=1;n<arguments.length;n++)t.push(arguments[n]);for(n=t.length;n--;)a+=t[n].byteLength;for(r=new Uint8Array(a+8),s=new DataView(r.buffer,r.byteOffset,r.byteLength),s.setUint32(0,r.byteLength),r.set(e,4),(n=0,a=8);n<t.length;n++)r.set(t[n],a),a+=t[n].byteLength;return r},r=function(){return n(E.dinf,n(E.dref,B))},s=function(e){return n(E.esds,new Uint8Array([0,0,0,0,3,25,0,0,0,4,17,64,21,0,6,0,0,0,218,192,0,0,218,192,5,2,e.audioobjecttype<<3|e.samplingfrequencyindex>>>1,e.samplingfrequencyindex<<7|e.channelcount<<3,6,1,2]))},d=function(){return n(E.ftyp,P,U,P,C)},b=function(e){return n(E.hdlr,D[e])},o=function(e){return n(E.mdat,e)},h=function(e){var t=new Uint8Array([0,0,0,0,0,0,0,2,0,0,0,3,0,1,95,144,255&e.duration>>>24,255&e.duration>>>16,255&e.duration>>>8,255&e.duration,85,196,0,0]);return e.samplerate&&(t[12]=255&e.samplerate>>>24,t[13]=255&e.samplerate>>>16,t[14]=255&e.samplerate>>>8,t[15]=255&e.samplerate),n(E.mdhd,t)},_=function(e){return n(E.mdia,h(e),b(e.type),u(e))},l=function(e){return n(E.mfhd,new Uint8Array([0,0,0,0,(4278190080&e)>>24,(16711680&e)>>16,(65280&e)>>8,255&e]))},u=function(e){return n(E.minf,"video"===e.type?n(E.vmhd,A):n(E.smhd,x),r(),S(e))},p=function(e,t){for(var a=[],r=t.length;r--;)a[r]=v(t[r]);return n.apply(null,[E.moof,l(e)].concat(a))},m=function(e){for(var t=e.length,a=[];t--;)a[t]=y(e[t]);return n.apply(null,[E.moov,c(4294967295)].concat(a).concat(g(e)))},g=function(e){for(var t=e.length,a=[];t--;)a[t]=L(e[t]);return n.apply(null,[E.mvex].concat(a))},c=function(e){var t=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,2,0,1,95,144,(4278190080&e)>>24,(16711680&e)>>16,(65280&e)>>8,255&e,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return n(E.mvhd,t)},T=function(e){var t=e.samples||[],a=new Uint8Array(4+t.length),r,s;for(s=0;s<t.length;s++)r=t[s].flags,a[s+4]=r.dependsOn<<4|r.isDependedOn<<2|r.hasRedundancy;return n(E.sdtp,a)},S=function(e){return n(E.stbl,k(e),n(E.stts,q),n(E.stsc,w),n(E.stsz,N),n(E.stco,M))},function(){var e,t;k=function(a){return n(E.stsd,new Uint8Array([0,0,0,0,0,0,0,1]),"video"===a.type?e(a):t(a))},e=function(e){var t=e.sps||[],a=e.pps||[],r=[],s=[],d,o;for(d=0;d<t.length;d++)r.push((65280&t[d].byteLength)>>>8),r.push(255&t[d].byteLength),r=r.concat(Array.prototype.slice.call(t[d]));for(d=0;d<a.length;d++)s.push((65280&a[d].byteLength)>>>8),s.push(255&a[d].byteLength),s=s.concat(Array.prototype.slice.call(a[d]));if(o=[E.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,(65280&e.width)>>8,255&e.width,(65280&e.height)>>8,255&e.height,0,72,0,0,0,72,0,0,0,0,0,0,0,1,19,118,105,100,101,111,106,115,45,99,111,110,116,114,105,98,45,104,108,115,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),n(E.avcC,new Uint8Array([1,e.profileIdc,e.profileCompatibility,e.levelIdc,255].concat([t.length],r,[a.length],s))),n(E.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192]))],e.sarRatio){var l=e.sarRatio[0],u=e.sarRatio[1];o.push(n(E.pasp,new Uint8Array([(4278190080&l)>>24,(16711680&l)>>16,(65280&l)>>8,255&l,(4278190080&u)>>24,(16711680&u)>>16,(65280&u)>>8,255&u])))}return n.apply(null,o)},t=function(e){return n(E.mp4a,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,(65280&e.channelcount)>>8,255&e.channelcount,(65280&e.samplesize)>>8,255&e.samplesize,0,0,0,0,(65280&e.samplerate)>>8,255&e.samplerate,0,0]),s(e))}}(),f=function(e){var t=new Uint8Array([0,0,0,7,0,0,0,0,0,0,0,0,(4278190080&e.id)>>24,(16711680&e.id)>>16,(65280&e.id)>>8,255&e.id,0,0,0,0,(4278190080&e.duration)>>24,(16711680&e.duration)>>16,(65280&e.duration)>>8,255&e.duration,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,(65280&e.width)>>8,255&e.width,0,0,(65280&e.height)>>8,255&e.height,0,0]);return n(E.tkhd,t)},v=function(e){var t,a,r,s,d,o,l;return(t=n(E.tfhd,new Uint8Array([0,0,0,58,(4278190080&e.id)>>24,(16711680&e.id)>>16,(65280&e.id)>>8,255&e.id,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0])),o=Math.floor(e.baseMediaDecodeTime/(i+1)),l=Math.floor(e.baseMediaDecodeTime%(i+1)),a=n(E.tfdt,new Uint8Array([1,0,0,0,255&o>>>24,255&o>>>16,255&o>>>8,255&o,255&l>>>24,255&l>>>16,255&l>>>8,255&l])),d=92,"audio"===e.type)?(r=I(e,d),n(E.traf,t,a,r)):(s=T(e),r=I(e,s.length+d),n(E.traf,t,a,r,s))},y=function(e){return e.duration=e.duration||4294967295,n(E.trak,f(e),_(e))},L=function(e){var t=new Uint8Array([0,0,0,0,(4278190080&e.id)>>24,(16711680&e.id)>>16,(65280&e.id)>>8,255&e.id,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]);return"video"!==e.type&&(t[t.length-1]=0),n(E.trex,t)},function(){var e,t,a;a=function(e,t){var a=0,i=0,n=0,r=0;return e.length&&(void 0!==e[0].duration&&(a=1),void 0!==e[0].size&&(i=2),void 0!==e[0].flags&&(n=4),void 0!==e[0].compositionTimeOffset&&(r=8)),[0,0,a|i|n|r,1,(4278190080&e.length)>>>24,(16711680&e.length)>>>16,(65280&e.length)>>>8,255&e.length,(4278190080&t)>>>24,(16711680&t)>>>16,(65280&t)>>>8,255&t]},t=function(e,t){var r,s,d,o;for(s=e.samples||[],t+=20+16*s.length,r=a(s,t),o=0;o<s.length;o++)d=s[o],r=r.concat([(4278190080&d.duration)>>>24,(16711680&d.duration)>>>16,(65280&d.duration)>>>8,255&d.duration,(4278190080&d.size)>>>24,(16711680&d.size)>>>16,(65280&d.size)>>>8,255&d.size,d.flags.isLeading<<2|d.flags.dependsOn,d.flags.isDependedOn<<6|d.flags.hasRedundancy<<4|d.flags.paddingValue<<1|d.flags.isNonSyncSample,61440&d.flags.degradationPriority,15&d.flags.degradationPriority,(4278190080&d.compositionTimeOffset)>>>24,(16711680&d.compositionTimeOffset)>>>16,(65280&d.compositionTimeOffset)>>>8,255&d.compositionTimeOffset]);return n(E.trun,new Uint8Array(r))},e=function(e,t){var r,s,d,o;for(s=e.samples||[],t+=20+8*s.length,r=a(s,t),o=0;o<s.length;o++)d=s[o],r=r.concat([(4278190080&d.duration)>>>24,(16711680&d.duration)>>>16,(65280&d.duration)>>>8,255&d.duration,(4278190080&d.size)>>>24,(16711680&d.size)>>>16,(65280&d.size)>>>8,255&d.size]);return n(E.trun,new Uint8Array(r))},I=function(a,i){return"audio"===a.type?e(a,i):t(a,i)}}();var F={ftyp:d,mdat:o,moof:p,moov:m,initSegment:function(e){var t=d(),a=m(e),i;return i=new Uint8Array(t.byteLength+a.byteLength),i.set(t),i.set(a,t.byteLength),i}},G=function(){return{size:0,flags:{isLeading:0,dependsOn:1,isDependedOn:0,hasRedundancy:0,degradationPriority:0,isNonSyncSample:1}}},H=function(e,t){var a=G();return a.dataOffset=t,a.compositionTimeOffset=e.pts-e.dts,a.duration=e.duration,a.size=4*e.length,a.size+=e.byteLength,e.keyFrame&&(a.flags.dependsOn=2,a.flags.isNonSyncSample=0),a},W={groupNalsIntoFrames:function(e){var t=[],a=[],n,r;for(a.byteLength=0,a.nalCount=0,a.duration=0,t.byteLength=0,n=0;n<e.length;n++)r=e[n],"access_unit_delimiter_rbsp"===r.nalUnitType?(t.length&&(t.duration=r.dts-t.dts,a.byteLength+=t.byteLength,a.nalCount+=t.length,a.duration+=t.duration,a.push(t)),t=[r],t.byteLength=r.data.byteLength,t.pts=r.pts,t.dts=r.dts):("slice_layer_without_partitioning_rbsp_idr"===r.nalUnitType&&(t.keyFrame=!0),t.duration=r.dts-t.dts,t.byteLength+=r.data.byteLength,t.push(r));return a.length&&(!t.duration||0>=t.duration)&&(t.duration=a[a.length-1].duration),a.byteLength+=t.byteLength,a.nalCount+=t.length,a.duration+=t.duration,a.push(t),a},groupFramesIntoGops:function(e){var t=[],a=[],n,r;for(t.byteLength=0,t.nalCount=0,t.duration=0,t.pts=e[0].pts,t.dts=e[0].dts,a.byteLength=0,a.nalCount=0,a.duration=0,a.pts=e[0].pts,a.dts=e[0].dts,n=0;n<e.length;n++)r=e[n],r.keyFrame?(t.length&&(a.push(t),a.byteLength+=t.byteLength,a.nalCount+=t.nalCount,a.duration+=t.duration),t=[r],t.nalCount=r.length,t.byteLength=r.byteLength,t.pts=r.pts,t.dts=r.dts,t.duration=r.duration):(t.duration+=r.duration,t.nalCount+=r.length,t.byteLength+=r.byteLength,t.push(r));return a.length&&0>=t.duration&&(t.duration=a[a.length-1].duration),a.byteLength+=t.byteLength,a.nalCount+=t.nalCount,a.duration+=t.duration,a.push(t),a},extendFirstKeyFrame:function(e){var t;return!e[0][0].keyFrame&&1<e.length&&(t=e.shift(),e.byteLength-=t.byteLength,e.nalCount-=t.nalCount,e[0][0].dts=t.dts,e[0][0].pts=t.pts,e[0][0].duration+=t.duration),e},generateSampleTable:function(e,t){var a=t||0,n=[],r,s,d,o,l;for(r=0;r<e.length;r++)for(o=e[r],s=0;s<o.length;s++)l=o[s],d=H(l,a),a+=d.size,n.push(d);return n},concatenateNalData:function(e){var t=0,a=e.byteLength,n=e.nalCount,r=new Uint8Array(a+4*n),s=new DataView(r.buffer),d,o,l,u,p,m;for(d=0;d<e.length;d++)for(u=e[d],o=0;o<u.length;o++)for(p=u[o],l=0;l<p.length;l++)m=p[l],s.setUint32(t,m.data.byteLength),t+=4,r.set(m.data,t),t+=m.data.byteLength;return r},generateSampleTableForFrame:function(e,t){var a=[],i;return i=H(e,t||0),a.push(i),a},concatenateNalDataForFrame:function(e){var t=0,a=e.byteLength,n=e.length,r=new Uint8Array(a+4*n),s=new DataView(r.buffer),d,o;for(d=0;d<e.length;d++)o=e[d],s.setUint32(t,o.data.byteLength),t+=4,r.set(o.data,t),t+=o.data.byteLength;return r}},V=[33,16,5,32,164,27],z=[33,65,108,84,1,2,4,8,168,2,4,8,17,191,252],j=function(e){for(var t=[];e--;)t.push(0);return t},Y={96e3:[V,[227,64],j(154),[56]],88200:[V,[231],j(170),[56]],64e3:[V,[248,192],j(240),[56]],48e3:[V,[255,192],j(268),[55,148,128],j(54),[112]],44100:[V,[255,192],j(268),[55,163,128],j(84),[112]],32e3:[V,[255,192],j(268),[55,234],j(226),[112]],24e3:[V,[255,192],j(268),[55,255,128],j(268),[111,112],j(126),[224]],16e3:[V,[255,192],j(268),[55,255,128],j(268),[111,255],j(269),[223,108],j(195),[1,192]],12e3:[z,j(268),[3,127,248],j(268),[6,255,240],j(268),[13,255,224],j(268),[27,253,128],j(259),[56]],11025:[z,j(268),[3,127,248],j(268),[6,255,240],j(268),[13,255,224],j(268),[27,255,192],j(268),[55,175,128],j(108),[112]],8e3:[z,j(268),[3,121,16],j(47),[7]]},X=function(e){return Object.keys(e).reduce(function(t,a){return t[a]=new Uint8Array(e[a].reduce(function(e,t){return e.concat(t)},[])),t},{})}(Y),K=9e4,Q,J,Z,$,ee,te,ae;Q=function(e){return e*K},J=function(e,t){return e*t},Z=function(e){return e/K},$=function(e,t){return e/t},ee=function(e,t){return Q($(e,t))},te=function(e,t){return J(Z(e),t)},ae=function(e,t,a){return Z(a?e:e-t)};var ie={ONE_SECOND_IN_TS:K,secondsToVideoTs:Q,secondsToAudioTs:J,videoTsToSeconds:Z,audioTsToSeconds:$,audioTsToVideoTs:ee,videoTsToAudioTs:te,metadataTsToSeconds:ae},ne=function(e){var t=0,a,n;for(a=0;a<e.length;a++)n=e[a],t+=n.data.byteLength;return t},re={prefixWithSilence:function(e,t,a,n){var r=0,s=0,d=0,o=0,l,u,p,m;if(t.length&&(l=ie.audioTsToVideoTs(e.baseMediaDecodeTime,e.samplerate),r=Math.ceil(ie.ONE_SECOND_IN_TS/(e.samplerate/1024)),a&&n&&(s=l-Math.max(a,n),d=Math.floor(s/r),o=d*r),!(1>d||o>ie.ONE_SECOND_IN_TS/2))){for(u=X[e.samplerate],u||(u=t[0].data),p=0;p<d;p++)m=t[0],t.splice(0,0,{data:u,dts:m.dts-r,pts:m.pts-r});e.baseMediaDecodeTime-=Math.floor(ie.videoTsToAudioTs(o,e.samplerate))}},trimAdtsFramesByEarliestDts:function(e,t,a){return t.minSegmentDts>=a?e:(t.minSegmentDts=1/0,e.filter(function(e){return!!(e.dts>=a)&&(t.minSegmentDts=Math.min(t.minSegmentDts,e.dts),t.minSegmentPts=t.minSegmentDts,!0)}))},generateSampleTable:function(e){var t=[],a,n;for(a=0;a<e.length;a++)n=e[a],t.push({size:n.data.byteLength,duration:1024});return t},concatenateFrameData:function(e){var t=0,a=new Uint8Array(ne(e)),n,r;for(n=0;n<e.length;n++)r=e[n],a.set(r.data,t),t+=r.data.byteLength;return a}},se=ie.ONE_SECOND_IN_TS,de={clearDtsInfo:function(e){delete e.minSegmentDts,delete e.maxSegmentDts,delete e.minSegmentPts,delete e.maxSegmentPts},calculateTrackBaseMediaDecodeTime:function(e,t){var a=e.minSegmentDts,i,n;return t||(a-=e.timelineStartInfo.dts),i=e.timelineStartInfo.baseMediaDecodeTime,i+=a,i=Math.max(0,i),"audio"===e.type&&(n=e.samplerate/se,i*=n,i=Math.floor(i)),i},collectDtsInfo:function(e,t){"number"==typeof t.pts&&(e.timelineStartInfo.pts===void 0&&(e.timelineStartInfo.pts=t.pts),e.minSegmentPts=void 0===e.minSegmentPts?t.pts:Math.min(e.minSegmentPts,t.pts),e.maxSegmentPts=void 0===e.maxSegmentPts?t.pts:Math.max(e.maxSegmentPts,t.pts)),"number"==typeof t.dts&&(e.timelineStartInfo.dts===void 0&&(e.timelineStartInfo.dts=t.dts),e.minSegmentDts=void 0===e.minSegmentDts?t.dts:Math.min(e.minSegmentDts,t.dts),e.maxSegmentDts=void 0===e.maxSegmentDts?t.dts:Math.max(e.maxSegmentDts,t.dts))}},oe=4,le={parseSei:function(e){for(var t=0,a={payloadType:-1,payloadSize:0},n=0,r=0;t<e.byteLength&&e[t]!==128;){for(;255===e[t];)n+=255,t++;for(n+=e[t++];255===e[t];)r+=255,t++;if(r+=e[t++],!a.payload&&n===oe){a.payloadType=n,a.payloadSize=r,a.payload=e.subarray(t,t+r);break}t+=r,n=0,r=0}return a},parseUserData:function(e){return 181===e.payload[0]?49==(e.payload[1]<<8|e.payload[2])?"GA94"===String.fromCharCode(e.payload[3],e.payload[4],e.payload[5],e.payload[6])?3===e.payload[7]?e.payload.subarray(8,e.payload.length-1):null:null:null:null},parseCaptionPackets:function(e,t){var a=[],n,r,s,d;if(!(64&t[0]))return a;for(r=31&t[0],n=0;n<r;n++)s=3*n,d={type:3&t[s+2],pts:e},4&t[s+2]&&(d.ccData=t[s+3]<<8|t[s+4],a.push(d));return a},discardEmulationPreventionBytes:function(e){for(var t=e.byteLength,a=[],n=1,r,s;n<t-2;)0===e[n]&&0===e[n+1]&&3===e[n+2]?(a.push(n+2),n+=2):n++;if(0===a.length)return e;r=t-a.length,s=new Uint8Array(r);var d=0;for(n=0;n<r;d++,n++)d===a[0]&&(d++,a.shift()),s[n]=e[d];return s},USER_DATA_REGISTERED_ITU_T_T35:oe},ue=function e(){e.prototype.init.call(this),this.captionPackets_=[],this.ccStreams_=[new fe(0,0),new fe(0,1),new fe(1,0),new fe(1,1)],this.reset(),this.ccStreams_.forEach(function(e){e.on("data",this.trigger.bind(this,"data")),e.on("partialdone",this.trigger.bind(this,"partialdone")),e.on("done",this.trigger.bind(this,"done"))},this)};ue.prototype=new a,ue.prototype.push=function(e){var t,a,i;if("sei_rbsp"===e.nalUnitType)return(t=le.parseSei(e.escapedRBSP),t.payloadType===le.USER_DATA_REGISTERED_ITU_T_T35)?(a=le.parseUserData(t),a?e.dts<this.latestDts_?void(this.ignoreNextEqualDts_=!0):e.dts===this.latestDts_&&this.ignoreNextEqualDts_?(this.numSameDts_--,void(this.numSameDts_||(this.ignoreNextEqualDts_=!1))):void(i=le.parseCaptionPackets(e.pts,a),this.captionPackets_=this.captionPackets_.concat(i),this.latestDts_!==e.dts&&(this.numSameDts_=0),this.numSameDts_++,this.latestDts_=e.dts):void 0):void 0},ue.prototype.flushCCStreams=function(e){this.ccStreams_.forEach(function(t){return"flush"===e?t.flush():t.partialFlush()},this)},ue.prototype.flushStream=function(e){return this.captionPackets_.length?void(this.captionPackets_.forEach(function(e,t){e.presortIndex=t}),this.captionPackets_.sort(function(e,t){return e.pts===t.pts?e.presortIndex-t.presortIndex:e.pts-t.pts}),this.captionPackets_.forEach(function(e){2>e.type&&this.dispatchCea608Packet(e)},this),this.captionPackets_.length=0,this.flushCCStreams(e)):void this.flushCCStreams(e)},ue.prototype.flush=function(){return this.flushStream("flush")},ue.prototype.partialFlush=function(){return this.flushStream("partialFlush")},ue.prototype.reset=function(){this.latestDts_=null,this.ignoreNextEqualDts_=!1,this.numSameDts_=0,this.activeCea608Channel_=[null,null],this.ccStreams_.forEach(function(e){e.reset()})},ue.prototype.dispatchCea608Packet=function(e){this.setsTextOrXDSActive(e)?this.activeCea608Channel_[e.type]=null:this.setsChannel1Active(e)?this.activeCea608Channel_[e.type]=0:this.setsChannel2Active(e)&&(this.activeCea608Channel_[e.type]=1);null===this.activeCea608Channel_[e.type]||this.ccStreams_[(e.type<<1)+this.activeCea608Channel_[e.type]].push(e)},ue.prototype.setsChannel1Active=function(e){return 4096==(30720&e.ccData)},ue.prototype.setsChannel2Active=function(e){return 6144==(30720&e.ccData)},ue.prototype.setsTextOrXDSActive=function(e){return 256==(28928&e.ccData)||4138==(30974&e.ccData)||6186==(30974&e.ccData)};var pe={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,304:174,305:176,306:189,307:191,308:8482,309:162,310:163,311:9834,312:224,313:160,314:232,315:226,316:234,317:238,318:244,319:251,544:193,545:201,546:211,547:218,548:220,549:252,550:8216,551:161,552:42,553:39,554:8212,555:169,556:8480,557:8226,558:8220,559:8221,560:192,561:194,562:199,563:200,564:202,565:203,566:235,567:206,568:207,569:239,570:212,571:217,572:249,573:219,574:171,575:187,800:195,801:227,802:205,803:204,804:236,805:210,806:242,807:213,808:245,809:123,810:125,811:92,812:94,813:95,814:124,815:126,816:196,817:228,818:214,819:246,820:223,821:165,822:164,823:9474,824:197,825:229,826:216,827:248,828:9484,829:9488,830:9492,831:9496},me=function(e){return null===e?"":(e=pe[e]||e,String.fromCharCode(e))},ge=14,ce=[4352,4384,4608,4640,5376,5408,5632,5664,5888,5920,4096,4864,4896,5120,5152],ye=function(){for(var e=[],t=ge+1;t--;)e.push("");return e},fe=function e(t,a){e.prototype.init.call(this),this.field_=t||0,this.dataChannel_=a||0,this.name_="CC"+((this.field_<<1|this.dataChannel_)+1),this.setConstants(),this.reset(),this.push=function(e){var t,a,i,n,r;if(t=32639&e.ccData,t===this.lastControlCode_)return void(this.lastControlCode_=null);if(4096==(61440&t)?this.lastControlCode_=t:t!==this.PADDING_&&(this.lastControlCode_=null),i=t>>>8,n=255&t,t!==this.PADDING_)if(t===this.RESUME_CAPTION_LOADING_)this.mode_="popOn";else if(t===this.END_OF_CAPTION_)this.mode_="popOn",this.clearFormatting(e.pts),this.flushDisplayed(e.pts),a=this.displayed_,this.displayed_=this.nonDisplayed_,this.nonDisplayed_=a,this.startPts_=e.pts;else if(t===this.ROLL_UP_2_ROWS_)this.rollUpRows_=2,this.setRollUp(e.pts);else if(t===this.ROLL_UP_3_ROWS_)this.rollUpRows_=3,this.setRollUp(e.pts);else if(t===this.ROLL_UP_4_ROWS_)this.rollUpRows_=4,this.setRollUp(e.pts);else if(t===this.CARRIAGE_RETURN_)this.clearFormatting(e.pts),this.flushDisplayed(e.pts),this.shiftRowsUp_(),this.startPts_=e.pts;else if(t===this.BACKSPACE_)"popOn"===this.mode_?this.nonDisplayed_[this.row_]=this.nonDisplayed_[this.row_].slice(0,-1):this.displayed_[this.row_]=this.displayed_[this.row_].slice(0,-1);else if(t===this.ERASE_DISPLAYED_MEMORY_)this.flushDisplayed(e.pts),this.displayed_=ye();else if(t===this.ERASE_NON_DISPLAYED_MEMORY_)this.nonDisplayed_=ye();else if(t===this.RESUME_DIRECT_CAPTIONING_)"paintOn"!==this.mode_&&(this.flushDisplayed(e.pts),this.displayed_=ye()),this.mode_="paintOn",this.startPts_=e.pts;else if(this.isSpecialCharacter(i,n))i=(3&i)<<8,r=me(i|n),this[this.mode_](e.pts,r),this.column_++;else if(this.isExtCharacter(i,n))"popOn"===this.mode_?this.nonDisplayed_[this.row_]=this.nonDisplayed_[this.row_].slice(0,-1):this.displayed_[this.row_]=this.displayed_[this.row_].slice(0,-1),i=(3&i)<<8,r=me(i|n),this[this.mode_](e.pts,r),this.column_++;else if(this.isMidRowCode(i,n))this.clearFormatting(e.pts),this[this.mode_](e.pts," "),this.column_++,14==(14&n)&&this.addFormatting(e.pts,["i"]),1==(1&n)&&this.addFormatting(e.pts,["u"]);else if(this.isOffsetControlCode(i,n))this.column_+=3&n;else if(this.isPAC(i,n)){var s=ce.indexOf(7968&t);"rollUp"===this.mode_&&(0>s-this.rollUpRows_+1&&(s=this.rollUpRows_-1),this.setRollUp(e.pts,s)),s!==this.row_&&(this.clearFormatting(e.pts),this.row_=s),1&n&&-1===this.formatting_.indexOf("u")&&this.addFormatting(e.pts,["u"]),16==(16&t)&&(this.column_=4*((14&t)>>1)),this.isColorPAC(n)&&14==(14&n)&&this.addFormatting(e.pts,["i"])}else this.isNormalChar(i)&&(0===n&&(n=null),r=me(i),r+=me(n),this[this.mode_](e.pts,r),this.column_+=r.length)}};fe.prototype=new a,fe.prototype.flushDisplayed=function(e){var t=this.displayed_.map(function(e){try{return e.trim()}catch(t){return console.error("Skipping malformed caption."),""}}).join("\n").replace(/^\n+|\n+$/g,"");t.length&&this.trigger("data",{startPts:this.startPts_,endPts:e,text:t,stream:this.name_})},fe.prototype.reset=function(){this.mode_="popOn",this.topRow_=0,this.startPts_=0,this.displayed_=ye(),this.nonDisplayed_=ye(),this.lastControlCode_=null,this.column_=0,this.row_=ge,this.rollUpRows_=2,this.formatting_=[]},fe.prototype.setConstants=function(){0===this.dataChannel_?(this.BASE_=16,this.EXT_=17,this.CONTROL_=(20|this.field_)<<8,this.OFFSET_=23):1===this.dataChannel_&&(this.BASE_=24,this.EXT_=25,this.CONTROL_=(28|this.field_)<<8,this.OFFSET_=31),this.PADDING_=0,this.RESUME_CAPTION_LOADING_=32|this.CONTROL_,this.END_OF_CAPTION_=47|this.CONTROL_,this.ROLL_UP_2_ROWS_=37|this.CONTROL_,this.ROLL_UP_3_ROWS_=38|this.CONTROL_,this.ROLL_UP_4_ROWS_=39|this.CONTROL_,this.CARRIAGE_RETURN_=45|this.CONTROL_,this.RESUME_DIRECT_CAPTIONING_=41|this.CONTROL_,this.BACKSPACE_=33|this.CONTROL_,this.ERASE_DISPLAYED_MEMORY_=44|this.CONTROL_,this.ERASE_NON_DISPLAYED_MEMORY_=46|this.CONTROL_},fe.prototype.isSpecialCharacter=function(e,t){return e===this.EXT_&&48<=t&&63>=t},fe.prototype.isExtCharacter=function(e,t){return(e===this.EXT_+1||e===this.EXT_+2)&&32<=t&&63>=t},fe.prototype.isMidRowCode=function(e,t){return e===this.EXT_&&32<=t&&47>=t},fe.prototype.isOffsetControlCode=function(e,t){return e===this.OFFSET_&&33<=t&&35>=t},fe.prototype.isPAC=function(e,t){return e>=this.BASE_&&e<this.BASE_+8&&64<=t&&127>=t},fe.prototype.isColorPAC=function(e){return 64<=e&&79>=e||96<=e&&127>=e},fe.prototype.isNormalChar=function(e){return 32<=e&&127>=e},fe.prototype.setRollUp=function(e,t){if("rollUp"!==this.mode_&&(this.row_=ge,this.mode_="rollUp",this.flushDisplayed(e),this.nonDisplayed_=ye(),this.displayed_=ye()),void 0!==t&&t!==this.row_)for(var a=0;a<this.rollUpRows_;a++)this.displayed_[t-a]=this.displayed_[this.row_-a],this.displayed_[this.row_-a]="";void 0===t&&(t=this.row_),this.topRow_=t-this.rollUpRows_+1},fe.prototype.addFormatting=function(e,t){this.formatting_=this.formatting_.concat(t);var a=t.reduce(function(e,t){return e+"<"+t+">"},"");this[this.mode_](e,a)},fe.prototype.clearFormatting=function(e){if(this.formatting_.length){var t=this.formatting_.reverse().reduce(function(e,t){return e+"</"+t+">"},"");this.formatting_=[],this[this.mode_](e,t)}},fe.prototype.popOn=function(e,t){var a=this.nonDisplayed_[this.row_];a+=t,this.nonDisplayed_[this.row_]=a},fe.prototype.rollUp=function(e,t){var a=this.displayed_[this.row_];a+=t,this.displayed_[this.row_]=a},fe.prototype.shiftRowsUp_=function(){var e;for(e=0;e<this.topRow_;e++)this.displayed_[e]="";for(e=this.row_+1;e<ge+1;e++)this.displayed_[e]="";for(e=this.topRow_;e<this.row_;e++)this.displayed_[e]=this.displayed_[e+1];this.displayed_[this.row_]=""},fe.prototype.paintOn=function(e,t){var a=this.displayed_[this.row_];a+=t,this.displayed_[this.row_]=a};var _e={CaptionStream:ue,Cea608Stream:fe},he={H264_STREAM_TYPE:27,ADTS_STREAM_TYPE:15,METADATA_STREAM_TYPE:21},be="shared",Te=function(e,t){var a=1;for(e>t&&(a=-1);Math.abs(t-e)>4294967296;)e+=a*8589934592;return e},Se=function e(t){var a,i;e.prototype.init.call(this),this.type_=t||be,this.push=function(e){this.type_!==be&&e.type!==this.type_||(i===void 0&&(i=e.dts),e.dts=Te(e.dts,i),e.pts=Te(e.pts,i),a=e.dts,this.trigger("data",e))},this.flush=function(){i=a,this.trigger("done")},this.endTimeline=function(){this.flush(),this.trigger("endedtimeline")},this.discontinuity=function(){i=void 0,a=void 0},this.reset=function(){this.discontinuity(),this.trigger("reset")}};Se.prototype=new a;var ke=function(e,t,a){var n="",r;for(r=t;r<a;r++)n+="%"+("00"+e[r].toString(16)).slice(-2);return n},ve=function(e,t,a){return decodeURIComponent(ke(e,t,a))},Le=function(e,t,a){return unescape(ke(e,t,a))},Ie=function(e){return e[0]<<21|e[1]<<14|e[2]<<7|e[3]},Ee={TXXX:function(e){var t;if(3===e.data[0]){for(t=1;t<e.data.length;t++)if(0===e.data[t]){e.description=ve(e.data,1,t),e.value=ve(e.data,t+1,e.data.length).replace(/\0*$/,"");break}e.data=e.value}},WXXX:function(e){var t;if(3===e.data[0])for(t=1;t<e.data.length;t++)if(0===e.data[t]){e.description=ve(e.data,1,t),e.url=ve(e.data,t+1,e.data.length);break}},PRIV:function(e){var t;for(t=0;t<e.data.length;t++)if(0===e.data[t]){e.owner=Le(e.data,0,t);break}e.privateData=e.data.subarray(t+1),e.data=e.privateData}},Pe;Pe=function(e){var t={debug:!!(e&&e.debug),descriptor:e&&e.descriptor},a=0,n=[],r=0,s;if(Pe.prototype.init.call(this),this.dispatchType=he.METADATA_STREAM_TYPE.toString(16),t.descriptor)for(s=0;s<t.descriptor.length;s++)this.dispatchType+=("00"+t.descriptor[s].toString(16)).slice(-2);this.push=function(e){var s,o,l,u,p,m;if("timed-metadata"===e.type){if(e.dataAlignmentIndicator&&(r=0,n.length=0),0===n.length&&(10>e.data.length||73!==e.data[0]||68!==e.data[1]||51!==e.data[2]))return void(t.debug&&console.log("Skipping unrecognized metadata packet"));if(n.push(e),r+=e.data.byteLength,1===n.length&&(a=Ie(e.data.subarray(6,10)),a+=10),!(r<a)){for(s={data:new Uint8Array(a),frames:[],pts:n[0].pts,dts:n[0].dts},p=0;p<a;)s.data.set(n[0].data.subarray(0,a-p),p),p+=n[0].data.byteLength,r-=n[0].data.byteLength,n.shift();o=10,64&s.data[5]&&(o+=4,o+=Ie(s.data.subarray(10,14)),a-=Ie(s.data.subarray(16,20)));do{if(l=Ie(s.data.subarray(o+4,o+8)),1>l)return console.log("Malformed ID3 frame encountered. Skipping metadata parsing.");if(m=String.fromCharCode(s.data[o],s.data[o+1],s.data[o+2],s.data[o+3]),u={id:m,data:s.data.subarray(o+10,o+l+10)},u.key=u.id,Ee[u.id]&&(Ee[u.id](u),"com.apple.streaming.transportStreamTimestamp"===u.owner)){var g=u.data,d=(1&g[3])<<30|g[4]<<22|g[5]<<14|g[6]<<6|g[7]>>>2;d*=4,d+=3&g[7],u.timeStamp=d,void 0===s.pts&&void 0===s.dts&&(s.pts=u.timeStamp,s.dts=u.timeStamp),this.trigger("timestamp",u)}s.frames.push(u),o+=10,o+=l}while(o<a);this.trigger("data",s)}}}},Pe.prototype=new a;var Ue=Pe,Ce={TimestampRolloverStream:Se,handleRollover:Te}.TimestampRolloverStream,Oe=188,Re=71,De,Ae,xe;De=function(){var e=new Uint8Array(Oe),t=0;De.prototype.init.call(this),this.push=function(a){var i=0,n=Oe,r;for(t?(r=new Uint8Array(a.byteLength+t),r.set(e.subarray(0,t)),r.set(a,t),t=0):r=a;n<r.byteLength;){if(r[i]===Re&&r[n]===Re){this.trigger("data",r.subarray(i,n)),i+=Oe,n+=Oe;continue}i++,n++}i<r.byteLength&&(e.set(r.subarray(i),0),t=r.byteLength-i)},this.flush=function(){t===Oe&&e[0]===Re&&(this.trigger("data",e),t=0),this.trigger("done")},this.endTimeline=function(){this.flush(),this.trigger("endedtimeline")},this.reset=function(){t=0,this.trigger("reset")}},De.prototype=new a,Ae=function(){var e,t,a,i;Ae.prototype.init.call(this),i=this,this.packetsWaitingForPmt=[],this.programMapTable=void 0,e=function(e,i){var n=0;i.payloadUnitStartIndicator&&(n+=e[n]+1),"pat"===i.type?t(e.subarray(n),i):a(e.subarray(n),i)},t=function(e,t){t.section_number=e[7],t.last_section_number=e[8],i.pmtPid=(31&e[10])<<8|e[11],t.pmtPid=i.pmtPid},a=function(e,t){var a,n,r,s;if(1&e[5]){for(i.programMapTable={video:null,audio:null,"timed-metadata":{}},a=(15&e[1])<<8|e[2],n=3+a-4,r=(15&e[10])<<8|e[11],s=12+r;s<n;){var d=e[s],o=(31&e[s+1])<<8|e[s+2];d===he.H264_STREAM_TYPE&&null===i.programMapTable.video?i.programMapTable.video=o:d===he.ADTS_STREAM_TYPE&&null===i.programMapTable.audio?i.programMapTable.audio=o:d===he.METADATA_STREAM_TYPE&&(i.programMapTable["timed-metadata"][o]=d),s+=((15&e[s+3])<<8|e[s+4])+5}t.programMapTable=i.programMapTable}},this.push=function(t){var a={},i=4;if(a.payloadUnitStartIndicator=!!(64&t[1]),a.pid=31&t[1],a.pid<<=8,a.pid|=t[2],1<(48&t[3])>>>4&&(i+=t[i]+1),0===a.pid)a.type="pat",e(t.subarray(i),a),this.trigger("data",a);else if(a.pid===this.pmtPid)for(a.type="pmt",e(t.subarray(i),a),this.trigger("data",a);this.packetsWaitingForPmt.length;)this.processPes_.apply(this,this.packetsWaitingForPmt.shift());else void 0===this.programMapTable?this.packetsWaitingForPmt.push([t,i,a]):this.processPes_(t,i,a)},this.processPes_=function(e,t,a){a.streamType=a.pid===this.programMapTable.video?he.H264_STREAM_TYPE:a.pid===this.programMapTable.audio?he.ADTS_STREAM_TYPE:this.programMapTable["timed-metadata"][a.pid],a.type="pes",a.data=e.subarray(t),this.trigger("data",a)}},Ae.prototype=new a,Ae.STREAM_TYPES={h264:27,adts:15},xe=function(){var e=this,t={data:[],size:0},a={data:[],size:0},i={data:[],size:0},n=function(e,t){var a;t.packetLength=6+(e[4]<<8|e[5]),t.dataAlignmentIndicator=0!=(4&e[6]),a=e[7],192&a&&(t.pts=(14&e[9])<<27|(255&e[10])<<20|(254&e[11])<<12|(255&e[12])<<5|(254&e[13])>>>3,t.pts*=4,t.pts+=(6&e[13])>>>1,t.dts=t.pts,64&a&&(t.dts=(14&e[14])<<27|(255&e[15])<<20|(254&e[16])<<12|(255&e[17])<<5|(254&e[18])>>>3,t.dts*=4,t.dts+=(6&e[18])>>>1)),t.data=e.subarray(9+e[8])},r=function(t,a,r){var s=new Uint8Array(t.size),d={type:a},o=0,l=0,u=!1,p;if(t.data.length&&!(9>t.size)){for(d.trackId=t.data[0].pid,o=0;o<t.data.length;o++)p=t.data[o],s.set(p.data,l),l+=p.data.byteLength;n(s,d),u="video"===a||d.packetLength<=t.size,(r||u)&&(t.size=0,t.data.length=0),u&&e.trigger("data",d)}},s;xe.prototype.init.call(this),this.push=function(n){({pat:function(){},pes:function(){var e,s;switch(n.streamType){case he.H264_STREAM_TYPE:case he.H264_STREAM_TYPE:e=t,s="video";break;case he.ADTS_STREAM_TYPE:e=a,s="audio";break;case he.METADATA_STREAM_TYPE:e=i,s="timed-metadata";break;default:return;}n.payloadUnitStartIndicator&&r(e,s,!0),e.data.push(n),e.size+=n.data.byteLength},pmt:function(){var t={type:"metadata",tracks:[]};s=n.programMapTable,null!==s.video&&t.tracks.push({timelineStartInfo:{baseMediaDecodeTime:0},id:+s.video,codec:"avc",type:"video"}),null!==s.audio&&t.tracks.push({timelineStartInfo:{baseMediaDecodeTime:0},id:+s.audio,codec:"adts",type:"audio"}),e.trigger("data",t)}})[n.type]()},this.reset=function(){t.size=0,t.data.length=0,a.size=0,a.data.length=0,this.trigger("reset")},this.flushStreams_=function(){r(t,"video"),r(a,"audio"),r(i,"timed-metadata")},this.flush=function(){this.flushStreams_(),this.trigger("done")}},xe.prototype=new a;var Be={PAT_PID:0,MP2T_PACKET_LENGTH:Oe,TransportPacketStream:De,TransportParseStream:Ae,ElementaryStream:xe,TimestampRolloverStream:Ce,CaptionStream:_e.CaptionStream,Cea608Stream:_e.Cea608Stream,MetadataStream:Ue};for(var Me in he)he.hasOwnProperty(Me)&&(Be[Me]=he[Me]);var we=Be,Ne=ie.ONE_SECOND_IN_TS,qe=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350],Fe;Fe=function(e){var t=0,a;Fe.prototype.init.call(this),this.push=function(n){var r=0,s,d,o,l,u,p;if(e||(t=0),"audio"===n.type)for(a?(l=a,a=new Uint8Array(l.byteLength+n.data.byteLength),a.set(l),a.set(n.data,l.byteLength)):a=n.data;r+5<a.length;){if(255!==a[r]||240!=(246&a[r+1])){r++;continue}if(d=2*(1&~a[r+1]),s=(3&a[r+3])<<11|a[r+4]<<3|(224&a[r+5])>>5,u=1024*((3&a[r+6])+1),p=u*Ne/qe[(60&a[r+2])>>>2],o=r+s,a.byteLength<o)return;if(this.trigger("data",{pts:n.pts+t*p,dts:n.dts+t*p,sampleCount:u,audioobjecttype:(3&a[r+2]>>>6)+1,channelcount:(1&a[r+2])<<2|(192&a[r+3])>>>6,samplerate:qe[(60&a[r+2])>>>2],samplingfrequencyindex:(60&a[r+2])>>>2,samplesize:16,data:a.subarray(r+7+d,o)}),t++,a.byteLength===o)return void(a=void 0);a=a.subarray(o)}},this.flush=function(){t=0,this.trigger("done")},this.reset=function(){a=void 0,this.trigger("reset")},this.endTimeline=function(){a=void 0,this.trigger("endedtimeline")}},Fe.prototype=new a;var Ge=Fe,He;He=function(e){var t=e.byteLength,a=0,i=0;this.length=function(){return 8*t},this.bitsAvailable=function(){return 8*t+i},this.loadWord=function(){var n=e.byteLength-t,r=new Uint8Array(4),s=Math.min(4,t);if(0===s)throw new Error("no bytes available");r.set(e.subarray(n,n+s)),a=new DataView(r.buffer).getUint32(0),i=8*s,t-=s},this.skipBits=function(e){var n;i>e?(a<<=e,i-=e):(e-=i,n=Math.floor(e/8),e-=8*n,t-=n,this.loadWord(),a<<=e,i-=e)},this.readBits=function(e){var n=Math.min(i,e),r=a>>>32-n;return i-=n,0<i?a<<=n:0<t&&this.loadWord(),n=e-n,0<n?r<<n|this.readBits(n):r},this.skipLeadingZeros=function(){var e;for(e=0;e<i;++e)if(0!=(a&2147483648>>>e))return a<<=e,i-=e,e;return this.loadWord(),e+this.skipLeadingZeros()},this.skipUnsignedExpGolomb=function(){this.skipBits(1+this.skipLeadingZeros())},this.skipExpGolomb=function(){this.skipBits(1+this.skipLeadingZeros())},this.readUnsignedExpGolomb=function(){var e=this.skipLeadingZeros();return this.readBits(e+1)-1},this.readExpGolomb=function(){var e=this.readUnsignedExpGolomb();return 1&e?1+e>>>1:-1*(e>>>1)},this.readBoolean=function(){return 1===this.readBits(1)},this.readUnsignedByte=function(){return this.readBits(8)},this.loadWord()};var We=He,Ve,ze,je;ze=function(){var e=0,t,a;ze.prototype.init.call(this),this.push=function(i){var n;a?(n=new Uint8Array(a.byteLength+i.data.byteLength),n.set(a),n.set(i.data,a.byteLength),a=n):a=i.data;for(var r=a.byteLength;e<r-3;e++)if(1===a[e+2]){t=e+5;break}for(;t<r;)switch(a[t]){case 0:if(0!==a[t-1]){t+=2;break}else if(0!==a[t-2]){t++;break}e+3!==t-2&&this.trigger("data",a.subarray(e+3,t-2));do t++;while(1!==a[t]&&t<r);e=t-2,t+=3;break;case 1:if(0!==a[t-1]||0!==a[t-2]){t+=3;break}this.trigger("data",a.subarray(e+3,t-2)),e=t-2,t+=3;break;default:t+=3;}a=a.subarray(e),t-=e,e=0},this.reset=function(){a=null,e=0,this.trigger("reset")},this.flush=function(){a&&3<a.byteLength&&this.trigger("data",a.subarray(e+3)),a=null,e=0,this.trigger("done")},this.endTimeline=function(){this.flush(),this.trigger("endedtimeline")}},ze.prototype=new a,je={100:!0,110:!0,122:!0,244:!0,44:!0,83:!0,86:!0,118:!0,128:!0,138:!0,139:!0,134:!0},Ve=function(){var e=new ze,t,a,i,n,r,s,d;Ve.prototype.init.call(this),t=this,this.push=function(t){"video"!==t.type||(a=t.trackId,i=t.pts,n=t.dts,e.push(t))},e.on("data",function(e){var d={trackId:a,pts:i,dts:n,data:e};switch(31&e[0]){case 5:d.nalUnitType="slice_layer_without_partitioning_rbsp_idr";break;case 6:d.nalUnitType="sei_rbsp",d.escapedRBSP=r(e.subarray(1));break;case 7:d.nalUnitType="seq_parameter_set_rbsp",d.escapedRBSP=r(e.subarray(1)),d.config=s(d.escapedRBSP);break;case 8:d.nalUnitType="pic_parameter_set_rbsp";break;case 9:d.nalUnitType="access_unit_delimiter_rbsp";break;default:}t.trigger("data",d)}),e.on("done",function(){t.trigger("done")}),e.on("partialdone",function(){t.trigger("partialdone")}),e.on("reset",function(){t.trigger("reset")}),e.on("endedtimeline",function(){t.trigger("endedtimeline")}),this.flush=function(){e.flush()},this.partialFlush=function(){e.partialFlush()},this.reset=function(){e.reset()},this.endTimeline=function(){e.endTimeline()},d=function(e,t){var a=8,i=8,n,r;for(n=0;n<e;n++)0!==i&&(r=t.readExpGolomb(),i=(a+r+256)%256),a=0===i?a:i},r=function(e){for(var t=e.byteLength,a=[],n=1,r,s;n<t-2;)0===e[n]&&0===e[n+1]&&3===e[n+2]?(a.push(n+2),n+=2):n++;if(0===a.length)return e;r=t-a.length,s=new Uint8Array(r);var d=0;for(n=0;n<r;d++,n++)d===a[0]&&(d++,a.shift()),s[n]=e[d];return s},s=function(e){var t=0,a=0,n=0,r=0,s=1,o,l,u,p,m,g,c,y,f,_,h,b,T,S;if(o=new We(e),l=o.readUnsignedByte(),p=o.readUnsignedByte(),u=o.readUnsignedByte(),o.skipUnsignedExpGolomb(),je[l]&&(m=o.readUnsignedExpGolomb(),3===m&&o.skipBits(1),o.skipUnsignedExpGolomb(),o.skipUnsignedExpGolomb(),o.skipBits(1),o.readBoolean()))for(h=3===m?12:8,S=0;S<h;S++)o.readBoolean()&&(6>S?d(16,o):d(64,o));if(o.skipUnsignedExpGolomb(),g=o.readUnsignedExpGolomb(),0===g)o.readUnsignedExpGolomb();else if(1===g)for(o.skipBits(1),o.skipExpGolomb(),o.skipExpGolomb(),c=o.readUnsignedExpGolomb(),S=0;S<c;S++)o.skipExpGolomb();if(o.skipUnsignedExpGolomb(),o.skipBits(1),y=o.readUnsignedExpGolomb(),f=o.readUnsignedExpGolomb(),_=o.readBits(1),0===_&&o.skipBits(1),o.skipBits(1),o.readBoolean()&&(t=o.readUnsignedExpGolomb(),a=o.readUnsignedExpGolomb(),n=o.readUnsignedExpGolomb(),r=o.readUnsignedExpGolomb()),o.readBoolean()&&o.readBoolean()){switch(T=o.readUnsignedByte(),T){case 1:b=[1,1];break;case 2:b=[12,11];break;case 3:b=[10,11];break;case 4:b=[16,11];break;case 5:b=[40,33];break;case 6:b=[24,11];break;case 7:b=[20,11];break;case 8:b=[32,11];break;case 9:b=[80,33];break;case 10:b=[18,11];break;case 11:b=[15,11];break;case 12:b=[64,33];break;case 13:b=[160,99];break;case 14:b=[4,3];break;case 15:b=[3,2];break;case 16:b=[2,1];break;case 255:{b=[o.readUnsignedByte()<<8|o.readUnsignedByte(),o.readUnsignedByte()<<8|o.readUnsignedByte()];break}}b&&(s=b[0]/b[1])}return{profileIdc:l,levelIdc:u,profileCompatibility:p,width:Math.ceil((16*(y+1)-2*t-2*a)*s),height:16*((2-_)*(f+1))-2*n-2*r,sarRatio:b}}},Ve.prototype=new a;var Ye={H264Stream:Ve,NalByteStream:ze},Xe=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350],Ke=function(e){return e[0]<<21|e[1]<<14|e[2]<<7|e[3]},Qe=function(e,t,a){var n="",r;for(r=t;r<a;r++)n+="%"+("00"+e[r].toString(16)).slice(-2);return n},Je=function(e,t,a){return unescape(Qe(e,t,a))},Ze={isLikelyAacData:function(e){return!(73!==e[0]||68!==e[1]||51!==e[2])},parseId3TagSize:function(e,t){var a=e[t+6]<<21|e[t+7]<<14|e[t+8]<<7|e[t+9],i=e[t+5];return(16&i)>>4?a+20:a+10},parseAdtsSize:function(e,t){var a=(224&e[t+5])>>5,i=e[t+4]<<3,n=e[t+3]&6144;return n|i|a},parseType:function(e,t){if(e[t]===73&&e[t+1]===68&&e[t+2]===51)return"timed-metadata";return!0&e[t]&&240==(240&e[t+1])?"audio":null},parseSampleRate:function(e){for(var t=0;t+5<e.length;){if(255!==e[t]||240!=(246&e[t+1])){t++;continue}return Xe[(60&e[t+2])>>>2]}return null},parseAacTimestamp:function(e){var t,a,n,r;t=10,64&e[5]&&(t+=4,t+=Ke(e.subarray(10,14)));do{if(a=Ke(e.subarray(t+4,t+8)),1>a)return null;if(r=String.fromCharCode(e[t],e[t+1],e[t+2],e[t+3]),"PRIV"===r){n=e.subarray(t+10,t+a+10);for(var s=0;s<n.byteLength;s++)if(0===n[s]){var o=Je(n,0,s);if("com.apple.streaming.transportStreamTimestamp"===o){var l=n.subarray(s+1),d=(1&l[3])<<30|l[4]<<22|l[5]<<14|l[6]<<6|l[7]>>>2;return d*=4,d+=3&l[7],d}break}}t+=10,t+=a}while(t<e.byteLength);return null}},$e;$e=function(){var e=new Uint8Array,t=0;$e.prototype.init.call(this),this.setTimestamp=function(e){t=e},this.push=function(a){var i=0,n=0,r,s,d,o;for(e.length?(o=e.length,e=new Uint8Array(a.byteLength+o),e.set(e.subarray(0,o)),e.set(a,o)):e=a;3<=e.length-n;){if(73===e[n]&&68===e[n+1]&&51===e[n+2]){if(10>e.length-n)break;if(i=Ze.parseId3TagSize(e,n),n+i>e.length)break;s={type:"timed-metadata",data:e.subarray(n,n+i)},this.trigger("data",s),n+=i;continue}else if(255==(255&e[n])&&240==(240&e[n+1])){if(7>e.length-n)break;if(i=Ze.parseAdtsSize(e,n),n+i>e.length)break;d={type:"audio",data:e.subarray(n,n+i),pts:t,dts:t},this.trigger("data",d),n+=i;continue}n++}r=e.length-n,e=0<r?e.subarray(n):new Uint8Array},this.reset=function(){e=new Uint8Array,this.trigger("reset")},this.endTimeline=function(){e=new Uint8Array,this.trigger("endedtimeline")}},$e.prototype=new a;var et=$e,tt=Ye.H264Stream,at=Ze.isLikelyAacData,it=ie.ONE_SECOND_IN_TS,nt=["audioobjecttype","channelcount","samplerate","samplingfrequencyindex","samplesize"],rt=["width","height","profileIdc","levelIdc","profileCompatibility","sarRatio"],st=function(e,t){var a;if(e.length!==t.length)return!1;for(a=0;a<e.length;a++)if(e[a]!==t[a])return!1;return!0},dt=function(e,t,a,i,n,r){return{start:{dts:e,pts:e+(a-t)},end:{dts:e+(i-t),pts:e+(n-a)},prependedContentDuration:r,baseMediaDecodeTime:e}},ot,lt,ut,pt;lt=function(e,t){var a=[],i=0,n=0,r=0,s=1/0;t=t||{},lt.prototype.init.call(this),this.push=function(t){de.collectDtsInfo(e,t),e&&nt.forEach(function(a){e[a]=t[a]}),a.push(t)},this.setEarliestDts=function(t){n=t-e.timelineStartInfo.baseMediaDecodeTime},this.setVideoBaseMediaDecodeTime=function(e){s=e},this.setAudioAppendStart=function(e){r=e},this.flush=function(){var d,o,l,u,p;return 0===a.length?void this.trigger("done","AudioSegmentStream"):void(d=re.trimAdtsFramesByEarliestDts(a,e,n),e.baseMediaDecodeTime=de.calculateTrackBaseMediaDecodeTime(e,t.keepOriginalTimestamps),re.prefixWithSilence(e,d,r,s),e.samples=re.generateSampleTable(d),l=F.mdat(re.concatenateFrameData(d)),a=[],o=F.moof(i,[e]),u=new Uint8Array(o.byteLength+l.byteLength),i++,u.set(o),u.set(l,o.byteLength),de.clearDtsInfo(e),p=Math.ceil(1024*it/e.samplerate),d.length&&this.trigger("timingInfo",{start:d[0].dts,end:d[0].dts+d.length*p}),this.trigger("data",{track:e,boxes:u}),this.trigger("done","AudioSegmentStream"))},this.reset=function(){de.clearDtsInfo(e),a=[],this.trigger("reset")}},lt.prototype=new a,ot=function(e,t){var a=0,i=[],n=[],r,s;t=t||{},ot.prototype.init.call(this),delete e.minPTS,this.gopCache_=[],this.push=function(t){de.collectDtsInfo(e,t),"seq_parameter_set_rbsp"!==t.nalUnitType||r||(r=t.config,e.sps=[t.data],rt.forEach(function(t){e[t]=r[t]},this)),"pic_parameter_set_rbsp"!==t.nalUnitType||s||(s=t.data,e.pps=[t.data]),i.push(t)},this.flush=function(){for(var r=0,s,d,o,l,u,p,m,g;i.length&&"access_unit_delimiter_rbsp"!==i[0].nalUnitType;)i.shift();if(0===i.length)return this.resetStream_(),void this.trigger("done","VideoSegmentStream");if(s=W.groupNalsIntoFrames(i),o=W.groupFramesIntoGops(s),o[0][0].keyFrame||(d=this.getGopForFusion_(i[0],e),d?(r=d.duration,o.unshift(d),o.byteLength+=d.byteLength,o.nalCount+=d.nalCount,o.pts=d.pts,o.dts=d.dts,o.duration+=d.duration):o=W.extendFirstKeyFrame(o)),n.length){var c;if(c=t.alignGopsAtEnd?this.alignGopsAtEnd_(o):this.alignGopsAtStart_(o),!c)return this.gopCache_.unshift({gop:o.pop(),pps:e.pps,sps:e.sps}),this.gopCache_.length=Math.min(6,this.gopCache_.length),i=[],this.resetStream_(),void this.trigger("done","VideoSegmentStream");de.clearDtsInfo(e),o=c}de.collectDtsInfo(e,o),e.samples=W.generateSampleTable(o),u=F.mdat(W.concatenateNalData(o)),e.baseMediaDecodeTime=de.calculateTrackBaseMediaDecodeTime(e,t.keepOriginalTimestamps),this.trigger("processedGopsInfo",o.map(function(e){return{pts:e.pts,dts:e.dts,byteLength:e.byteLength}})),m=o[0],g=o[o.length-1],this.trigger("segmentTimingInfo",dt(e.baseMediaDecodeTime,m.dts,m.pts,g.dts+g.duration,g.pts+g.duration,r)),this.trigger("timingInfo",{start:o[0].dts,end:o[o.length-1].dts+o[o.length-1].duration}),this.gopCache_.unshift({gop:o.pop(),pps:e.pps,sps:e.sps}),this.gopCache_.length=Math.min(6,this.gopCache_.length),i=[],this.trigger("baseMediaDecodeTime",e.baseMediaDecodeTime),this.trigger("timelineStartInfo",e.timelineStartInfo),l=F.moof(a,[e]),p=new Uint8Array(l.byteLength+u.byteLength),a++,p.set(l),p.set(u,l.byteLength),this.trigger("data",{track:e,boxes:p}),this.resetStream_(),this.trigger("done","VideoSegmentStream")},this.reset=function(){this.resetStream_(),i=[],this.gopCache_.length=0,n.length=0,this.trigger("reset")},this.resetStream_=function(){de.clearDtsInfo(e),r=void 0,s=void 0},this.getGopForFusion_=function(t){var a=1/0,n,r,s,d,o;for(o=0;o<this.gopCache_.length;o++)(d=this.gopCache_[o],s=d.gop,e.pps&&st(e.pps[0],d.pps[0])&&e.sps&&st(e.sps[0],d.sps[0]))&&(s.dts<e.timelineStartInfo.dts||(n=t.dts-s.dts-s.duration,-10000<=n&&45000>=n&&(!r||a>n)&&(r=d,a=n)));return r?r.gop:null},this.alignGopsAtStart_=function(e){var t,a,i,r,s,d,o,l;for(s=e.byteLength,d=e.nalCount,o=e.duration,t=a=0;t<n.length&&a<e.length&&(i=n[t],r=e[a],i.pts!==r.pts);){if(r.pts>i.pts){t++;continue}a++,s-=r.byteLength,d-=r.nalCount,o-=r.duration}return 0===a?e:a===e.length?null:(l=e.slice(a),l.byteLength=s,l.duration=o,l.nalCount=d,l.pts=l[0].pts,l.dts=l[0].dts,l)},this.alignGopsAtEnd_=function(e){var t,a,i,r,s,d;for(t=n.length-1,a=e.length-1,s=null,d=!1;0<=t&&0<=a;){if(i=n[t],r=e[a],i.pts===r.pts){d=!0;break}if(i.pts>r.pts){t--;continue}t===n.length-1&&(s=a),a--}if(!d&&null===s)return null;var o;if(o=d?a:s,0===o)return e;var l=e.slice(o),u=l.reduce(function(e,t){return e.byteLength+=t.byteLength,e.duration+=t.duration,e.nalCount+=t.nalCount,e},{byteLength:0,duration:0,nalCount:0});return l.byteLength=u.byteLength,l.duration=u.duration,l.nalCount=u.nalCount,l.pts=l[0].pts,l.dts=l[0].dts,l},this.alignGopsWith=function(e){n=e}},ot.prototype=new a,pt=function(e,t){this.numberOfTracks=0,this.metadataStream=t,e=e||{},this.remuxTracks=!("undefined"!=typeof e.remux)||!!e.remux,this.keepOriginalTimestamps=!("boolean"!=typeof e.keepOriginalTimestamps)&&e.keepOriginalTimestamps,this.pendingTracks=[],this.videoTrack=null,this.pendingBoxes=[],this.pendingCaptions=[],this.pendingMetadata=[],this.pendingBytes=0,this.emittedTracks=0,pt.prototype.init.call(this),this.push=function(e){return e.text?this.pendingCaptions.push(e):e.frames?this.pendingMetadata.push(e):void(this.pendingTracks.push(e.track),this.pendingBytes+=e.boxes.byteLength,"video"===e.track.type&&(this.videoTrack=e.track,this.pendingBoxes.push(e.boxes)),"audio"===e.track.type&&(this.audioTrack=e.track,this.pendingBoxes.unshift(e.boxes)))}},pt.prototype=new a,pt.prototype.flush=function(e){var t=0,a={captions:[],captionStreams:{},metadata:[],info:{}},n=0,r,s,d,o;if(this.pendingTracks.length<this.numberOfTracks){if("VideoSegmentStream"!==e&&"AudioSegmentStream"!==e)return;if(this.remuxTracks)return;if(0===this.pendingTracks.length)return this.emittedTracks++,void(this.emittedTracks>=this.numberOfTracks&&(this.trigger("done"),this.emittedTracks=0))}if(this.videoTrack?(n=this.videoTrack.timelineStartInfo.pts,rt.forEach(function(e){a.info[e]=this.videoTrack[e]},this)):this.audioTrack&&(n=this.audioTrack.timelineStartInfo.pts,nt.forEach(function(e){a.info[e]=this.audioTrack[e]},this)),this.videoTrack||this.audioTrack){for(a.type=1===this.pendingTracks.length?this.pendingTracks[0].type:"combined",this.emittedTracks+=this.pendingTracks.length,d=F.initSegment(this.pendingTracks),a.initSegment=new Uint8Array(d.byteLength),a.initSegment.set(d),a.data=new Uint8Array(this.pendingBytes),o=0;o<this.pendingBoxes.length;o++)a.data.set(this.pendingBoxes[o],t),t+=this.pendingBoxes[o].byteLength;for(o=0;o<this.pendingCaptions.length;o++)r=this.pendingCaptions[o],r.startTime=ie.metadataTsToSeconds(r.startPts,n,this.keepOriginalTimestamps),r.endTime=ie.metadataTsToSeconds(r.endPts,n,this.keepOriginalTimestamps),a.captionStreams[r.stream]=!0,a.captions.push(r);for(o=0;o<this.pendingMetadata.length;o++)s=this.pendingMetadata[o],s.cueTime=ie.metadataTsToSeconds(s.pts,n,this.keepOriginalTimestamps),a.metadata.push(s);for(a.metadata.dispatchType=this.metadataStream.dispatchType,this.pendingTracks.length=0,this.videoTrack=null,this.pendingBoxes.length=0,this.pendingCaptions.length=0,this.pendingBytes=0,this.pendingMetadata.length=0,this.trigger("data",a),o=0;o<a.captions.length;o++)r=a.captions[o],this.trigger("caption",r);for(o=0;o<a.metadata.length;o++)s=a.metadata[o],this.trigger("id3Frame",s)}this.emittedTracks>=this.numberOfTracks&&(this.trigger("done"),this.emittedTracks=0)},pt.prototype.setRemux=function(e){this.remuxTracks=e},ut=function(e){var t=this,a=!0,n,r;ut.prototype.init.call(this),e=e||{},this.baseMediaDecodeTime=e.baseMediaDecodeTime||0,this.transmuxPipeline_={},this.setupAacPipeline=function(){var a={};this.transmuxPipeline_=a,a.type="aac",a.metadataStream=new we.MetadataStream,a.aacStream=new et,a.audioTimestampRolloverStream=new we.TimestampRolloverStream("audio"),a.timedMetadataTimestampRolloverStream=new we.TimestampRolloverStream("timed-metadata"),a.adtsStream=new Ge,a.coalesceStream=new pt(e,a.metadataStream),a.headOfPipeline=a.aacStream,a.aacStream.pipe(a.audioTimestampRolloverStream).pipe(a.adtsStream),a.aacStream.pipe(a.timedMetadataTimestampRolloverStream).pipe(a.metadataStream).pipe(a.coalesceStream),a.metadataStream.on("timestamp",function(e){a.aacStream.setTimestamp(e.timeStamp)}),a.aacStream.on("data",function(i){"timed-metadata"!==i.type||a.audioSegmentStream||(r=r||{timelineStartInfo:{baseMediaDecodeTime:t.baseMediaDecodeTime},codec:"adts",type:"audio"},a.coalesceStream.numberOfTracks++,a.audioSegmentStream=new lt(r,e),a.audioSegmentStream.on("timingInfo",t.trigger.bind(t,"audioTimingInfo")),a.adtsStream.pipe(a.audioSegmentStream).pipe(a.coalesceStream)),t.trigger("trackinfo",{hasAudio:!!r,hasVideo:!!n})}),a.coalesceStream.on("data",this.trigger.bind(this,"data")),a.coalesceStream.on("done",this.trigger.bind(this,"done"))},this.setupTsPipeline=function(){var a={};this.transmuxPipeline_=a,a.type="ts",a.metadataStream=new we.MetadataStream,a.packetStream=new we.TransportPacketStream,a.parseStream=new we.TransportParseStream,a.elementaryStream=new we.ElementaryStream,a.timestampRolloverStream=new we.TimestampRolloverStream,a.adtsStream=new Ge,a.h264Stream=new tt,a.captionStream=new we.CaptionStream,a.coalesceStream=new pt(e,a.metadataStream),a.headOfPipeline=a.packetStream,a.packetStream.pipe(a.parseStream).pipe(a.elementaryStream).pipe(a.timestampRolloverStream),a.timestampRolloverStream.pipe(a.h264Stream),a.timestampRolloverStream.pipe(a.adtsStream),a.timestampRolloverStream.pipe(a.metadataStream).pipe(a.coalesceStream),a.h264Stream.pipe(a.captionStream).pipe(a.coalesceStream),a.elementaryStream.on("data",function(s){var d;if("metadata"===s.type){for(d=s.tracks.length;d--;)n||"video"!==s.tracks[d].type?r||"audio"!==s.tracks[d].type||(r=s.tracks[d],r.timelineStartInfo.baseMediaDecodeTime=t.baseMediaDecodeTime):(n=s.tracks[d],n.timelineStartInfo.baseMediaDecodeTime=t.baseMediaDecodeTime);n&&!a.videoSegmentStream&&(a.coalesceStream.numberOfTracks++,a.videoSegmentStream=new ot(n,e),a.videoSegmentStream.on("timelineStartInfo",function(e){r&&(r.timelineStartInfo=e,a.audioSegmentStream.setEarliestDts(e.dts))}),a.videoSegmentStream.on("processedGopsInfo",t.trigger.bind(t,"gopInfo")),a.videoSegmentStream.on("segmentTimingInfo",t.trigger.bind(t,"videoSegmentTimingInfo")),a.videoSegmentStream.on("baseMediaDecodeTime",function(e){r&&a.audioSegmentStream.setVideoBaseMediaDecodeTime(e)}),a.videoSegmentStream.on("timingInfo",t.trigger.bind(t,"videoTimingInfo")),a.h264Stream.pipe(a.videoSegmentStream).pipe(a.coalesceStream)),r&&!a.audioSegmentStream&&(a.coalesceStream.numberOfTracks++,a.audioSegmentStream=new lt(r,e),a.audioSegmentStream.on("timingInfo",t.trigger.bind(t,"audioTimingInfo")),a.adtsStream.pipe(a.audioSegmentStream).pipe(a.coalesceStream)),t.trigger("trackinfo",{hasAudio:!!r,hasVideo:!!n})}}),a.coalesceStream.on("data",this.trigger.bind(this,"data")),a.coalesceStream.on("id3Frame",function(e){e.dispatchType=a.metadataStream.dispatchType,t.trigger("id3Frame",e)}),a.coalesceStream.on("caption",this.trigger.bind(this,"caption")),a.coalesceStream.on("done",this.trigger.bind(this,"done"))},this.setBaseMediaDecodeTime=function(t){var a=this.transmuxPipeline_;e.keepOriginalTimestamps||(this.baseMediaDecodeTime=t),r&&(r.timelineStartInfo.dts=void 0,r.timelineStartInfo.pts=void 0,de.clearDtsInfo(r),!e.keepOriginalTimestamps&&(r.timelineStartInfo.baseMediaDecodeTime=t),a.audioTimestampRolloverStream&&a.audioTimestampRolloverStream.discontinuity()),n&&(a.videoSegmentStream&&(a.videoSegmentStream.gopCache_=[]),n.timelineStartInfo.dts=void 0,n.timelineStartInfo.pts=void 0,de.clearDtsInfo(n),a.captionStream.reset(),!e.keepOriginalTimestamps&&(n.timelineStartInfo.baseMediaDecodeTime=t)),a.timestampRolloverStream&&a.timestampRolloverStream.discontinuity()},this.setAudioAppendStart=function(e){r&&this.transmuxPipeline_.audioSegmentStream.setAudioAppendStart(e)},this.setRemux=function(t){var a=this.transmuxPipeline_;e.remux=t,a&&a.coalesceStream&&a.coalesceStream.setRemux(t)},this.alignGopsWith=function(e){n&&this.transmuxPipeline_.videoSegmentStream&&this.transmuxPipeline_.videoSegmentStream.alignGopsWith(e)},this.push=function(e){if(a){var t=at(e);t&&"aac"!==this.transmuxPipeline_.type?this.setupAacPipeline():!t&&"ts"!==this.transmuxPipeline_.type&&this.setupTsPipeline(),a=!1}this.transmuxPipeline_.headOfPipeline.push(e)},this.flush=function(){a=!0,this.transmuxPipeline_.headOfPipeline.flush()},this.endTimeline=function(){this.transmuxPipeline_.headOfPipeline.endTimeline()},this.reset=function(){this.transmuxPipeline_.headOfPipeline&&this.transmuxPipeline_.headOfPipeline.reset()},this.resetCaptions=function(){this.transmuxPipeline_.captionStream&&this.transmuxPipeline_.captionStream.reset()}},ut.prototype=new a;var mt={Transmuxer:ut,VideoSegmentStream:ot,AudioSegmentStream:lt,AUDIO_PROPERTIES:nt,VIDEO_PROPERTIES:rt,generateVideoSegmentTimingInfo:dt},gt=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},ct=function(){function e(e,t){for(var a=0,n;a<t.length;a++)n=t[a],n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}return function(t,a,i){return a&&e(t.prototype,a),i&&e(t,i),t}}(),yt=function(e,t){t.on("data",function(t){var a=t.initSegment;t.initSegment={data:a.buffer,byteOffset:a.byteOffset,byteLength:a.byteLength};var i=t.data;t.data=i.buffer,e.postMessage({action:"data",segment:t,byteOffset:i.byteOffset,byteLength:i.byteLength},[t.data])}),t.captionStream&&t.captionStream.on("data",function(t){e.postMessage({action:"caption",data:t})}),t.on("done",function(){e.postMessage({action:"done"})}),t.on("gopInfo",function(t){e.postMessage({action:"gopInfo",gopInfo:t})}),t.on("videoSegmentTimingInfo",function(t){e.postMessage({action:"videoSegmentTimingInfo",videoSegmentTimingInfo:t})})},ft=function(){function e(t,a){gt(this,e),this.options=a||{},this.self=t,this.init()}return ct(e,[{key:"init",value:function(){this.transmuxer&&this.transmuxer.dispose(),this.transmuxer=new mt.Transmuxer(this.options),yt(this.self,this.transmuxer)}},{key:"push",value:function(e){var t=new Uint8Array(e.data,e.byteOffset,e.byteLength);this.transmuxer.push(t)}},{key:"reset",value:function(){this.init()}},{key:"setTimestampOffset",value:function(e){var t=e.timestampOffset||0;this.transmuxer.setBaseMediaDecodeTime(Math.round(9e4*t))}},{key:"setAudioAppendStart",value:function(e){this.transmuxer.setAudioAppendStart(Math.ceil(9e4*e.appendStart))}},{key:"flush",value:function(){this.transmuxer.flush()}},{key:"resetCaptions",value:function(){this.transmuxer.resetCaptions()}},{key:"alignGopsWith",value:function(e){this.transmuxer.alignGopsWith(e.gopsToAlignWith.slice())}}]),e}(),_t=new function(e){e.onmessage=function(t){return"init"===t.data.action&&t.data.options?void(this.messageHandlers=new ft(e,t.data.options)):void(!this.messageHandlers&&(this.messageHandlers=new ft(e)),t.data&&t.data.action&&"init"!==t.data.action&&this.messageHandlers[t.data.action]&&this.messageHandlers[t.data.action](t.data))}}(e);return _t}()}),mt={videoCodec:"avc1",videoObjectTypeIndicator:".4d400d",audioProfile:"2"},gt=function(e){return e.map(function(e){return e.replace(/avc1\.(\d+)\.(\d+)/i,function(e,t,a){var i=("00"+(+t).toString(16)).slice(-2),n=("00"+(+a).toString(16)).slice(-2);return"avc1."+i+"00"+n})})},ct=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"",t={codecCount:0},a=void 0;return t.codecCount=e.split(",").length,t.codecCount=t.codecCount||2,a=/(^|\s|,)+(avc[13])([^ ,]*)/i.exec(e),a&&(t.videoCodec=a[2],t.videoObjectTypeIndicator=a[3]),t.audioProfile=/(^|\s|,)+mp4a.[0-9A-Fa-f]+\.([0-9A-Fa-f]+)/i.exec(e),t.audioProfile=t.audioProfile&&t.audioProfile[2],t},yt=function(e){return e.replace(/avc1\.(\d+)\.(\d+)/i,function(e){return gt([e])[0]})},ft=function(e,t,a){return e+"/"+t+"; codecs=\""+a.filter(function(e){return!!e}).join(", ")+"\""},_t=function(e){return e.segments&&e.segments.length&&e.segments[0].map?"mp4":"mp2t"},ht=function(e){var t=e.attributes||{};return t.CODECS?ct(t.CODECS):mt},bt=function(e,t){if(!e.mediaGroups.AUDIO||!t)return null;var a=e.mediaGroups.AUDIO[t];if(!a)return null;for(var i in a){var n=a[i];if(n.default&&n.playlists)return ct(n.playlists[0].attributes.CODECS).audioProfile}return null},Tt=function(e,a){var i=_t(a),n=ht(a),r=a.attributes||{},s=!0,d=!1;if(!a)return[];if(e.mediaGroups.AUDIO&&r.AUDIO){var o=e.mediaGroups.AUDIO[r.AUDIO];if(o)for(var l in d=!0,s=!1,o)if(!o[l].uri&&!o[l].playlists){s=!0;break}}d&&!n.audioProfile&&(!s&&(n.audioProfile=bt(e,r.AUDIO)),!n.audioProfile&&(t.log.warn("Multiple audio tracks present but no audio codec string is specified. Attempting to use the default audio codec (mp4a.40.2)"),n.audioProfile=mt.audioProfile));var u={};n.videoCodec&&(u.video=""+n.videoCodec+n.videoObjectTypeIndicator),n.audioProfile&&(u.audio="mp4a.40."+n.audioProfile);var p=ft("audio",i,[u.audio]),m=ft("video",i,[u.video]),g=ft("video",i,[u.video,u.audio]);return d?!s&&u.video?[m,p]:s||u.video?[g,p]:[p,p]:u.video?[g]:[p]},St=function(e){var t={type:"",parameters:{}},a=e.trim().split(";");return t.type=a.shift().trim(),a.forEach(function(e){var a=e.trim().split("=");if(1<a.length){var i=a[0].replace(/"/g,"").trim(),n=a[1].replace(/"/g,"").trim();t.parameters[i]=n}}),t},kt=function(e){return /mp4a\.\d+.\d+/i.test(e)},vt=function(e){return /avc1\.[\da-f]+/i.test(e)},Lt=function(e,t,a){if("undefined"==typeof t||null===t||!e.length)return[];var n=Math.ceil(9e4*(t-a+3)),r=void 0;for(r=0;r<e.length&&!(e[r].pts>n);r++);return e.slice(r)},It=function(e,t,a){if(!t.length)return e;if(a)return t.slice();var n=t[0].pts,r=0;for(r;r<e.length&&!(e[r].pts>=n);r++);return e.slice(0,r).concat(t)},Et=function(e,t,a,n){for(var r=Math.ceil(9e4*(t-n)),s=Math.ceil(9e4*(a-n)),d=e.slice(),o=e.length;o--&&!(e[o].pts<=s););if(-1===o)return d;for(var l=o+1;l--&&!(e[l].pts<=r););return l=Math.max(l,0),d.splice(l,o-l+1),d},Pt=function(e,a,i){var n=null,r=null,s=0,d=[],o=[];if(!e&&!a)return t.createTimeRange();if(!e)return a.buffered;if(!a)return e.buffered;if(i)return e.buffered;if(0===e.buffered.length&&0===a.buffered.length)return t.createTimeRange();for(var l=e.buffered,u=a.buffered,p=l.length;p--;)d.push({time:l.start(p),type:"start"}),d.push({time:l.end(p),type:"end"});for(p=u.length;p--;)d.push({time:u.start(p),type:"start"}),d.push({time:u.end(p),type:"end"});for(d.sort(function(e,t){return e.time-t.time}),p=0;p<d.length;p++)"start"===d[p].type?(s++,2===s&&(n=d[p].time)):"end"===d[p].type&&(s--,1===s&&(r=d[p].time)),null!==n&&null!==r&&(o.push([n,r]),n=null,r=null);return t.createTimeRanges(o)},Ut=9e4,Ct=function(e,t){var a=e.addSourceBuffer(t),i=Object.create(null);i.updating=!1,i.realBuffer_=a;var n=function(e){"function"==typeof a[e]?i[e]=function(){return a[e].apply(a,arguments)}:"undefined"==typeof i[e]&&Object.defineProperty(i,e,{get:function(){return a[e]},set:function(t){return a[e]=t}})};for(var r in a)n(r);return i},Ot=function(e){function a(e,i){P(this,a);var n=R(this,(a.__proto__||Object.getPrototypeOf(a)).call(this,t.EventTarget));n.timestampOffset_=0,n.pendingBuffers_=[],n.bufferUpdating_=!1,n.mediaSource_=e,n.codecs_=i,n.audioCodec_=null,n.videoCodec_=null,n.audioDisabled_=!1,n.appendAudioInitSegment_=!0,n.gopBuffer_=[],n.timeMapping_=0,n.safeAppend_=11<=t.browser.IE_VERSION;var r={remux:!1,alignGopsAtEnd:n.safeAppend_};return n.codecs_.forEach(function(e){kt(e)?n.audioCodec_=e:vt(e)&&(n.videoCodec_=e)}),n.transmuxer_=new pt,n.transmuxer_.postMessage({action:"init",options:r}),n.transmuxer_.onmessage=function(e){return"data"===e.data.action?n.data_(e):"done"===e.data.action?n.done_(e):"gopInfo"===e.data.action?n.appendGopInfo_(e):"videoSegmentTimingInfo"===e.data.action?n.videoSegmentTimingInfo_(e.data.videoSegmentTimingInfo):void 0},Object.defineProperty(n,"timestampOffset",{get:function(){return this.timestampOffset_},set:function(e){"number"==typeof e&&0<=e&&(this.timestampOffset_=e,this.appendAudioInitSegment_=!0,this.gopBuffer_.length=0,this.timeMapping_=0,this.transmuxer_.postMessage({action:"setTimestampOffset",timestampOffset:e}))}}),Object.defineProperty(n,"appendWindowStart",{get:function(){return(this.videoBuffer_||this.audioBuffer_).appendWindowStart},set:function(e){this.videoBuffer_&&(this.videoBuffer_.appendWindowStart=e),this.audioBuffer_&&(this.audioBuffer_.appendWindowStart=e)}}),Object.defineProperty(n,"updating",{get:function(){return!!(this.bufferUpdating_||!this.audioDisabled_&&this.audioBuffer_&&this.audioBuffer_.updating||this.videoBuffer_&&this.videoBuffer_.updating)}}),Object.defineProperty(n,"buffered",{get:function(){return Pt(this.videoBuffer_,this.audioBuffer_,this.audioDisabled_)}}),n}return O(a,e),U(a,[{key:"data_",value:function(e){var t=e.data.segment;return t.data=new Uint8Array(t.data,e.data.byteOffset,e.data.byteLength),t.initSegment=new Uint8Array(t.initSegment.data,t.initSegment.byteOffset,t.initSegment.byteLength),Ze(this,this.mediaSource_,t),void this.pendingBuffers_.push(t)}},{key:"done_",value:function(){return"closed"===this.mediaSource_.readyState?void(this.pendingBuffers_.length=0):void this.processPendingSegments_()}},{key:"videoSegmentTimingInfo_",value:function(e){var t={start:{decode:e.start.dts/Ut,presentation:e.start.pts/Ut},end:{decode:e.end.dts/Ut,presentation:e.end.pts/Ut},baseMediaDecodeTime:e.baseMediaDecodeTime/Ut};e.prependedContentDuration&&(t.prependedContentDuration=e.prependedContentDuration/Ut),this.trigger({type:"videoSegmentTimingInfo",videoSegmentTimingInfo:t})}},{key:"createRealSourceBuffers_",value:function(){var e=this,t=["audio","video"];t.forEach(function(a){if(e[a+"Codec_"]&&!e[a+"Buffer_"]){var i=null;if(e.mediaSource_[a+"Buffer_"])i=e.mediaSource_[a+"Buffer_"],i.updating=!1;else{var n=a+"/mp4;codecs=\""+e[a+"Codec_"]+"\"";i=Ct(e.mediaSource_.nativeMediaSource_,n),e.mediaSource_[a+"Buffer_"]=i}e[a+"Buffer_"]=i,["update","updatestart","updateend"].forEach(function(n){i.addEventListener(n,function(){if(!("audio"===a&&e.audioDisabled_)){"updateend"===n&&(e[a+"Buffer_"].updating=!1);var i=t.every(function(i){return!!("audio"===i&&e.audioDisabled_)||!(a!==i&&e[i+"Buffer_"]&&e[i+"Buffer_"].updating)});if(i)return e.trigger(n)}})})}})}},{key:"appendBuffer",value:function(e){if(this.bufferUpdating_=!0,this.audioBuffer_&&this.audioBuffer_.buffered.length){var t=this.audioBuffer_.buffered;this.transmuxer_.postMessage({action:"setAudioAppendStart",appendStart:t.end(t.length-1)})}this.videoBuffer_&&this.transmuxer_.postMessage({action:"alignGopsWith",gopsToAlignWith:Lt(this.gopBuffer_,this.mediaSource_.player_?this.mediaSource_.player_.currentTime():null,this.timeMapping_)}),this.transmuxer_.postMessage({action:"push",data:e.buffer,byteOffset:e.byteOffset,byteLength:e.byteLength},[e.buffer]),this.transmuxer_.postMessage({action:"flush"})}},{key:"appendGopInfo_",value:function(e){this.gopBuffer_=It(this.gopBuffer_,e.data.gopInfo,this.safeAppend_)}},{key:"remove",value:function(e,t){if(this.videoBuffer_&&(this.videoBuffer_.updating=!0,this.videoBuffer_.remove(e,t),this.gopBuffer_=Et(this.gopBuffer_,e,t,this.timeMapping_)),!this.audioDisabled_&&this.audioBuffer_&&(this.audioBuffer_.updating=!0,this.audioBuffer_.remove(e,t)),$e(e,t,this.metadataTrack_),this.inbandTextTracks_)for(var a in this.inbandTextTracks_)$e(e,t,this.inbandTextTracks_[a])}},{key:"processPendingSegments_",value:function(){var e={video:{segments:[],bytes:0},audio:{segments:[],bytes:0},captions:[],metadata:[]};if(!this.pendingBuffers_.length)return this.trigger("updateend"),void(this.bufferUpdating_=!1);e=this.pendingBuffers_.reduce(function(e,t){var a=t.type,i=t.data,n=t.initSegment;return e[a].segments.push(i),e[a].bytes+=i.byteLength,e[a].initSegment=n,t.captions&&(e.captions=e.captions.concat(t.captions)),t.info&&(e[a].info=t.info),t.metadata&&(e.metadata=e.metadata.concat(t.metadata)),e},e),this.videoBuffer_||this.audioBuffer_||(0===e.video.bytes&&(this.videoCodec_=null),0===e.audio.bytes&&(this.audioCodec_=null),this.createRealSourceBuffers_()),e.audio.info&&this.mediaSource_.trigger({type:"audioinfo",info:e.audio.info}),e.video.info&&this.mediaSource_.trigger({type:"videoinfo",info:e.video.info}),this.appendAudioInitSegment_&&(!this.audioDisabled_&&this.audioBuffer_&&(e.audio.segments.unshift(e.audio.initSegment),e.audio.bytes+=e.audio.initSegment.byteLength),this.appendAudioInitSegment_=!1);var t=!1;this.videoBuffer_&&e.video.bytes?(e.video.segments.unshift(e.video.initSegment),e.video.bytes+=e.video.initSegment.byteLength,this.concatAndAppendSegments_(e.video,this.videoBuffer_)):this.videoBuffer_&&(this.audioDisabled_||!this.audioBuffer_)&&(t=!0),at(this,e.captions,e.metadata),!this.audioDisabled_&&this.audioBuffer_&&this.concatAndAppendSegments_(e.audio,this.audioBuffer_),this.pendingBuffers_.length=0,t&&this.trigger("updateend"),this.bufferUpdating_=!1}},{key:"concatAndAppendSegments_",value:function(e,t){var a=0,i=void 0;if(e.bytes){i=new Uint8Array(e.bytes),e.segments.forEach(function(e){i.set(e,a),a+=e.byteLength});try{t.updating=!0,t.appendBuffer(i)}catch(e){this.mediaSource_.player_&&this.mediaSource_.player_.error({code:-3,type:"APPEND_BUFFER_ERR",message:e.message,originalError:e})}}}},{key:"abort",value:function(){this.videoBuffer_&&this.videoBuffer_.abort(),!this.audioDisabled_&&this.audioBuffer_&&this.audioBuffer_.abort(),this.transmuxer_&&this.transmuxer_.postMessage({action:"reset"}),this.pendingBuffers_.length=0,this.bufferUpdating_=!1}}]),a}(t.EventTarget),Rt=function(e){function a(){P(this,a);var e=R(this,(a.__proto__||Object.getPrototypeOf(a)).call(this)),i=void 0;for(i in e.nativeMediaSource_=new h.MediaSource,e.nativeMediaSource_)i in a.prototype||"function"!=typeof e.nativeMediaSource_[i]||(e[i]=e.nativeMediaSource_[i].bind(e.nativeMediaSource_));return e.duration_=NaN,Object.defineProperty(e,"duration",{get:function(){return this.duration_===1/0?this.duration_:this.nativeMediaSource_.duration},set:function(e){if(this.duration_=e,e!==1/0)return void(this.nativeMediaSource_.duration=e)}}),Object.defineProperty(e,"seekable",{get:function(){return this.duration_===1/0?t.createTimeRanges([[0,this.nativeMediaSource_.duration]]):this.nativeMediaSource_.seekable}}),Object.defineProperty(e,"readyState",{get:function(){return this.nativeMediaSource_.readyState}}),Object.defineProperty(e,"activeSourceBuffers",{get:function(){return this.activeSourceBuffers_}}),e.sourceBuffers=[],e.activeSourceBuffers_=[],e.updateActiveSourceBuffers_=function(){if(e.activeSourceBuffers_.length=0,1===e.sourceBuffers.length){var t=e.sourceBuffers[0];return t.appendAudioInitSegment_=!0,t.audioDisabled_=!t.audioCodec_,void e.activeSourceBuffers_.push(t)}for(var a=!1,n=!0,r=0,s;r<e.player_.audioTracks().length;r++)if(s=e.player_.audioTracks()[r],s.enabled&&"main"!==s.kind){a=!0,n=!1;break}e.sourceBuffers.forEach(function(t,i){if(t.appendAudioInitSegment_=!0,t.videoCodec_&&t.audioCodec_)t.audioDisabled_=a;else if(t.videoCodec_&&!t.audioCodec_)t.audioDisabled_=!0,n=!1;else if(!t.videoCodec_&&t.audioCodec_&&(t.audioDisabled_=i?n:!n,t.audioDisabled_))return;e.activeSourceBuffers_.push(t)})},e.onPlayerMediachange_=function(){e.sourceBuffers.forEach(function(e){e.appendAudioInitSegment_=!0})},e.onHlsReset_=function(){e.sourceBuffers.forEach(function(e){e.transmuxer_&&e.transmuxer_.postMessage({action:"resetCaptions"})})},e.onHlsSegmentTimeMapping_=function(t){e.sourceBuffers.forEach(function(e){return e.timeMapping_=t.mapping})},["sourceopen","sourceclose","sourceended"].forEach(function(e){this.nativeMediaSource_.addEventListener(e,this.trigger.bind(this))},e),e.on("sourceopen",function(){var a=y.querySelector("[src=\""+e.url_+"\"]");a&&(e.player_=t(a.parentNode),e.player_&&(e.player_.tech_.on("hls-reset",e.onHlsReset_),e.player_.tech_.on("hls-segment-time-mapping",e.onHlsSegmentTimeMapping_),e.player_.audioTracks&&e.player_.audioTracks()&&(e.player_.audioTracks().on("change",e.updateActiveSourceBuffers_),e.player_.audioTracks().on("addtrack",e.updateActiveSourceBuffers_),e.player_.audioTracks().on("removetrack",e.updateActiveSourceBuffers_)),e.player_.on("mediachange",e.onPlayerMediachange_)))}),e.on("sourceended",function(){for(var t=tt(e.duration),a=0;a<e.sourceBuffers.length;a++){var n=e.sourceBuffers[a],r=n.metadataTrack_&&n.metadataTrack_.cues;r&&r.length&&(r[r.length-1].endTime=t)}}),e.on("sourceclose",function(){this.sourceBuffers.forEach(function(e){e.transmuxer_&&e.transmuxer_.terminate()}),this.sourceBuffers.length=0,this.player_&&(this.player_.audioTracks&&this.player_.audioTracks()&&(this.player_.audioTracks().off("change",this.updateActiveSourceBuffers_),this.player_.audioTracks().off("addtrack",this.updateActiveSourceBuffers_),this.player_.audioTracks().off("removetrack",this.updateActiveSourceBuffers_)),this.player_.el_&&this.player_.off("mediachange",this.onPlayerMediachange_),this.player_.tech_&&this.player_.tech_.el_&&(this.player_.tech_.off("hls-reset",this.onHlsReset_),this.player_.tech_.off("hls-segment-time-mapping",this.onHlsSegmentTimeMapping_)))}),e}return O(a,e),U(a,[{key:"addSeekableRange_",value:function(e,t){var a;if(this.duration!==1/0)throw a=new Error("MediaSource.addSeekableRange() can only be invoked when the duration is Infinity"),a.name="InvalidStateError",a.code=11,a;(t>this.nativeMediaSource_.duration||isNaN(this.nativeMediaSource_.duration))&&(this.nativeMediaSource_.duration=t)}},{key:"addSourceBuffer",value:function(e){var t=void 0,a=St(e);if(/^(video|audio)\/mp2t$/i.test(a.type)){var i=[];a.parameters&&a.parameters.codecs&&(i=a.parameters.codecs.split(","),i=gt(i),i=i.filter(function(e){return kt(e)||vt(e)})),0===i.length&&(i=["avc1.4d400d","mp4a.40.2"]),t=new Ot(this,i),0!==this.sourceBuffers.length&&(this.sourceBuffers[0].createRealSourceBuffers_(),t.createRealSourceBuffers_(),this.sourceBuffers[0].audioDisabled_=!0)}else t=this.nativeMediaSource_.addSourceBuffer(e);return this.sourceBuffers.push(t),t}}]),a}(t.EventTarget),Dt=0;t.mediaSources={};var At=function(e,a){var i=t.mediaSources[e];if(i)i.trigger({type:"sourceopen",swfId:a});else throw new Error("Media Source not found (Video.js)")},xt=function(){return!!h.MediaSource&&!!h.MediaSource.isTypeSupported&&h.MediaSource.isTypeSupported("video/mp4;codecs=\"avc1.4d400d,mp4a.40.2\"")},Bt=function(){if(this.MediaSource={open:At,supportsNativeMediaSources:xt},xt())return new Rt;throw new Error("Cannot use create a virtual MediaSource for this video")};Bt.open=At,Bt.supportsNativeMediaSources=xt;var Mt={createObjectURL:function(e){var a=void 0;return e instanceof Rt?(a=h.URL.createObjectURL(e.nativeMediaSource_),e.url_=a,a):e instanceof Rt?(a="blob:vjs-media-source/"+Dt,Dt++,t.mediaSources[a]=e,a):(a=h.URL.createObjectURL(e),e.url_=a,a)}};t.MediaSource=Bt,t.URL=Mt;var wt=function(e){return!!e&&"object"==typeof e},Nt=function e(){for(var t=arguments.length,a=Array(t),i=0;i<t;i++)a[i]=arguments[i];return a.reduce(function(t,a){return Object.keys(a).forEach(function(i){t[i]=Array.isArray(t[i])&&Array.isArray(a[i])?t[i].concat(a[i]):wt(t[i])&&wt(a[i])?e(t[i],a[i]):a[i]}),t},{})},qt=function(e){return Object.keys(e).map(function(t){return e[t]})},Ft=function(e,t){for(var a=[],n=e;n<t;n++)a.push(n);return a},Gt=function(e){return e.reduce(function(e,t){return e.concat(t)},[])},Ht=function(e){if(!e.length)return[];for(var t=[],a=0;a<e.length;a++)t.push(e[a]);return t},Wt=function(e,t){return e.reduce(function(n,a,e){return a[t]&&n.push(e),n},[])},Vt={INVALID_NUMBER_OF_PERIOD:"INVALID_NUMBER_OF_PERIOD",DASH_EMPTY_MANIFEST:"DASH_EMPTY_MANIFEST",DASH_INVALID_XML:"DASH_INVALID_XML",NO_BASE_URL:"NO_BASE_URL",MISSING_SEGMENT_INFORMATION:"MISSING_SEGMENT_INFORMATION",SEGMENT_TIME_UNSPECIFIED:"SEGMENT_TIME_UNSPECIFIED",UNSUPPORTED_UTC_TIMING_SCHEME:"UNSUPPORTED_UTC_TIMING_SCHEME"},zt="undefined"==typeof window?"undefined"==typeof global?"undefined"==typeof self?{}:self:global:window,jt=function(e,t){return t={exports:{}},e(t,t.exports),t.exports}(function(e){(function(){var t=/^((?:[a-zA-Z0-9+\-.]+:)?)(\/\/[^\/?#]*)?((?:[^\/\?#]*\/)*.*?)??(;.*?)?(\?.*?)?(#.*?)?$/,a=/^([^\/?#]*)(.*)$/,i=/(?:\/|^)\.(?=\/)/g,n=/(?:\/|^)\.\.\/(?!\.\.\/).*?(?=\/)/g,r={buildAbsoluteURL:function(e,t,i){if(i=i||{},e=e.trim(),t=t.trim(),!t){if(!i.alwaysNormalize)return e;var n=r.parseURL(e);if(!n)throw new Error("Error trying to parse base URL.");return n.path=r.normalizePath(n.path),r.buildURLFromParts(n)}var s=r.parseURL(t);if(!s)throw new Error("Error trying to parse relative URL.");if(s.scheme)return i.alwaysNormalize?(s.path=r.normalizePath(s.path),r.buildURLFromParts(s)):t;var d=r.parseURL(e);if(!d)throw new Error("Error trying to parse base URL.");if(!d.netLoc&&d.path&&"/"!==d.path[0]){var o=a.exec(d.path);d.netLoc=o[1],d.path=o[2]}d.netLoc&&!d.path&&(d.path="/");var l={scheme:d.scheme,netLoc:s.netLoc,path:null,params:s.params,query:s.query,fragment:s.fragment};if(!s.netLoc&&(l.netLoc=d.netLoc,"/"!==s.path[0]))if(!s.path)l.path=d.path,s.params||(l.params=d.params,!s.query&&(l.query=d.query));else{var u=d.path,p=u.substring(0,u.lastIndexOf("/")+1)+s.path;l.path=r.normalizePath(p)}return null===l.path&&(l.path=i.alwaysNormalize?r.normalizePath(s.path):s.path),r.buildURLFromParts(l)},parseURL:function(e){var a=t.exec(e);return a?{scheme:a[1]||"",netLoc:a[2]||"",path:a[3]||"",params:a[4]||"",query:a[5]||"",fragment:a[6]||""}:null},normalizePath:function(e){for(e=e.split("").reverse().join("").replace(i,"");e.length!==(e=e.replace(n,"")).length;);return e.split("").reverse().join("")},buildURLFromParts:function(e){return e.scheme+e.netLoc+e.path+e.params+e.query+e.fragment}};e.exports=r})(zt)}),Yt=function(e,t){return /^[a-z]+:/i.test(t)?t:(/\/\//i.test(e)||(e=jt.buildAbsoluteURL(h.location.href,e)),jt.buildAbsoluteURL(e,t))},Xt=function(e){var t=e.baseUrl,a=void 0===t?"":t,i=e.source,n=void 0===i?"":i,r=e.range,s=void 0===r?"":r,d=e.indexRange,o=void 0===d?"":d,l={uri:n,resolvedUri:Yt(a||"",n)};if(s||o){var u=s?s:o,p=u.split("-"),m=parseInt(p[0],10),g=parseInt(p[1],10);l.byterange={length:g-m+1,offset:m}}return l},Kt=function(e){var t=e.offset+e.length-1;return e.offset+"-"+t},Qt={static:function(e){var t=e.duration,a=e.timescale,i=void 0===a?1:a,n=e.sourceDuration;return{start:0,end:Math.ceil(n/(t/i))}},dynamic:function(e){var t=e.NOW,a=e.clientOffset,i=e.availabilityStartTime,n=e.timescale,r=void 0===n?1:n,s=e.duration,d=e.start,o=void 0===d?0:d,l=e.minimumUpdatePeriod,u=void 0===l?0:l,p=e.timeShiftBufferDepth,m=void 0===p?1/0:p,g=(t+a)/1e3,c=i+o,y=Math.ceil((g+u-c)*r/s),f=Math.floor((g-c-m)*r/s),_=Math.floor((g-c)*r/s);return{start:Math.max(0,f),end:Math.min(y,_)}}},Jt=function(e){return function(t,a){var i=e.duration,n=e.timescale,r=void 0===n?1:n,s=e.periodIndex,d=e.startNumber,o=void 0===d?1:d;return{number:o+t,duration:i/r,timeline:s,time:a*i}}},Zt=function(e){var t=e.type,a=void 0===t?"static":t,i=e.duration,n=e.timescale,r=void 0===n?1:n,s=e.sourceDuration,d=Qt[a](e),o=d.start,l=d.end,u=Ft(o,l).map(Jt(e));if("static"===a){var p=u.length-1;u[p].duration=s-i/r*p}return u},$t=function(e){var t=e.baseUrl,a=e.initialization,i=void 0===a?{}:a,n=e.sourceDuration,r=e.timescale,s=void 0===r?1:r,d=e.indexRange,o=void 0===d?"":d,l=e.duration;if(!t)throw new Error(Vt.NO_BASE_URL);var u=Xt({baseUrl:t,source:i.sourceURL,range:i.range}),p=Xt({baseUrl:t,source:t,indexRange:o});if(p.map=u,l){var m=Zt(e);m.length&&(p.duration=m[0].duration,p.timeline=m[0].timeline)}else n&&(p.duration=n/s,p.timeline=0);return p.number=0,[p]},ea=function(e,t,a){for(var n=e.sidx.map?e.sidx.map:null,r=e.sidx.duration,s=e.timeline||0,d=e.sidx.byterange,o=d.offset+d.length,l=t.timescale,u=t.references.filter(function(e){return 1!==e.referenceType}),p=[],m=o+t.firstOffset,g=0;g<u.length;g++){var c=t.references[g],y=c.referencedSize,f=c.subsegmentDuration,_=m+y-1,h=m+"-"+_,b=$t({baseUrl:a,timescale:l,timeline:s,periodIndex:s,duration:f,sourceDuration:r,indexRange:h})[0];n&&(b.map=n),p.push(b),m+=y}return e.segments=p,e},ta=function(e){var t=qt(e.reduce(function(e,t){var a=t.attributes.id+(t.attributes.lang||"");if(e[a]){var i;t.segments[0]&&(t.segments[0].discontinuity=!0),(i=e[a].segments).push.apply(i,t.segments),t.attributes.contentProtection&&(e[a].attributes.contentProtection=t.attributes.contentProtection)}else e[a]=t;return e},{}));return t.map(function(e){return e.discontinuityStarts=Wt(e.segments,"discontinuity"),e})},aa=function(e,t){if(void 0===t&&(t={}),!Object.keys(t).length)return e;for(var a in e){var i=e[a];if(i.sidx){var n=i.sidx.uri+"-"+Kt(i.sidx.byterange),r=t[n]&&t[n].sidx;i.sidx&&r&&ea(i,r,i.sidx.resolvedUri)}}return e},ia=function(e){var t=e.attributes,a=e.segments,i=e.sidx,n={attributes:(r={NAME:t.id,BANDWIDTH:t.bandwidth,CODECS:t.codecs},r["PROGRAM-ID"]=1,r),uri:"",endList:"static"===(t.type||"static"),timeline:t.periodIndex,resolvedUri:"",targetDuration:t.duration,segments:a,mediaSequence:a.length?a[0].number:1},r;return t.contentProtection&&(n.contentProtection=t.contentProtection),i&&(n.sidx=i),n},na=function(e){var t=e.attributes,a=e.segments,i;return"undefined"==typeof a&&(a=[{uri:t.baseUrl,timeline:t.periodIndex,resolvedUri:t.baseUrl||"",duration:t.sourceDuration,number:0}],t.duration=t.sourceDuration),{attributes:(i={NAME:t.id,BANDWIDTH:t.bandwidth},i["PROGRAM-ID"]=1,i),uri:"",endList:"static"===(t.type||"static"),timeline:t.periodIndex,resolvedUri:t.baseUrl||"",targetDuration:t.duration,segments:a,mediaSequence:a.length?a[0].number:1}},ra=function(e,t){void 0===t&&(t={});var a=e.reduce(function(e,a){var n=a.attributes.role&&a.attributes.role.value||"",r=a.attributes.lang||"",s="main";if(r){var d=n?" ("+n+")":"";s=""+a.attributes.lang+d}return e[s]&&e[s].playlists[0].attributes.BANDWIDTH>a.attributes.bandwidth?e:(e[s]={language:r,autoselect:!0,default:"main"===n,playlists:aa([ia(a)],t),uri:""},"undefined"==typeof i&&"main"===n&&(i=a,i.default=!0),e)},{}),i;if(!i){var n=Object.keys(a)[0];a[n].default=!0}return a},sa=function(e,t){return void 0===t&&(t={}),e.reduce(function(e,a){var i=a.attributes.lang||"text";return e[i]?e:(e[i]={language:i,default:!1,autoselect:!1,playlists:aa([na(a)],t),uri:""},e)},{})},da=function(e){var t=e.attributes,a=e.segments,i=e.sidx,n={attributes:(r={NAME:t.id,AUDIO:"audio",SUBTITLES:"subs",RESOLUTION:{width:t.width,height:t.height},CODECS:t.codecs,BANDWIDTH:t.bandwidth},r["PROGRAM-ID"]=1,r),uri:"",endList:"static"===(t.type||"static"),timeline:t.periodIndex,resolvedUri:"",targetDuration:t.duration,segments:a,mediaSequence:a.length?a[0].number:1},r;return t.contentProtection&&(n.contentProtection=t.contentProtection),i&&(n.sidx=i),n},oa=function(e,t){var a;if(void 0===t&&(t={}),!e.length)return{};var i=e[0].attributes,n=i.sourceDuration,r=i.minimumUpdatePeriod,s=void 0===r?0:r,d=ta(e.filter(function(e){var t=e.attributes;return"video/mp4"===t.mimeType||"video"===t.contentType})).map(da),o=ta(e.filter(function(e){var t=e.attributes;return"audio/mp4"===t.mimeType||"audio"===t.contentType})),l=e.filter(function(e){var t=e.attributes;return"text/vtt"===t.mimeType||"text"===t.contentType}),u={allowCache:!0,discontinuityStarts:[],segments:[],endList:!0,mediaGroups:(a={AUDIO:{},VIDEO:{}},a["CLOSED-CAPTIONS"]={},a.SUBTITLES={},a),uri:"",duration:n,playlists:aa(d,t),minimumUpdatePeriod:1e3*s};return o.length&&(u.mediaGroups.AUDIO.audio=ra(o,t)),l.length&&(u.mediaGroups.SUBTITLES.subs=sa(l,t)),u},la=function(e,t,a){var i=e.NOW,n=e.clientOffset,r=e.availabilityStartTime,s=e.timescale,d=void 0===s?1:s,o=e.start,l=void 0===o?0:o,u=e.minimumUpdatePeriod,p=void 0===u?0:u;return Math.ceil((((i+n)/1e3+p-(r+l))*d-t)/a)},ua=function(e,t){for(var a=e.type,i=void 0===a?"static":a,n=e.minimumUpdatePeriod,r=void 0===n?0:n,s=e.media,d=void 0===s?"":s,o=e.sourceDuration,l=e.timescale,u=void 0===l?1:l,p=e.startNumber,m=void 0===p?1:p,g=e.periodIndex,c=[],y=-1,f=0;f<t.length;f++){var _=t[f],h=_.d,b=_.r||0,T=_.t||0;0>y&&(y=T),T&&T>y&&(y=T);var S=void 0;if(0>b){var k=f+1;S=k===t.length?"dynamic"===i&&0<r&&0<d.indexOf("$Number$")?la(e,y,h):(o*u-y)/h:(t[k].t-y)/h}else S=b+1;for(var v=m+c.length+S,L=m+c.length;L<v;)c.push({number:L,duration:h/u,time:y,timeline:g}),y+=h,L++}return c},pa=/\$([A-z]*)(?:(%0)([0-9]+)d)?\$/g,ma=function(e){return function(t,a,i,n){if("$$"===t)return"$";if("undefined"==typeof e[a])return t;var r=""+e[a];return"RepresentationID"===a?r:(n=i?parseInt(n,10):1,r.length>=n?r:""+Array(n-r.length+1).join("0")+r)}},ga=function(e,t){return e.replace(pa,ma(t))},ca=function(e,t){return e.duration||t?e.duration?Zt(e):ua(e,t):[{number:e.startNumber||1,duration:e.sourceDuration,time:0,timeline:e.periodIndex}]},ya=function(e,t){var a={RepresentationID:e.id,Bandwidth:e.bandwidth||0},i=e.initialization,n=void 0===i?{sourceURL:"",range:""}:i,r=Xt({baseUrl:e.baseUrl,source:ga(n.sourceURL,a),range:n.range}),s=ca(e,t);return s.map(function(t){a.Number=t.number,a.Time=t.time;var i=ga(e.media||"",a);return{uri:i,timeline:t.timeline,duration:t.duration,resolvedUri:Yt(e.baseUrl||"",i),map:r,number:t.number}})},fa=function(e,t){var a=e.baseUrl,i=e.initialization,n=void 0===i?{}:i,r=Xt({baseUrl:a,source:n.sourceURL,range:n.range}),s=Xt({baseUrl:a,source:t.media,range:t.mediaRange});return s.map=r,s},_a=function(e,t){var a=e.duration,i=e.segmentUrls,n=void 0===i?[]:i;if(!a&&!t||a&&t)throw new Error(Vt.SEGMENT_TIME_UNSPECIFIED);var r=n.map(function(t){return fa(e,t)}),s;a&&(s=Zt(e)),t&&(s=ua(e,t));var d=s.map(function(e,t){if(r[t]){var a=r[t];return a.timeline=e.timeline,a.duration=e.duration,a.number=e.number,a}}).filter(function(e){return e});return d},ha=function(e){var t=e.attributes,a=e.segmentInfo,i,n;a.template?(n=ya,i=Nt(t,a.template)):a.base?(n=$t,i=Nt(t,a.base)):a.list&&(n=_a,i=Nt(t,a.list));var r={attributes:t};if(!n)return r;var s=n(i,a.timeline);if(i.duration){var d=i,o=d.duration,l=d.timescale,u=void 0===l?1:l;i.duration=o/u}else i.duration=s.length?s.reduce(function(e,t){return Math.max(e,Math.ceil(t.duration))},0):0;return r.attributes=i,r.segments=s,a.base&&i.indexRange&&(r.sidx=s[0],r.segments=[]),r},ba=function(e){return e.map(ha)},Ta=function(e,t){return Ht(e.childNodes).filter(function(e){var a=e.tagName;return a===t})},Sa=function(e){return e.textContent.trim()},ka=function(e){var t=/P(?:(\d*)Y)?(?:(\d*)M)?(?:(\d*)D)?(?:T(?:(\d*)H)?(?:(\d*)M)?(?:([\d.]*)S)?)?/,a=t.exec(e);if(!a)return 0;var i=a.slice(1),n=i[0],r=i[1],s=i[2],d=i[3],o=i[4],l=i[5];return parseFloat(n||0)*31536000+parseFloat(r||0)*2592000+parseFloat(s||0)*86400+parseFloat(d||0)*3600+parseFloat(o||0)*60+parseFloat(l||0)},va=function(e){var t=/^\d+-\d+-\d+T\d+:\d+:\d+(\.\d+)?$/;return t.test(e)&&(e+="Z"),Date.parse(e)},La={mediaPresentationDuration:function(e){return ka(e)},availabilityStartTime:function(e){return va(e)/1e3},minimumUpdatePeriod:function(e){return ka(e)},timeShiftBufferDepth:function(e){return ka(e)},start:function(e){return ka(e)},width:function(e){return parseInt(e,10)},height:function(e){return parseInt(e,10)},bandwidth:function(e){return parseInt(e,10)},startNumber:function(e){return parseInt(e,10)},timescale:function(e){return parseInt(e,10)},duration:function(e){var t=parseInt(e,10);return isNaN(t)?ka(e):t},d:function(e){return parseInt(e,10)},t:function(e){return parseInt(e,10)},r:function(e){return parseInt(e,10)},DEFAULT:function(e){return e}},Ia=function(e){return e&&e.attributes?Ht(e.attributes).reduce(function(t,a){var e=La[a.name]||La.DEFAULT;return t[a.name]=e(a.value),t},{}):{}},Ea={"urn:uuid:1077efec-c0b2-4d02-ace3-3c1e52e2fb4b":"org.w3.clearkey","urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed":"com.widevine.alpha","urn:uuid:9a04f079-9840-4286-ab92-e65be0885f95":"com.microsoft.playready","urn:uuid:f239e769-efa3-4850-9c16-a903c6932efb":"com.adobe.primetime"},Pa=function(e,t){return t.length?Gt(e.map(function(e){return t.map(function(t){return Yt(e,Sa(t))})})):e},Ua=function(e){var t=Ta(e,"SegmentTemplate")[0],a=Ta(e,"SegmentList")[0],i=a&&Ta(a,"SegmentURL").map(function(e){return Nt({tag:"SegmentURL"},Ia(e))}),n=Ta(e,"SegmentBase")[0],r=a||t,s=r&&Ta(r,"SegmentTimeline")[0],d=a||n||t,o=d&&Ta(d,"Initialization")[0],l=t&&Ia(t);l&&o?l.initialization=o&&Ia(o):l&&l.initialization&&(l.initialization={sourceURL:l.initialization});var u={template:l,timeline:s&&Ta(s,"S").map(function(e){return Ia(e)}),list:a&&Nt(Ia(a),{segmentUrls:i,initialization:Ia(o)}),base:n&&Nt(Ia(n),{initialization:Ia(o)})};return Object.keys(u).forEach(function(e){u[e]||delete u[e]}),u},Ca=function(e,t,a){return function(i){var n=Ta(i,"BaseURL"),r=Pa(t,n),s=Nt(e,Ia(i)),d=Ua(i);return r.map(function(e){return{segmentInfo:Nt(a,d),attributes:Nt(s,{baseUrl:e})}})}},Oa=function(e){return e.reduce(function(e,t){var a=Ia(t),i=Ea[a.schemeIdUri];if(i){e[i]={attributes:a};var n=Ta(t,"cenc:pssh")[0];if(n){var r=Sa(n),s=r&&u(r);e[i].pssh=s}}return e},{})},Ra=function(e,t,a){return function(i){var n=Ia(i),r=Pa(t,Ta(i,"BaseURL")),s=Ta(i,"Role")[0],d={role:Ia(s)},o=Nt(e,n,d),l=Oa(Ta(i,"ContentProtection"));Object.keys(l).length&&(o=Nt(o,{contentProtection:l}));var u=Ua(i),p=Ta(i,"Representation"),m=Nt(a,u);return Gt(p.map(Ca(o,r,m)))}},Da=function(e,t){return function(a,i){var n=Pa(t,Ta(a,"BaseURL")),r=Ia(a),s=parseInt(r.id,10),d=h.isNaN(s)?i:s,o=Nt(e,{periodIndex:d}),l=Ta(a,"AdaptationSet"),u=Ua(a);return Gt(l.map(Ra(o,n,u)))}},Aa=function(e,t){void 0===t&&(t={});var a=t,i=a.manifestUri,n=void 0===i?"":i,r=a.NOW,s=void 0===r?Date.now():r,d=a.clientOffset,o=void 0===d?0:d,l=Ta(e,"Period");if(!l.length)throw new Error(Vt.INVALID_NUMBER_OF_PERIOD);var u=Ia(e),p=Pa([n],Ta(e,"BaseURL"));return u.sourceDuration=u.mediaPresentationDuration||0,u.NOW=s,u.clientOffset=o,Gt(l.map(Da(u,p)))},xa=function(e){if(""===e)throw new Error(Vt.DASH_EMPTY_MANIFEST);var t=new h.DOMParser,a=t.parseFromString(e,"application/xml"),i=a&&"MPD"===a.documentElement.tagName?a.documentElement:null;if(!i||i&&0<i.getElementsByTagName("parsererror").length)throw new Error(Vt.DASH_INVALID_XML);return i},Ba=function(e){var t=Ta(e,"UTCTiming")[0];if(!t)return null;var a=Ia(t);switch(a.schemeIdUri){case"urn:mpeg:dash:utc:http-head:2014":case"urn:mpeg:dash:utc:http-head:2012":a.method="HEAD";break;case"urn:mpeg:dash:utc:http-xsdate:2014":case"urn:mpeg:dash:utc:http-iso:2014":case"urn:mpeg:dash:utc:http-xsdate:2012":case"urn:mpeg:dash:utc:http-iso:2012":a.method="GET";break;case"urn:mpeg:dash:utc:direct:2014":case"urn:mpeg:dash:utc:direct:2012":a.method="DIRECT",a.value=Date.parse(a.value);break;case"urn:mpeg:dash:utc:http-ntp:2014":case"urn:mpeg:dash:utc:ntp:2014":case"urn:mpeg:dash:utc:sntp:2014":default:throw new Error(Vt.UNSUPPORTED_UTC_TIMING_SCHEME);}return a},Ma=function(e,t){return void 0===t&&(t={}),oa(ba(Aa(xa(e),t)),t.sidxMapping)},wa=function(e){return Ba(xa(e))},Na={toUnsigned:function(e){return e>>>0},toHexString:function(e){return("00"+e.toString(16)).slice(-2)}},qa=Na.toUnsigned,Fa=function(e){return new Date(1e3*e-20828448e5)},Ga=function(e){return{isLeading:(12&e[0])>>>2,dependsOn:3&e[0],isDependedOn:(192&e[1])>>>6,hasRedundancy:(48&e[1])>>>4,paddingValue:(14&e[1])>>>1,isNonSyncSample:1&e[1],degradationPriority:e[2]<<8|e[3]}},Ha=function(e){var t="";return t+=String.fromCharCode(e[0]),t+=String.fromCharCode(e[1]),t+=String.fromCharCode(e[2]),t+=String.fromCharCode(e[3]),t},Wa=function(e){var t=new DataView(e.buffer,e.byteOffset,e.byteLength),a=[],n,r;for(n=0;n+4<e.length;n+=r){if(r=t.getUint32(n),n+=4,0>=r){a.push("<span style='color:red;'>MALFORMED DATA</span>");continue}switch(31&e[n]){case 1:a.push("slice_layer_without_partitioning_rbsp");break;case 5:a.push("slice_layer_without_partitioning_rbsp_idr");break;case 6:a.push("sei_rbsp");break;case 7:a.push("seq_parameter_set_rbsp");break;case 8:a.push("pic_parameter_set_rbsp");break;case 9:a.push("access_unit_delimiter_rbsp");break;default:a.push(31&"UNKNOWN NAL - "+e[n]);}}return a},Va={avc1:function(e){var t=new DataView(e.buffer,e.byteOffset,e.byteLength);return{dataReferenceIndex:t.getUint16(6),width:t.getUint16(24),height:t.getUint16(26),horizresolution:t.getUint16(28)+t.getUint16(30)/16,vertresolution:t.getUint16(32)+t.getUint16(34)/16,frameCount:t.getUint16(40),depth:t.getUint16(74),config:za(e.subarray(78,e.byteLength))}},avcC:function(e){var t=new DataView(e.buffer,e.byteOffset,e.byteLength),a={configurationVersion:e[0],avcProfileIndication:e[1],profileCompatibility:e[2],avcLevelIndication:e[3],lengthSizeMinusOne:3&e[4],sps:[],pps:[]},n=31&e[5],r,s,d,o;for(d=6,o=0;o<n;o++)s=t.getUint16(d),d+=2,a.sps.push(new Uint8Array(e.subarray(d,d+s))),d+=s;for(r=e[d],d++,o=0;o<r;o++)s=t.getUint16(d),d+=2,a.pps.push(new Uint8Array(e.subarray(d,d+s))),d+=s;return a},btrt:function(e){var t=new DataView(e.buffer,e.byteOffset,e.byteLength);return{bufferSizeDB:t.getUint32(0),maxBitrate:t.getUint32(4),avgBitrate:t.getUint32(8)}},esds:function(e){return{version:e[0],flags:new Uint8Array(e.subarray(1,4)),esId:e[6]<<8|e[7],streamPriority:31&e[8],decoderConfig:{objectProfileIndication:e[11],streamType:63&e[12]>>>2,bufferSize:e[13]<<16|e[14]<<8|e[15],maxBitrate:e[16]<<24|e[17]<<16|e[18]<<8|e[19],avgBitrate:e[20]<<24|e[21]<<16|e[22]<<8|e[23],decoderConfigDescriptor:{tag:e[24],length:e[25],audioObjectType:31&e[26]>>>3,samplingFrequencyIndex:(7&e[26])<<1|1&e[27]>>>7,channelConfiguration:15&e[27]>>>3}}}},ftyp:function(e){for(var t=new DataView(e.buffer,e.byteOffset,e.byteLength),a={majorBrand:Ha(e.subarray(0,4)),minorVersion:t.getUint32(4),compatibleBrands:[]},n=8;n<e.byteLength;)a.compatibleBrands.push(Ha(e.subarray(n,n+4))),n+=4;return a},dinf:function(e){return{boxes:za(e)}},dref:function(e){return{version:e[0],flags:new Uint8Array(e.subarray(1,4)),dataReferences:za(e.subarray(8))}},hdlr:function(e){var t=new DataView(e.buffer,e.byteOffset,e.byteLength),a={version:t.getUint8(0),flags:new Uint8Array(e.subarray(1,4)),handlerType:Ha(e.subarray(8,12)),name:""},n=8;for(n=24;n<e.byteLength;n++){if(0===e[n]){n++;break}a.name+=String.fromCharCode(e[n])}return a.name=decodeURIComponent(escape(a.name)),a},mdat:function(e){return{byteLength:e.byteLength,nals:Wa(e)}},mdhd:function(e){var t=new DataView(e.buffer,e.byteOffset,e.byteLength),a=4,n={version:t.getUint8(0),flags:new Uint8Array(e.subarray(1,4)),language:""},r;return 1===n.version?(a+=4,n.creationTime=Fa(t.getUint32(a)),a+=8,n.modificationTime=Fa(t.getUint32(a)),a+=4,n.timescale=t.getUint32(a),a+=8,n.duration=t.getUint32(a)):(n.creationTime=Fa(t.getUint32(a)),a+=4,n.modificationTime=Fa(t.getUint32(a)),a+=4,n.timescale=t.getUint32(a),a+=4,n.duration=t.getUint32(a)),a+=4,r=t.getUint16(a),n.language+=String.fromCharCode((r>>10)+96),n.language+=String.fromCharCode(((992&r)>>5)+96),n.language+=String.fromCharCode((31&r)+96),n},mdia:function(e){return{boxes:za(e)}},mfhd:function(e){return{version:e[0],flags:new Uint8Array(e.subarray(1,4)),sequenceNumber:e[4]<<24|e[5]<<16|e[6]<<8|e[7]}},minf:function(e){return{boxes:za(e)}},mp4a:function(e){var t=new DataView(e.buffer,e.byteOffset,e.byteLength),a={dataReferenceIndex:t.getUint16(6),channelcount:t.getUint16(16),samplesize:t.getUint16(18),samplerate:t.getUint16(24)+t.getUint16(26)/65536};return 28<e.byteLength&&(a.streamDescriptor=za(e.subarray(28))[0]),a},moof:function(e){return{boxes:za(e)}},moov:function(e){return{boxes:za(e)}},mvex:function(e){return{boxes:za(e)}},mvhd:function(e){var t=new DataView(e.buffer,e.byteOffset,e.byteLength),a=4,n={version:t.getUint8(0),flags:new Uint8Array(e.subarray(1,4))};return 1===n.version?(a+=4,n.creationTime=Fa(t.getUint32(a)),a+=8,n.modificationTime=Fa(t.getUint32(a)),a+=4,n.timescale=t.getUint32(a),a+=8,n.duration=t.getUint32(a)):(n.creationTime=Fa(t.getUint32(a)),a+=4,n.modificationTime=Fa(t.getUint32(a)),a+=4,n.timescale=t.getUint32(a),a+=4,n.duration=t.getUint32(a)),a+=4,n.rate=t.getUint16(a)+t.getUint16(a+2)/16,a+=4,n.volume=t.getUint8(a)+t.getUint8(a+1)/8,a+=2,a+=2,a+=8,n.matrix=new Uint32Array(e.subarray(a,a+36)),a+=36,a+=24,n.nextTrackId=t.getUint32(a),n},pdin:function(e){var t=new DataView(e.buffer,e.byteOffset,e.byteLength);return{version:t.getUint8(0),flags:new Uint8Array(e.subarray(1,4)),rate:t.getUint32(4),initialDelay:t.getUint32(8)}},sdtp:function(e){var t={version:e[0],flags:new Uint8Array(e.subarray(1,4)),samples:[]},a;for(a=4;a<e.byteLength;a++)t.samples.push({dependsOn:(48&e[a])>>4,isDependedOn:(12&e[a])>>2,hasRedundancy:3&e[a]});return t},sidx:function(e){var t=new DataView(e.buffer,e.byteOffset,e.byteLength),a={version:e[0],flags:new Uint8Array(e.subarray(1,4)),references:[],referenceId:t.getUint32(4),timescale:t.getUint32(8),earliestPresentationTime:t.getUint32(12),firstOffset:t.getUint32(16)},n=t.getUint16(22),r;for(r=24;n;r+=12,n--)a.references.push({referenceType:(128&e[r])>>>7,referencedSize:2147483647&t.getUint32(r),subsegmentDuration:t.getUint32(r+4),startsWithSap:!!(128&e[r+8]),sapType:(112&e[r+8])>>>4,sapDeltaTime:268435455&t.getUint32(r+8)});return a},smhd:function(e){return{version:e[0],flags:new Uint8Array(e.subarray(1,4)),balance:e[4]+e[5]/256}},stbl:function(e){return{boxes:za(e)}},stco:function(e){var t=new DataView(e.buffer,e.byteOffset,e.byteLength),a={version:e[0],flags:new Uint8Array(e.subarray(1,4)),chunkOffsets:[]},n=t.getUint32(4),r;for(r=8;n;r+=4,n--)a.chunkOffsets.push(t.getUint32(r));return a},stsc:function(e){var t=new DataView(e.buffer,e.byteOffset,e.byteLength),a=t.getUint32(4),n={version:e[0],flags:new Uint8Array(e.subarray(1,4)),sampleToChunks:[]},r;for(r=8;a;r+=12,a--)n.sampleToChunks.push({firstChunk:t.getUint32(r),samplesPerChunk:t.getUint32(r+4),sampleDescriptionIndex:t.getUint32(r+8)});return n},stsd:function(e){return{version:e[0],flags:new Uint8Array(e.subarray(1,4)),sampleDescriptions:za(e.subarray(8))}},stsz:function(e){var t=new DataView(e.buffer,e.byteOffset,e.byteLength),a={version:e[0],flags:new Uint8Array(e.subarray(1,4)),sampleSize:t.getUint32(4),entries:[]},n;for(n=12;n<e.byteLength;n+=4)a.entries.push(t.getUint32(n));return a},stts:function(e){var t=new DataView(e.buffer,e.byteOffset,e.byteLength),a={version:e[0],flags:new Uint8Array(e.subarray(1,4)),timeToSamples:[]},n=t.getUint32(4),r;for(r=8;n;r+=8,n--)a.timeToSamples.push({sampleCount:t.getUint32(r),sampleDelta:t.getUint32(r+4)});return a},styp:function(e){return Va.ftyp(e)},tfdt:function(e){var t={version:e[0],flags:new Uint8Array(e.subarray(1,4)),baseMediaDecodeTime:qa(e[4]<<24|e[5]<<16|e[6]<<8|e[7])};return 1===t.version&&(t.baseMediaDecodeTime*=Math.pow(2,32),t.baseMediaDecodeTime+=qa(e[8]<<24|e[9]<<16|e[10]<<8|e[11])),t},tfhd:function(e){var t=new DataView(e.buffer,e.byteOffset,e.byteLength),a={version:e[0],flags:new Uint8Array(e.subarray(1,4)),trackId:t.getUint32(4)},n=1&a.flags[2],r=2&a.flags[2],s=8&a.flags[2],d=16&a.flags[2],o=32&a.flags[2],l=65536&a.flags[0],u=131072&a.flags[0],p;return p=8,n&&(p+=4,a.baseDataOffset=t.getUint32(12),p+=4),r&&(a.sampleDescriptionIndex=t.getUint32(p),p+=4),s&&(a.defaultSampleDuration=t.getUint32(p),p+=4),d&&(a.defaultSampleSize=t.getUint32(p),p+=4),o&&(a.defaultSampleFlags=t.getUint32(p)),l&&(a.durationIsEmpty=!0),!n&&u&&(a.baseDataOffsetIsMoof=!0),a},tkhd:function(e){var t=new DataView(e.buffer,e.byteOffset,e.byteLength),a=4,n={version:t.getUint8(0),flags:new Uint8Array(e.subarray(1,4))};return 1===n.version?(a+=4,n.creationTime=Fa(t.getUint32(a)),a+=8,n.modificationTime=Fa(t.getUint32(a)),a+=4,n.trackId=t.getUint32(a),a+=4,a+=8,n.duration=t.getUint32(a)):(n.creationTime=Fa(t.getUint32(a)),a+=4,n.modificationTime=Fa(t.getUint32(a)),a+=4,n.trackId=t.getUint32(a),a+=4,a+=4,n.duration=t.getUint32(a)),a+=4,a+=8,n.layer=t.getUint16(a),a+=2,n.alternateGroup=t.getUint16(a),a+=2,n.volume=t.getUint8(a)+t.getUint8(a+1)/8,a+=2,a+=2,n.matrix=new Uint32Array(e.subarray(a,a+36)),a+=36,n.width=t.getUint16(a)+t.getUint16(a+2)/16,a+=4,n.height=t.getUint16(a)+t.getUint16(a+2)/16,n},traf:function(e){return{boxes:za(e)}},trak:function(e){return{boxes:za(e)}},trex:function(e){var t=new DataView(e.buffer,e.byteOffset,e.byteLength);return{version:e[0],flags:new Uint8Array(e.subarray(1,4)),trackId:t.getUint32(4),defaultSampleDescriptionIndex:t.getUint32(8),defaultSampleDuration:t.getUint32(12),defaultSampleSize:t.getUint32(16),sampleDependsOn:3&e[20],sampleIsDependedOn:(192&e[21])>>6,sampleHasRedundancy:(48&e[21])>>4,samplePaddingValue:(14&e[21])>>1,sampleIsDifferenceSample:!!(1&e[21]),sampleDegradationPriority:t.getUint16(22)}},trun:function(e){var t={version:e[0],flags:new Uint8Array(e.subarray(1,4)),samples:[]},a=new DataView(e.buffer,e.byteOffset,e.byteLength),i=1&t.flags[2],n=4&t.flags[2],r=1&t.flags[1],s=2&t.flags[1],d=4&t.flags[1],o=8&t.flags[1],l=a.getUint32(4),u=8,p;for(i&&(t.dataOffset=a.getInt32(u),u+=4),n&&l&&(p={flags:Ga(e.subarray(u,u+4))},u+=4,r&&(p.duration=a.getUint32(u),u+=4),s&&(p.size=a.getUint32(u),u+=4),o&&(p.compositionTimeOffset=a.getUint32(u),u+=4),t.samples.push(p),l--);l--;)p={},r&&(p.duration=a.getUint32(u),u+=4),s&&(p.size=a.getUint32(u),u+=4),d&&(p.flags=Ga(e.subarray(u,u+4)),u+=4),o&&(p.compositionTimeOffset=a.getUint32(u),u+=4),t.samples.push(p);return t},"url ":function(e){return{version:e[0],flags:new Uint8Array(e.subarray(1,4))}},vmhd:function(e){var t=new DataView(e.buffer,e.byteOffset,e.byteLength);return{version:e[0],flags:new Uint8Array(e.subarray(1,4)),graphicsmode:t.getUint16(4),opcolor:new Uint16Array([t.getUint16(6),t.getUint16(8),t.getUint16(10)])}}},za,ja;za=function(e){for(var t=0,a=[],n=new ArrayBuffer(e.length),r=new Uint8Array(n),s=0,d,o,l,u,p;s<e.length;++s)r[s]=e[s];for(d=new DataView(n);t<e.byteLength;)o=d.getUint32(t),l=Ha(e.subarray(t+4,t+8)),u=1<o?t+o:e.byteLength,p=(Va[l]||function(e){return{data:e}})(e.subarray(t+8,u)),p.size=o,p.type=l,a.push(p),t=u;return a},ja=function(e,t){var a;return t=t||0,a=Array(2*t+1).join(" "),e.map(function(e){return a+e.type+"\n"+Object.keys(e).filter(function(e){return"type"!==e&&"boxes"!==e}).map(function(t){var i=a+"  "+t+": ",n=e[t];if(n instanceof Uint8Array||n instanceof Uint32Array){var r=Array.prototype.slice.call(new Uint8Array(n.buffer,n.byteOffset,n.byteLength)).map(function(e){return" "+("00"+e.toString(16)).slice(-2)}).join("").match(/.{1,24}/g);return r?1===r.length?i+"<"+r.join("").slice(1)+">":i+"<\n"+r.map(function(e){return a+"  "+e}).join("\n")+"\n"+a+"  >":i+"<>"}return i+JSON.stringify(n,null,2).split("\n").map(function(e,t){return 0===t?e:a+"  "+e}).join("\n")}).join("\n")+(e.boxes?"\n"+ja(e.boxes,t+1):"")}).join("\n")};var Ya={inspect:za,textify:ja,parseType:Ha,findBox:function e(t,a){var n=[],r,s,d,o,l;if(!a.length)return null;for(r=0;r<t.byteLength;)s=qa(t[r]<<24|t[r+1]<<16|t[r+2]<<8|t[r+3]),d=Ha(t.subarray(r+4,r+8)),o=1<s?r+s:t.byteLength,d===a[0]&&(1===a.length?n.push(t.subarray(r+8,o)):(l=e(t.subarray(r+8,o),a.slice(1)),l.length&&(n=n.concat(l)))),r=o;return n},parseTraf:Va.traf,parseTfdt:Va.tfdt,parseHdlr:Va.hdlr,parseTfhd:Va.tfhd,parseTrun:Va.trun,parseSidx:Va.sidx},Xa=t.EventTarget,Ka=t.mergeOptions,Qa=function(e,t){for(var a=void 0,n=Ka(e,{duration:t.duration,minimumUpdatePeriod:t.minimumUpdatePeriod}),r=0,s;r<t.playlists.length;r++)s=q(n,t.playlists[r]),s?n=s:a=!0;return M(t,function(e,t,i,r){if(e.playlists&&e.playlists.length){var s=e.playlists[0].uri,d=q(n,e.playlists[0]);d&&(n=d,n.mediaGroups[t][i][r].playlists[0]=n.playlists[s],a=!1)}}),a?null:n},Ja=function(e){var t=e.byterange.offset+e.byterange.length-1;return e.uri+"-"+e.byterange.offset+"-"+t},Za=function(e,t){var a=!(e.map||t.map),i=a||!!(e.map&&t.map&&e.map.byterange.offset===t.map.byterange.offset&&e.map.byterange.length===t.map.byterange.length);return i&&e.uri===t.uri&&e.byterange.offset===t.byterange.offset&&e.byterange.length===t.byterange.length},$a=function(e,t){var a={};for(var i in e){var n=e[i],r=n.sidx;if(r){var s=Ja(r);if(!t[s])break;var d=t[s].sidxInfo;Za(d,r)&&(a[s]=t[s])}}return a},ei=function(e,t,a,i){var n=Ma(e,{manifestUri:t,clientOffset:a}),r=$a(n.playlists,i),s=r;return M(n,function(e){if(e.playlists&&e.playlists.length){var t=e.playlists;s=Ka(s,$a(t,i))}}),s},ti=function(e,a,i,n,r){var s={uri:T(n.handleManifestRedirects,e.resolvedUri),byterange:e.byterange,playlist:a},d=t.mergeOptions(s,{responseType:"arraybuffer",headers:ge(s)});return i(d,r)},ai=function(e){function t(e,a){var i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{},n=arguments[3];P(this,t);var r=R(this,(t.__proto__||Object.getPrototypeOf(t)).call(this)),s=i.withCredentials,d=i.handleManifestRedirects;if(r.hls_=a,r.withCredentials=void 0!==s&&s,r.handleManifestRedirects=void 0!==d&&d,!e)throw new Error("A non-empty playlist URL or playlist is required");return(r.on("minimumUpdatePeriod",function(){r.refreshXml_()}),r.on("mediaupdatetimeout",function(){r.refreshMedia_(r.media().uri)}),r.state="HAVE_NOTHING",r.loadedPlaylists_={},"string"==typeof e)?(r.srcUrl=e,r.sidxMapping_={},R(r)):(r.setupChildLoader(n,e),r)}return O(t,e),U(t,[{key:"setupChildLoader",value:function(e,t){this.masterPlaylistLoader_=e,this.childPlaylist_=t}},{key:"dispose",value:function(){this.stopRequest(),this.loadedPlaylists_={},h.clearTimeout(this.minimumUpdatePeriodTimeout_),h.clearTimeout(this.mediaRequest_),h.clearTimeout(this.mediaUpdateTimeout)}},{key:"hasPendingRequest",value:function(){return this.request||this.mediaRequest_}},{key:"stopRequest",value:function(){if(this.request){var e=this.request;this.request=null,e.onreadystatechange=null,e.abort()}}},{key:"sidxRequestFinished_",value:function(e,t,a,i){var n=this;return function(r,s){if(n.request){if(n.request=null,r)return n.error={status:s.status,message:"DASH playlist request error at URL: "+e.uri,response:s.response,code:2},a&&(n.state=a),n.trigger("error"),i(t,null);var d=new Uint8Array(s.response),o=Ya.parseSidx(d.subarray(8));return i(t,o)}}}},{key:"media",value:function(e){var t=this;if(!e)return this.media_;if("HAVE_NOTHING"===this.state)throw new Error("Cannot switch media playlist from "+this.state);var a=this.state;if("string"==typeof e){if(!this.master.playlists[e])throw new Error("Unknown playlist URI: "+e);e=this.master.playlists[e]}var i=!this.media_||e.uri!==this.media_.uri;if(i&&this.loadedPlaylists_[e.uri]&&this.loadedPlaylists_[e.uri].endList)return this.state="HAVE_METADATA",this.media_=e,void(i&&(this.trigger("mediachanging"),this.trigger("mediachange")));if(i){if(this.media_&&this.trigger("mediachanging"),!e.sidx)return void(this.mediaRequest_=h.setTimeout(this.haveMetadata.bind(this,{startingState:a,playlist:e}),0));var n=void 0,r=void 0;this.masterPlaylistLoader_?(n=this.masterPlaylistLoader_.master,r=this.masterPlaylistLoader_.sidxMapping_):(n=this.master,r=this.sidxMapping_);var s=Ja(e.sidx);r[s]={sidxInfo:e.sidx},this.request=ti(e.sidx,e,this.hls_.xhr,{handleManifestRedirects:this.handleManifestRedirects},this.sidxRequestFinished_(e,n,a,function(i,n){if(!i||!n)throw new Error("failed to request sidx");r[s].sidx=n,t.haveMetadata({startingState:a,playlist:i.playlists[e.uri]})}))}}},{key:"haveMetadata",value:function(e){var t=e.startingState,a=e.playlist;this.state="HAVE_METADATA",this.loadedPlaylists_[a.uri]=a,this.mediaRequest_=null,this.refreshMedia_(a.uri),"HAVE_MASTER"===t?this.trigger("loadedmetadata"):this.trigger("mediachange")}},{key:"pause",value:function(){this.stopRequest(),h.clearTimeout(this.mediaUpdateTimeout),h.clearTimeout(this.minimumUpdatePeriodTimeout_),"HAVE_NOTHING"===this.state&&(this.started=!1)}},{key:"load",value:function(e){var t=this;h.clearTimeout(this.mediaUpdateTimeout),h.clearTimeout(this.minimumUpdatePeriodTimeout_);var a=this.media();if(e){var i=a?1e3*(a.targetDuration/2):5000;return void(this.mediaUpdateTimeout=h.setTimeout(function(){return t.load()},i))}return this.started?void this.trigger("loadedplaylist"):void this.start()}},{key:"parseMasterXml",value:function(){var e=Ma(this.masterXml_,{manifestUri:this.srcUrl,clientOffset:this.clientOffset_,sidxMapping:this.sidxMapping_});e.uri=this.srcUrl;for(var t=0,a;t<e.playlists.length;t++)a="placeholder-uri-"+t,e.playlists[t].uri=a,e.playlists[a]=e.playlists[t];return M(e,function(t,a,i,n){if(t.playlists&&t.playlists.length){var r="placeholder-uri-"+a+"-"+i+"-"+n;t.playlists[0].uri=r,e.playlists[r]=t.playlists[0]}}),F(e),G(e),e}},{key:"start",value:function(){var e=this;return this.started=!0,this.masterPlaylistLoader_?void(this.mediaRequest_=h.setTimeout(this.haveMaster_.bind(this),0)):void(this.request=this.hls_.xhr({uri:this.srcUrl,withCredentials:this.withCredentials},function(t,a){if(e.request)return e.request=null,t?(e.error={status:a.status,message:"DASH playlist request error at URL: "+e.srcUrl,responseText:a.responseText,code:2},"HAVE_NOTHING"===e.state&&(e.started=!1),e.trigger("error")):void(e.masterXml_=a.responseText,e.masterLoaded_=a.responseHeaders&&a.responseHeaders.date?Date.parse(a.responseHeaders.date):Date.now(),e.srcUrl=T(e.handleManifestRedirects,e.srcUrl,a),e.syncClientServerClock_(e.onClientServerClockSync_.bind(e)))}))}},{key:"syncClientServerClock_",value:function(e){var t=this,a=wa(this.masterXml_);return null===a?(this.clientOffset_=this.masterLoaded_-Date.now(),e()):"DIRECT"===a.method?(this.clientOffset_=a.value-Date.now(),e()):void(this.request=this.hls_.xhr({uri:b(this.srcUrl,a.value),method:a.method,withCredentials:this.withCredentials},function(i,n){if(t.request){if(i)return t.clientOffset_=t.masterLoaded_-Date.now(),e();var r;r="HEAD"===a.method?n.responseHeaders&&n.responseHeaders.date?Date.parse(n.responseHeaders.date):t.masterLoaded_:Date.parse(n.responseText),t.clientOffset_=r-Date.now(),e()}}))}},{key:"haveMaster_",value:function(){this.state="HAVE_MASTER",this.mediaRequest_=null,this.masterPlaylistLoader_?!this.media_&&this.media(this.childPlaylist_):(this.master=this.parseMasterXml(),this.trigger("loadedplaylist"))}},{key:"onClientServerClockSync_",value:function(){var e=this;this.haveMaster_(),this.hasPendingRequest()||this.media_||this.media(this.master.playlists[0]),this.master&&this.master.minimumUpdatePeriod&&(this.minimumUpdatePeriodTimeout_=h.setTimeout(function(){e.trigger("minimumUpdatePeriod")},this.master.minimumUpdatePeriod))}},{key:"refreshXml_",value:function(){var e=this;this.request=this.hls_.xhr({uri:this.srcUrl,withCredentials:this.withCredentials},function(t,a){if(e.request){if(e.request=null,t)return e.error={status:a.status,message:"DASH playlist request error at URL: "+e.srcUrl,responseText:a.responseText,code:2},"HAVE_NOTHING"===e.state&&(e.started=!1),e.trigger("error");e.masterXml_=a.responseText,e.sidxMapping_=ei(e.masterXml_,e.srcUrl,e.clientOffset_,e.sidxMapping_);var i=e.parseMasterXml(),n=Qa(e.master,i),r=e.media().sidx;if(n)if(r){var s=Ja(r);if(!e.sidxMapping_[s]){var d=e.media();e.request=ti(d.sidx,d,e.hls_.xhr,{handleManifestRedirects:e.handleManifestRedirects},e.sidxRequestFinished_(d,i,e.state,function(t,a){if(!t||!a)throw new Error("failed to request sidx on minimumUpdatePeriod");return e.sidxMapping_[s].sidx=a,e.minimumUpdatePeriodTimeout_=h.setTimeout(function(){e.trigger("minimumUpdatePeriod")},e.master.minimumUpdatePeriod),void e.refreshMedia_(e.media().uri)}))}}else e.master=n;e.minimumUpdatePeriodTimeout_=h.setTimeout(function(){e.trigger("minimumUpdatePeriod")},e.master.minimumUpdatePeriod)}})}},{key:"refreshMedia_",value:function(e){var t=this;if(!e)throw new Error("refreshMedia_ must take a media uri");var a=void 0,i=void 0;this.masterPlaylistLoader_?(a=this.masterPlaylistLoader_.master,i=this.masterPlaylistLoader_.parseMasterXml()):(a=this.master,i=this.parseMasterXml());var n=Qa(a,i);n?(this.masterPlaylistLoader_?this.masterPlaylistLoader_.master=n:this.master=n,this.media_=n.playlists[e]):(this.media_=i.playlists[e],this.trigger("playlistunchanged")),this.media().endList||(this.mediaUpdateTimeout=h.setTimeout(function(){t.trigger("mediaupdatetimeout")},H(this.media(),!!n))),this.trigger("loadedplaylist")}}]),t}(Xa),ii=function(e){return t.log.debug?t.log.debug.bind(t,"VHS:",e+" >"):function(){}},ni=function(){function e(t,a,i,n){P(this,e),this.callbacks_=[],this.pendingCallback_=null,this.timestampOffset_=0,this.mediaSource=t,this.processedAppend_=!1,this.type_=i,this.mimeType_=a,this.logger_=ii("SourceUpdater["+i+"]["+a+"]"),"closed"===t.readyState?t.addEventListener("sourceopen",this.createSourceBuffer_.bind(this,a,n)):this.createSourceBuffer_(a,n)}return U(e,[{key:"createSourceBuffer_",value:function(e,t){var a=this;return this.sourceBuffer_=this.mediaSource.addSourceBuffer(e),this.logger_("created SourceBuffer"),t&&(t.trigger("sourcebufferadded"),2>this.mediaSource.sourceBuffers.length)?void t.on("sourcebufferadded",function(){a.start_()}):void this.start_()}},{key:"start_",value:function(){var e=this;this.started_=!0,this.onUpdateendCallback_=function(){var t=e.pendingCallback_;e.pendingCallback_=null,e.sourceBuffer_.removing=!1,e.logger_("buffered ["+Ke(e.buffered())+"]"),t&&t(),e.runCallback_()},this.sourceBuffer_.addEventListener("updateend",this.onUpdateendCallback_),this.runCallback_()}},{key:"abort",value:function(e){var t=this;this.processedAppend_&&this.queueCallback_(function(){t.sourceBuffer_.abort()},e)}},{key:"appendBuffer",value:function(e,t){var a=this;this.processedAppend_=!0,this.queueCallback_(function(){e.videoSegmentTimingInfoCallback&&a.sourceBuffer_.addEventListener("videoSegmentTimingInfo",e.videoSegmentTimingInfoCallback),a.sourceBuffer_.appendBuffer(e.bytes)},function(){e.videoSegmentTimingInfoCallback&&a.sourceBuffer_.removeEventListener("videoSegmentTimingInfo",e.videoSegmentTimingInfoCallback),t()})}},{key:"buffered",value:function(){return this.sourceBuffer_?this.sourceBuffer_.buffered:t.createTimeRanges()}},{key:"remove",value:function(e,t){var a=this,i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:p;this.processedAppend_&&this.queueCallback_(function(){a.logger_("remove ["+e+" => "+t+"]"),a.sourceBuffer_.removing=!0,a.sourceBuffer_.remove(e,t)},i)}},{key:"updating",value:function(){return!this.sourceBuffer_||this.sourceBuffer_.updating||!!this.pendingCallback_&&this.pendingCallback_!==p}},{key:"timestampOffset",value:function(e){var t=this;return"undefined"!=typeof e&&(this.queueCallback_(function(){t.sourceBuffer_.timestampOffset=e,t.runCallback_()}),this.timestampOffset_=e),this.timestampOffset_}},{key:"queueCallback_",value:function(e,t){this.callbacks_.push([e.bind(this),t]),this.runCallback_()}},{key:"runCallback_",value:function(){var e;!this.updating()&&this.callbacks_.length&&this.started_&&(e=this.callbacks_.shift(),this.pendingCallback_=e[1],e[0]())}},{key:"dispose",value:function(){var e=this,t=function t(){e.sourceBuffer_&&"open"===e.mediaSource.readyState&&e.sourceBuffer_.abort(),e.sourceBuffer_.removeEventListener("updateend",t)};this.sourceBuffer_.removeEventListener("updateend",this.onUpdateendCallback_),this.sourceBuffer_.removing?this.sourceBuffer_.addEventListener("updateend",t):t()}}]),e}(),ri={GOAL_BUFFER_LENGTH:30,MAX_GOAL_BUFFER_LENGTH:60,GOAL_BUFFER_LENGTH_RATE:1,INITIAL_BANDWIDTH:4194304,BANDWIDTH_VARIANCE:1.2,BUFFER_LOW_WATER_LINE:0,MAX_BUFFER_LOW_WATER_LINE:30,BUFFER_LOW_WATER_LINE_RATE:1},si=Na.toUnsigned,di=Na.toHexString,oi,li,ui,pi,mi;oi=function(e){var t=Ya.findBox(e,["moov","trak"]);return t.reduce(function(e,t){var a,i,n,r,s;return(a=Ya.findBox(t,["tkhd"])[0],!a)?null:(i=a[0],n=0===i?12:20,r=si(a[n]<<24|a[n+1]<<16|a[n+2]<<8|a[n+3]),s=Ya.findBox(t,["mdia","mdhd"])[0],!s)?null:(i=s[0],n=0===i?12:20,e[r]=si(s[n]<<24|s[n+1]<<16|s[n+2]<<8|s[n+3]),e)},{})},li=function(e,t){var a,i,n;return a=Ya.findBox(t,["moof","traf"]),i=[].concat.apply([],a.map(function(t){return Ya.findBox(t,["tfhd"]).map(function(a){var i,n,r;return i=si(a[4]<<24|a[5]<<16|a[6]<<8|a[7]),n=e[i]||9e4,r=Ya.findBox(t,["tfdt"]).map(function(e){var t,a;return t=e[0],a=si(e[4]<<24|e[5]<<16|e[6]<<8|e[7]),1===t&&(a*=Math.pow(2,32),a+=si(e[8]<<24|e[9]<<16|e[10]<<8|e[11])),a})[0],r=r||1/0,r/n})})),n=Math.min.apply(null,i),isFinite(n)?n:0},ui=function(e,t){var a=Ya.findBox(t,["moof","traf"]),n=0,r=0,s;if(a&&a.length)for(var d=Ya.parseTraf(a[0]),o=0;o<d.boxes.length;o++)"tfhd"===d.boxes[o].type?s=d.boxes[o].trackId:"tfdt"===d.boxes[o].type?n=d.boxes[o].baseMediaDecodeTime:"trun"===d.boxes[o].type&&d.boxes[o].samples.length&&(r=d.boxes[o].samples[0].compositionTimeOffset||0);var l=e[s]||9e4;return(n+r)/l},pi=function(e){var t=Ya.findBox(e,["moov","trak"]),a=[];return t.forEach(function(e){var t=Ya.findBox(e,["mdia","hdlr"]),i=Ya.findBox(e,["tkhd"]);t.forEach(function(e,t){var n=Ya.parseType(e.subarray(8,12)),r=i[t],s,d,o;"vide"===n&&(s=new DataView(r.buffer,r.byteOffset,r.byteLength),d=s.getUint8(0),o=0===d?s.getUint32(12):s.getUint32(20),a.push(o))})}),a},mi=function(e){var t=Ya.findBox(e,["moov","trak"]),a=[];return t.forEach(function(e){var t={},i=Ya.findBox(e,["tkhd"])[0],n,r;i&&(n=new DataView(i.buffer,i.byteOffset,i.byteLength),r=n.getUint8(0),t.id=0===r?n.getUint32(12):n.getUint32(20));var s=Ya.findBox(e,["mdia","hdlr"])[0];if(s){var d=Ya.parseType(s.subarray(8,12));t.type="vide"===d?"video":"soun"===d?"audio":d}var o=Ya.findBox(e,["mdia","minf","stbl","stsd"])[0];if(o){var l=o.subarray(8);t.codec=Ya.parseType(l.subarray(4,8));var u=Ya.findBox(l,[t.codec])[0],p,m;u&&(/^[a-z]vc[1-9]$/i.test(t.codec)?(p=u.subarray(78),m=Ya.parseType(p.subarray(4,8)),"avcC"===m&&11<p.length?(t.codec+=".",t.codec+=di(p[9]),t.codec+=di(p[10]),t.codec+=di(p[11])):t.codec="avc1.4d400d"):/^mp4[a,v]$/i.test(t.codec)&&(p=u.subarray(28),m=Ya.parseType(p.subarray(4,8)),"esds"===m&&20<p.length&&0!==p[19]?(t.codec+="."+di(p[19]),t.codec+="."+di(63&p[20]>>>2).replace(/^0/,"")):t.codec="mp4a.40.2"))}var g=Ya.findBox(e,["mdia","mdhd"])[0];if(g&&i){var c=0===r?12:20;t.timescale=si(g[c]<<24|g[c+1]<<16|g[c+2]<<8|g[c+3])}a.push(t)}),a};var gi={findBox:Ya.findBox,parseType:Ya.parseType,timescale:oi,startTime:li,compositionStartTime:ui,videoTrackIds:pi,tracks:mi},ci={FAILURE:2,TIMEOUT:-101,ABORTED:-102},yi=function(e){e.forEach(function(e){e.abort()})},fi=function(e){return{bandwidth:e.bandwidth,bytesReceived:e.bytesReceived||0,roundTripTime:e.roundTripTime||0}},_i=function(e){var t=e.target,a=Date.now()-t.requestTime,i={bandwidth:1/0,bytesReceived:0,roundTripTime:a||0};return i.bytesReceived=e.loaded,i.bandwidth=Math.floor(1e3*(8*(i.bytesReceived/i.roundTripTime))),i},hi=function(e,t){return t.timedout?{status:t.status,message:"HLS request timed-out at URL: "+t.uri,code:ci.TIMEOUT,xhr:t}:t.aborted?{status:t.status,message:"HLS request aborted at URL: "+t.uri,code:ci.ABORTED,xhr:t}:e?{status:t.status,message:"HLS request errored at URL: "+t.uri,code:ci.FAILURE,xhr:t}:null},bi=function(e,t){return function(a,i){var n=i.response,r=hi(a,i);if(r)return t(r,e);if(16!==n.byteLength)return t({status:i.status,message:"Invalid HLS key at URL: "+i.uri,code:ci.FAILURE,xhr:i},e);var s=new DataView(n);return e.key.bytes=new Uint32Array([s.getUint32(0),s.getUint32(4),s.getUint32(8),s.getUint32(12)]),t(null,e)}},Ti=function(e,t,a){return function(i,n){var r=n.response,s=hi(i,n);return s?a(s,e):0===r.byteLength?a({status:n.status,message:"Empty HLS segment content at URL: "+n.uri,code:ci.FAILURE,xhr:n},e):(e.map.bytes=new Uint8Array(n.response),t&&!t.isInitialized()&&t.init(),e.map.timescales=gi.timescale(e.map.bytes),e.map.videoTrackIds=gi.videoTrackIds(e.map.bytes),a(null,e))}},Si=function(e,t,a){return function(i,n){var r=n.response,s=hi(i,n),d=void 0;return s?a(s,e):0===r.byteLength?a({status:n.status,message:"Empty HLS segment content at URL: "+n.uri,code:ci.FAILURE,xhr:n},e):(e.stats=fi(n),e.key?e.encryptedBytes=new Uint8Array(n.response):e.bytes=new Uint8Array(n.response),t&&e.map&&e.map.bytes&&(!t.isInitialized()&&t.init(),d=t.parse(e.bytes,e.map.videoTrackIds,e.map.timescales),d&&d.captions&&(e.captionStreams=d.captionStreams,e.fmp4Captions=d.captions)),a(null,e))}},ki=function(e,t,a){e.addEventListener("message",function i(n){if(n.data.source===t.requestId){e.removeEventListener("message",i);var r=n.data.decrypted;return t.bytes=new Uint8Array(r.bytes,r.byteOffset,r.byteLength),a(null,t)}});var i;i=t.key.bytes.slice?t.key.bytes.slice():new Uint32Array(Array.prototype.slice.call(t.key.bytes)),e.postMessage(Ce({source:t.requestId,encrypted:t.encryptedBytes,key:i,iv:t.key.iv}),[t.encryptedBytes.buffer,i.buffer])},vi=function(e,t,a){var i=0,n=!1;return function(r,s){if(!n)return r?(n=!0,yi(e),a(r,s)):(i+=1,i===e.length)?(s.endOfAllRequests=Date.now(),s.encryptedBytes?ki(t,s,a):a(null,s)):void 0}},Li=function(e,a){return function(i){return e.stats=t.mergeOptions(e.stats,_i(i)),!e.stats.firstBytesReceivedAt&&e.stats.bytesReceived&&(e.stats.firstBytesReceivedAt=Date.now()),a(i,e)}},Ii=function(e,a,i,n,r,s,d){var o=[],l=vi(o,i,d);if(r.key&&!r.key.bytes){var u=t.mergeOptions(a,{uri:r.key.resolvedUri,responseType:"arraybuffer"}),p=bi(r,l),m=e(u,p);o.push(m)}if(r.map&&!r.map.bytes){var g=t.mergeOptions(a,{uri:r.map.resolvedUri,responseType:"arraybuffer",headers:ge(r.map)}),c=Ti(r,n,l),y=e(g,c);o.push(y)}var f=t.mergeOptions(a,{uri:r.resolvedUri,responseType:"arraybuffer",headers:ge(r)}),_=Si(r,n,l),h=e(f,_);return h.addEventListener("progress",Li(r,s)),o.push(h),function(){return yi(o)}},Ei=function(e,t){var a;return e?(a=h.getComputedStyle(e),a?a[t]:""):""},Pi=function(e,t){var a=e.slice();e.sort(function(e,i){var n=t(e,i);return 0===n?a.indexOf(e)-a.indexOf(i):n})},Ui=function(e,t){var a=void 0,i=void 0;return e.attributes.BANDWIDTH&&(a=e.attributes.BANDWIDTH),a=a||h.Number.MAX_VALUE,t.attributes.BANDWIDTH&&(i=t.attributes.BANDWIDTH),i=i||h.Number.MAX_VALUE,a-i},Ci=function(e,t,a,i,n){var r=e.playlists.map(function(e){var t=void 0,a=void 0,i=void 0;return t=e.attributes.RESOLUTION&&e.attributes.RESOLUTION.width,a=e.attributes.RESOLUTION&&e.attributes.RESOLUTION.height,i=e.attributes.BANDWIDTH,i=i||h.Number.MAX_VALUE,{bandwidth:i,width:t,height:a,playlist:e}});Pi(r,function(e,t){return e.bandwidth-t.bandwidth}),r=r.filter(function(e){return!oe.isIncompatible(e.playlist)});var s=r.filter(function(e){return oe.isEnabled(e.playlist)});s.length||(s=r.filter(function(e){return!oe.isDisabled(e.playlist)}));var d=s.filter(function(e){return e.bandwidth*ri.BANDWIDTH_VARIANCE<t}),o=d[d.length-1],l=d.filter(function(e){return e.bandwidth===o.bandwidth})[0];if(!1===n){var u=l||s[0]||r[0];return u?u.playlist:null}var p=d.filter(function(e){return e.width&&e.height});Pi(p,function(e,t){return e.width-t.width});var m=p.filter(function(e){return e.width===a&&e.height===i});o=m[m.length-1];var g=m.filter(function(e){return e.bandwidth===o.bandwidth})[0],c=void 0,y=void 0,f=void 0;g||(c=p.filter(function(e){return e.width>a||e.height>i}),y=c.filter(function(e){return e.width===c[0].width&&e.height===c[0].height}),o=y[y.length-1],f=y.filter(function(e){return e.bandwidth===o.bandwidth})[0]);var _=f||g||l||s[0]||r[0];return _?_.playlist:null},Oi=function(e){var t=e.master,a=e.currentTime,i=e.bandwidth,n=e.duration,r=e.segmentDuration,s=e.timeUntilRebuffer,d=e.currentTimeline,o=e.syncController,l=t.playlists.filter(function(e){return!oe.isIncompatible(e)}),u=l.filter(oe.isEnabled);u.length||(u=l.filter(function(e){return!oe.isDisabled(e)}));var p=u.filter(oe.hasAttribute.bind(null,"BANDWIDTH")),m=p.map(function(e){var t=o.getSyncPoint(e,n,d,a),l=t?1:2,u=oe.estimateSegmentRequestTime(r,i,e);return{playlist:e,rebufferingImpact:u*l-s}}),g=m.filter(function(e){return 0>=e.rebufferingImpact});return(Pi(g,function(e,t){return Ui(t.playlist,e.playlist)}),g.length)?g[0]:(Pi(m,function(e,t){return e.rebufferingImpact-t.rebufferingImpact}),m[0]||null)},Ri=function(e,t,a){for(var i in a)if(!e[i]){t.trigger({type:"usage",name:"hls-608"});var n=t.textTracks().getTrackById(i);e[i]=n?n:t.addRemoteTextTrack({kind:"captions",id:i,label:i},!1).track}},Di=function(e){var t=e.inbandTextTracks,a=e.captionArray,i=e.timestampOffset;if(a){var n=window.WebKitDataCue||window.VTTCue;a.forEach(function(e){var a=e.stream,r=e.startTime,s=e.endTime;t[a]&&(r+=i,s+=i,t[a].addCue(new n(r,s,e.text)))})}},Ai=4,xi={parseSei:function(e){for(var t=0,a={payloadType:-1,payloadSize:0},n=0,r=0;t<e.byteLength&&e[t]!==128;){for(;255===e[t];)n+=255,t++;for(n+=e[t++];255===e[t];)r+=255,t++;if(r+=e[t++],!a.payload&&n===Ai){a.payloadType=n,a.payloadSize=r,a.payload=e.subarray(t,t+r);break}t+=r,n=0,r=0}return a},parseUserData:function(e){return 181===e.payload[0]?49==(e.payload[1]<<8|e.payload[2])?"GA94"===String.fromCharCode(e.payload[3],e.payload[4],e.payload[5],e.payload[6])?3===e.payload[7]?e.payload.subarray(8,e.payload.length-1):null:null:null:null},parseCaptionPackets:function(e,t){var a=[],n,r,s,d;if(!(64&t[0]))return a;for(r=31&t[0],n=0;n<r;n++)s=3*n,d={type:3&t[s+2],pts:e},4&t[s+2]&&(d.ccData=t[s+3]<<8|t[s+4],a.push(d));return a},discardEmulationPreventionBytes:function(e){for(var t=e.byteLength,a=[],n=1,r,s;n<t-2;)0===e[n]&&0===e[n+1]&&3===e[n+2]?(a.push(n+2),n+=2):n++;if(0===a.length)return e;r=t-a.length,s=new Uint8Array(r);var d=0;for(n=0;n<r;d++,n++)d===a[0]&&(d++,a.shift()),s[n]=e[d];return s},USER_DATA_REGISTERED_ITU_T_T35:Ai},Bi=function(){this.init=function(){var e={};this.on=function(t,a){e[t]||(e[t]=[]),e[t]=e[t].concat(a)},this.off=function(t,a){var i;return!!e[t]&&(i=e[t].indexOf(a),e[t]=e[t].slice(),e[t].splice(i,1),-1<i)},this.trigger=function(t){var a,n,r,s;if(a=e[t],!!a)if(2===arguments.length)for(r=a.length,n=0;n<r;++n)a[n].call(this,arguments[1]);else{for(s=[],n=arguments.length,n=1;n<arguments.length;++n)s.push(arguments[n]);for(r=a.length,n=0;n<r;++n)a[n].apply(this,s)}},this.dispose=function(){e={}}}};Bi.prototype.pipe=function(e){return this.on("data",function(t){e.push(t)}),this.on("done",function(t){e.flush(t)}),this.on("partialdone",function(t){e.partialFlush(t)}),this.on("endedtimeline",function(t){e.endTimeline(t)}),this.on("reset",function(t){e.reset(t)}),e},Bi.prototype.push=function(e){this.trigger("data",e)},Bi.prototype.flush=function(e){this.trigger("done",e)},Bi.prototype.partialFlush=function(e){this.trigger("partialdone",e)},Bi.prototype.endTimeline=function(e){this.trigger("endedtimeline",e)},Bi.prototype.reset=function(e){this.trigger("reset",e)};var Mi=Bi,wi=function e(){e.prototype.init.call(this),this.captionPackets_=[],this.ccStreams_=[new Wi(0,0),new Wi(0,1),new Wi(1,0),new Wi(1,1)],this.reset(),this.ccStreams_.forEach(function(e){e.on("data",this.trigger.bind(this,"data")),e.on("partialdone",this.trigger.bind(this,"partialdone")),e.on("done",this.trigger.bind(this,"done"))},this)};wi.prototype=new Mi,wi.prototype.push=function(e){var t,a,i;if("sei_rbsp"===e.nalUnitType)return(t=xi.parseSei(e.escapedRBSP),t.payloadType===xi.USER_DATA_REGISTERED_ITU_T_T35)?(a=xi.parseUserData(t),a?e.dts<this.latestDts_?void(this.ignoreNextEqualDts_=!0):e.dts===this.latestDts_&&this.ignoreNextEqualDts_?(this.numSameDts_--,void(this.numSameDts_||(this.ignoreNextEqualDts_=!1))):void(i=xi.parseCaptionPackets(e.pts,a),this.captionPackets_=this.captionPackets_.concat(i),this.latestDts_!==e.dts&&(this.numSameDts_=0),this.numSameDts_++,this.latestDts_=e.dts):void 0):void 0},wi.prototype.flushCCStreams=function(e){this.ccStreams_.forEach(function(t){return"flush"===e?t.flush():t.partialFlush()},this)},wi.prototype.flushStream=function(e){return this.captionPackets_.length?void(this.captionPackets_.forEach(function(e,t){e.presortIndex=t}),this.captionPackets_.sort(function(e,t){return e.pts===t.pts?e.presortIndex-t.presortIndex:e.pts-t.pts}),this.captionPackets_.forEach(function(e){2>e.type&&this.dispatchCea608Packet(e)},this),this.captionPackets_.length=0,this.flushCCStreams(e)):void this.flushCCStreams(e)},wi.prototype.flush=function(){return this.flushStream("flush")},wi.prototype.partialFlush=function(){return this.flushStream("partialFlush")},wi.prototype.reset=function(){this.latestDts_=null,this.ignoreNextEqualDts_=!1,this.numSameDts_=0,this.activeCea608Channel_=[null,null],this.ccStreams_.forEach(function(e){e.reset()})},wi.prototype.dispatchCea608Packet=function(e){this.setsTextOrXDSActive(e)?this.activeCea608Channel_[e.type]=null:this.setsChannel1Active(e)?this.activeCea608Channel_[e.type]=0:this.setsChannel2Active(e)&&(this.activeCea608Channel_[e.type]=1);null===this.activeCea608Channel_[e.type]||this.ccStreams_[(e.type<<1)+this.activeCea608Channel_[e.type]].push(e)},wi.prototype.setsChannel1Active=function(e){return 4096==(30720&e.ccData)},wi.prototype.setsChannel2Active=function(e){return 6144==(30720&e.ccData)},wi.prototype.setsTextOrXDSActive=function(e){return 256==(28928&e.ccData)||4138==(30974&e.ccData)||6186==(30974&e.ccData)};var Ni={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,304:174,305:176,306:189,307:191,308:8482,309:162,310:163,311:9834,312:224,313:160,314:232,315:226,316:234,317:238,318:244,319:251,544:193,545:201,546:211,547:218,548:220,549:252,550:8216,551:161,552:42,553:39,554:8212,555:169,556:8480,557:8226,558:8220,559:8221,560:192,561:194,562:199,563:200,564:202,565:203,566:235,567:206,568:207,569:239,570:212,571:217,572:249,573:219,574:171,575:187,800:195,801:227,802:205,803:204,804:236,805:210,806:242,807:213,808:245,809:123,810:125,811:92,812:94,813:95,814:124,815:126,816:196,817:228,818:214,819:246,820:223,821:165,822:164,823:9474,824:197,825:229,826:216,827:248,828:9484,829:9488,830:9492,831:9496},qi=function(e){return null===e?"":(e=Ni[e]||e,String.fromCharCode(e))},Fi=14,Gi=[4352,4384,4608,4640,5376,5408,5632,5664,5888,5920,4096,4864,4896,5120,5152],Hi=function(){for(var e=[],t=Fi+1;t--;)e.push("");return e},Wi=function e(t,a){e.prototype.init.call(this),this.field_=t||0,this.dataChannel_=a||0,this.name_="CC"+((this.field_<<1|this.dataChannel_)+1),this.setConstants(),this.reset(),this.push=function(e){var t,a,i,n,r;if(t=32639&e.ccData,t===this.lastControlCode_)return void(this.lastControlCode_=null);if(4096==(61440&t)?this.lastControlCode_=t:t!==this.PADDING_&&(this.lastControlCode_=null),i=t>>>8,n=255&t,t!==this.PADDING_)if(t===this.RESUME_CAPTION_LOADING_)this.mode_="popOn";else if(t===this.END_OF_CAPTION_)this.mode_="popOn",this.clearFormatting(e.pts),this.flushDisplayed(e.pts),a=this.displayed_,this.displayed_=this.nonDisplayed_,this.nonDisplayed_=a,this.startPts_=e.pts;else if(t===this.ROLL_UP_2_ROWS_)this.rollUpRows_=2,this.setRollUp(e.pts);else if(t===this.ROLL_UP_3_ROWS_)this.rollUpRows_=3,this.setRollUp(e.pts);else if(t===this.ROLL_UP_4_ROWS_)this.rollUpRows_=4,this.setRollUp(e.pts);else if(t===this.CARRIAGE_RETURN_)this.clearFormatting(e.pts),this.flushDisplayed(e.pts),this.shiftRowsUp_(),this.startPts_=e.pts;else if(t===this.BACKSPACE_)"popOn"===this.mode_?this.nonDisplayed_[this.row_]=this.nonDisplayed_[this.row_].slice(0,-1):this.displayed_[this.row_]=this.displayed_[this.row_].slice(0,-1);else if(t===this.ERASE_DISPLAYED_MEMORY_)this.flushDisplayed(e.pts),this.displayed_=Hi();else if(t===this.ERASE_NON_DISPLAYED_MEMORY_)this.nonDisplayed_=Hi();else if(t===this.RESUME_DIRECT_CAPTIONING_)"paintOn"!==this.mode_&&(this.flushDisplayed(e.pts),this.displayed_=Hi()),this.mode_="paintOn",this.startPts_=e.pts;else if(this.isSpecialCharacter(i,n))i=(3&i)<<8,r=qi(i|n),this[this.mode_](e.pts,r),this.column_++;else if(this.isExtCharacter(i,n))"popOn"===this.mode_?this.nonDisplayed_[this.row_]=this.nonDisplayed_[this.row_].slice(0,-1):this.displayed_[this.row_]=this.displayed_[this.row_].slice(0,-1),i=(3&i)<<8,r=qi(i|n),this[this.mode_](e.pts,r),this.column_++;else if(this.isMidRowCode(i,n))this.clearFormatting(e.pts),this[this.mode_](e.pts," "),this.column_++,14==(14&n)&&this.addFormatting(e.pts,["i"]),1==(1&n)&&this.addFormatting(e.pts,["u"]);else if(this.isOffsetControlCode(i,n))this.column_+=3&n;else if(this.isPAC(i,n)){var s=Gi.indexOf(7968&t);"rollUp"===this.mode_&&(0>s-this.rollUpRows_+1&&(s=this.rollUpRows_-1),this.setRollUp(e.pts,s)),s!==this.row_&&(this.clearFormatting(e.pts),this.row_=s),1&n&&-1===this.formatting_.indexOf("u")&&this.addFormatting(e.pts,["u"]),16==(16&t)&&(this.column_=4*((14&t)>>1)),this.isColorPAC(n)&&14==(14&n)&&this.addFormatting(e.pts,["i"])}else this.isNormalChar(i)&&(0===n&&(n=null),r=qi(i),r+=qi(n),this[this.mode_](e.pts,r),this.column_+=r.length)}};Wi.prototype=new Mi,Wi.prototype.flushDisplayed=function(e){var t=this.displayed_.map(function(e){try{return e.trim()}catch(t){return console.error("Skipping malformed caption."),""}}).join("\n").replace(/^\n+|\n+$/g,"");t.length&&this.trigger("data",{startPts:this.startPts_,endPts:e,text:t,stream:this.name_})},Wi.prototype.reset=function(){this.mode_="popOn",this.topRow_=0,this.startPts_=0,this.displayed_=Hi(),this.nonDisplayed_=Hi(),this.lastControlCode_=null,this.column_=0,this.row_=Fi,this.rollUpRows_=2,this.formatting_=[]},Wi.prototype.setConstants=function(){0===this.dataChannel_?(this.BASE_=16,this.EXT_=17,this.CONTROL_=(20|this.field_)<<8,this.OFFSET_=23):1===this.dataChannel_&&(this.BASE_=24,this.EXT_=25,this.CONTROL_=(28|this.field_)<<8,this.OFFSET_=31),this.PADDING_=0,this.RESUME_CAPTION_LOADING_=32|this.CONTROL_,this.END_OF_CAPTION_=47|this.CONTROL_,this.ROLL_UP_2_ROWS_=37|this.CONTROL_,this.ROLL_UP_3_ROWS_=38|this.CONTROL_,this.ROLL_UP_4_ROWS_=39|this.CONTROL_,this.CARRIAGE_RETURN_=45|this.CONTROL_,this.RESUME_DIRECT_CAPTIONING_=41|this.CONTROL_,this.BACKSPACE_=33|this.CONTROL_,this.ERASE_DISPLAYED_MEMORY_=44|this.CONTROL_,this.ERASE_NON_DISPLAYED_MEMORY_=46|this.CONTROL_},Wi.prototype.isSpecialCharacter=function(e,t){return e===this.EXT_&&48<=t&&63>=t},Wi.prototype.isExtCharacter=function(e,t){return(e===this.EXT_+1||e===this.EXT_+2)&&32<=t&&63>=t},Wi.prototype.isMidRowCode=function(e,t){return e===this.EXT_&&32<=t&&47>=t},Wi.prototype.isOffsetControlCode=function(e,t){return e===this.OFFSET_&&33<=t&&35>=t},Wi.prototype.isPAC=function(e,t){return e>=this.BASE_&&e<this.BASE_+8&&64<=t&&127>=t},Wi.prototype.isColorPAC=function(e){return 64<=e&&79>=e||96<=e&&127>=e},Wi.prototype.isNormalChar=function(e){return 32<=e&&127>=e},Wi.prototype.setRollUp=function(e,t){if("rollUp"!==this.mode_&&(this.row_=Fi,this.mode_="rollUp",this.flushDisplayed(e),this.nonDisplayed_=Hi(),this.displayed_=Hi()),void 0!==t&&t!==this.row_)for(var a=0;a<this.rollUpRows_;a++)this.displayed_[t-a]=this.displayed_[this.row_-a],this.displayed_[this.row_-a]="";void 0===t&&(t=this.row_),this.topRow_=t-this.rollUpRows_+1},Wi.prototype.addFormatting=function(e,t){this.formatting_=this.formatting_.concat(t);var a=t.reduce(function(e,t){return e+"<"+t+">"},"");this[this.mode_](e,a)},Wi.prototype.clearFormatting=function(e){if(this.formatting_.length){var t=this.formatting_.reverse().reduce(function(e,t){return e+"</"+t+">"},"");this.formatting_=[],this[this.mode_](e,t)}},Wi.prototype.popOn=function(e,t){var a=this.nonDisplayed_[this.row_];a+=t,this.nonDisplayed_[this.row_]=a},Wi.prototype.rollUp=function(e,t){var a=this.displayed_[this.row_];a+=t,this.displayed_[this.row_]=a},Wi.prototype.shiftRowsUp_=function(){var e;for(e=0;e<this.topRow_;e++)this.displayed_[e]="";for(e=this.row_+1;e<Fi+1;e++)this.displayed_[e]="";for(e=this.topRow_;e<this.row_;e++)this.displayed_[e]=this.displayed_[e+1];this.displayed_[this.row_]=""},Wi.prototype.paintOn=function(e,t){var a=this.displayed_[this.row_];a+=t,this.displayed_[this.row_]=a};var Vi=xi.discardEmulationPreventionBytes,zi={CaptionStream:wi,Cea608Stream:Wi}.CaptionStream,ji=function(e,t){for(var a=e,n=0,r;n<t.length;n++){if(r=t[n],a<r.size)return r;a-=r.size}return null},Yi=function(e,t,a){var n=new DataView(e.buffer,e.byteOffset,e.byteLength),r=[],s,d,o,l;for(d=0;d+4<e.length;d+=o)if(o=n.getUint32(d),d+=4,!(0>=o))switch(31&e[d]){case 6:var u=e.subarray(d+1,d+1+o),p=ji(d,t);s={nalUnitType:"sei_rbsp",size:o,data:u,escapedRBSP:Vi(u),trackId:a},p?(s.pts=p.pts,s.dts=p.dts,l=p):(s.pts=l.pts,s.dts=l.dts),r.push(s);break;default:}return r},Xi=function(e,t,a){var i=t,n=a.defaultSampleDuration||0,r=a.defaultSampleSize||0,s=a.trackId,d=[];return e.forEach(function(e){var t=Ya.parseTrun(e),a=t.samples;a.forEach(function(e){void 0===e.duration&&(e.duration=n),void 0===e.size&&(e.size=r),e.trackId=s,e.dts=i,void 0===e.compositionTimeOffset&&(e.compositionTimeOffset=0),e.pts=i+e.compositionTimeOffset,i+=e.duration}),d=d.concat(a)}),d},Ki=function(e,t){var a=gi.findBox(e,["moof","traf"]),i=gi.findBox(e,["mdat"]),n={},r=[];return i.forEach(function(e,t){var i=a[t];r.push({mdat:e,traf:i})}),r.forEach(function(e){var a=e.mdat,i=e.traf,r=gi.findBox(i,["tfhd"]),s=Ya.parseTfhd(r[0]),d=s.trackId,o=gi.findBox(i,["tfdt"]),l=0<o.length?Ya.parseTfdt(o[0]).baseMediaDecodeTime:0,u=gi.findBox(i,["trun"]),p,m;t===d&&0<u.length&&(p=Xi(u,l,s),m=Yi(a,p,d),!n[d]&&(n[d]=[]),n[d]=n[d].concat(m))}),n},Qi=function(e,t,a){var i;return null===t?null:(i=Ki(e,t),{seiNals:i[t],timescale:a})},Ji=function(){var e=!1,t,a,i,n,r,s;this.isInitialized=function(){return e},this.init=function(a){t=new zi,e=!0,s=!!a&&a.isPartial,t.on("data",function(e){e.startTime=e.startPts/n,e.endTime=e.endPts/n,r.captions.push(e),r.captionStreams[e.stream]=!0})},this.isNewInit=function(e,t){return!(e&&0===e.length||t&&"object"==typeof t&&0===Object.keys(t).length)&&(i!==e[0]||n!==t[i])},this.parse=function(e,t,s){var d;if(!this.isInitialized())return null;if(!t||!s)return null;if(this.isNewInit(t,s))i=t[0],n=s[i];else if(null===i||!n)return a.push(e),null;for(;0<a.length;){var o=a.shift();this.parse(o,t,s)}return(d=Qi(e,i,n),null===d||!d.seiNals)?null:(this.pushNals(d.seiNals),this.flushStream(),r)},this.pushNals=function(e){return this.isInitialized()&&e&&0!==e.length?void e.forEach(function(e){t.push(e)}):null},this.flushStream=function(){return this.isInitialized()?void(s?t.partialFlush():t.flush()):null},this.clearParsedCaptions=function(){r.captions=[],r.captionStreams={}},this.resetCaptionStream=function(){return this.isInitialized()?void t.reset():null},this.clearAllCaptions=function(){this.clearParsedCaptions(),this.resetCaptionStream()},this.reset=function(){a=[],i=null,n=null,r?this.clearParsedCaptions():r={captions:[],captionStreams:{}},this.resetCaptionStream()},this.reset()},Zi=function(e,t,a){if(!e||!t)return!1;var i=e.segments,n=a===i.length;return e.endList&&"open"===t.readyState&&n},$i=function(e){return"number"==typeof e&&isFinite(e)},en=function(e,t,a){return"main"===e&&t&&a?a.containsAudio||a.containsVideo?t.containsVideo&&!a.containsVideo?"Only audio found in segment when we expected video. We can't switch to audio only from a stream that had video. To get rid of this message, please add codec information to the manifest.":!t.containsVideo&&a.containsVideo?"Video found in segment when we expected only audio. We can't switch to a stream with video from an audio only stream. To get rid of this message, please add codec information to the manifest.":null:"Neither audio nor video found in segment.":null},tn=function(e,t,a){var i;return i=e.length&&0<e.start(0)&&e.start(0)<t?e.start(0):t-30,Math.min(i,t-a)},an=function(e){var t=e.segment,a=t.start,i=t.end,n=e.playlist,r=n.mediaSequence,s=n.id,d=n.segments,o=d===void 0?[]:d,l=e.mediaIndex,u=e.timeline;return["appending ["+l+"] of ["+r+", "+(r+o.length)+"] from playlist ["+s+"]","["+a+" => "+i+"] in timeline ["+u+"]"].join(" ")},nn=function(e){function a(e){P(this,a);var t=R(this,(a.__proto__||Object.getPrototypeOf(a)).call(this));if(!e)throw new TypeError("Initialization settings are required");if("function"!=typeof e.currentTime)throw new TypeError("No currentTime getter specified");if(!e.mediaSource)throw new TypeError("No MediaSource specified");return t.bandwidth=e.bandwidth,t.throughput={rate:0,count:0},t.roundTrip=NaN,t.resetStats_(),t.mediaIndex=null,t.hasPlayed_=e.hasPlayed,t.currentTime_=e.currentTime,t.seekable_=e.seekable,t.seeking_=e.seeking,t.duration_=e.duration,t.mediaSource_=e.mediaSource,t.hls_=e.hls,t.loaderType_=e.loaderType,t.startingMedia_=void 0,t.segmentMetadataTrack_=e.segmentMetadataTrack,t.goalBufferLength_=e.goalBufferLength,t.sourceType_=e.sourceType,t.inbandTextTracks_=e.inbandTextTracks,t.state_="INIT",t.checkBufferTimeout_=null,t.error_=void 0,t.currentTimeline_=-1,t.pendingSegment_=null,t.mimeType_=null,t.sourceUpdater_=null,t.xhrOptions_=null,t.activeInitSegmentId_=null,t.initSegments_={},t.cacheEncryptionKeys_=e.cacheEncryptionKeys,t.keyCache_={},t.captionParser_="main"===t.loaderType_?new Ji:null,t.decrypter_=e.decrypter,t.syncController_=e.syncController,t.syncPoint_={segmentIndex:0,time:0},t.syncController_.on("syncinfoupdate",function(){return t.trigger("syncinfoupdate")}),t.mediaSource_.addEventListener("sourceopen",function(){return t.ended_=!1}),t.fetchAtBuffer_=!1,t.logger_=ii("SegmentLoader["+t.loaderType_+"]"),Object.defineProperty(t,"state",{get:function(){return this.state_},set:function(e){e!==this.state_&&(this.logger_(this.state_+" -> "+e),this.state_=e)}}),t}return O(a,e),U(a,[{key:"resetStats_",value:function(){this.mediaBytesTransferred=0,this.mediaRequests=0,this.mediaRequestsAborted=0,this.mediaRequestsTimedout=0,this.mediaRequestsErrored=0,this.mediaTransferDuration=0,this.mediaSecondsLoaded=0}},{key:"dispose",value:function(){this.state="DISPOSED",this.pause(),this.abort_(),this.sourceUpdater_&&this.sourceUpdater_.dispose(),this.resetStats_(),this.captionParser_&&this.captionParser_.reset()}},{key:"abort",value:function(){return"WAITING"===this.state?void(this.abort_(),this.state="READY",!this.paused()&&this.monitorBuffer_()):void(this.pendingSegment_&&(this.pendingSegment_=null))}},{key:"abort_",value:function(){this.pendingSegment_&&this.pendingSegment_.abortRequests(),this.pendingSegment_=null}},{key:"error",value:function(e){return"undefined"!=typeof e&&(this.error_=e),this.pendingSegment_=null,this.error_}},{key:"endOfStream",value:function(){this.ended_=!0,this.pause(),this.trigger("ended")}},{key:"buffered_",value:function(){return this.sourceUpdater_?this.sourceUpdater_.buffered():t.createTimeRanges()}},{key:"initSegment",value:function(e){var t=!!(1<arguments.length&&void 0!==arguments[1])&&arguments[1];if(!e)return null;var a=Oe(e),i=this.initSegments_[a];return t&&!i&&e.bytes&&(this.initSegments_[a]=i={resolvedUri:e.resolvedUri,byterange:e.byterange,bytes:e.bytes,timescales:e.timescales,videoTrackIds:e.videoTrackIds}),i||e}},{key:"segmentKey",value:function(e){var t=!!(1<arguments.length&&void 0!==arguments[1])&&arguments[1];if(!e)return null;var a=Re(e),i=this.keyCache_[a];this.cacheEncryptionKeys_&&t&&!i&&e.bytes&&(this.keyCache_[a]=i={resolvedUri:e.resolvedUri,bytes:e.bytes});var n={resolvedUri:(i||e).resolvedUri};return i&&(n.bytes=i.bytes),n}},{key:"couldBeginLoading_",value:function(){return this.playlist_&&(this.sourceUpdater_||this.mimeType_&&"INIT"===this.state)&&!this.paused()}},{key:"load",value:function(){if(this.monitorBuffer_(),!!this.playlist_)return this.syncController_.setDateTimeMapping(this.playlist_),"INIT"===this.state&&this.couldBeginLoading_()?this.init_():void(!this.couldBeginLoading_()||"READY"!==this.state&&"INIT"!==this.state||(this.state="READY"))}},{key:"init_",value:function(){return this.state="READY",this.sourceUpdater_=new ni(this.mediaSource_,this.mimeType_,this.loaderType_,this.sourceBufferEmitter_),this.resetEverything(),this.monitorBuffer_()}},{key:"playlist",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};if(e){var a=this.playlist_,i=this.pendingSegment_;this.playlist_=e,this.xhrOptions_=t,this.hasPlayed_()||(e.syncInfo={mediaSequence:e.mediaSequence,time:0});var n=null;if(a&&(a.id?n=a.id:a.uri&&(n=a.uri)),this.logger_("playlist update ["+n+" => "+(e.id||e.uri)+"]"),this.trigger("syncinfoupdate"),"INIT"===this.state&&this.couldBeginLoading_())return this.init_();if(!a||a.uri!==e.uri)return void(null!==this.mediaIndex&&this.resyncLoader());var r=e.mediaSequence-a.mediaSequence;this.logger_("live window shift ["+r+"]"),null!==this.mediaIndex&&(this.mediaIndex-=r),i&&(i.mediaIndex-=r,0<=i.mediaIndex&&(i.segment=e.segments[i.mediaIndex])),this.syncController_.saveExpiredSegmentInfo(a,e)}}},{key:"pause",value:function(){this.checkBufferTimeout_&&(h.clearTimeout(this.checkBufferTimeout_),this.checkBufferTimeout_=null)}},{key:"paused",value:function(){return null===this.checkBufferTimeout_}},{key:"mimeType",value:function(e,t){this.mimeType_||(this.mimeType_=e,this.sourceBufferEmitter_=t,"INIT"===this.state&&this.couldBeginLoading_()&&this.init_())}},{key:"resetEverything",value:function(e){this.ended_=!1,this.resetLoader(),this.remove(0,this.duration_(),e),this.captionParser_&&this.captionParser_.clearAllCaptions(),this.trigger("reseteverything")}},{key:"resetLoader",value:function(){this.fetchAtBuffer_=!1,this.resyncLoader()}},{key:"resyncLoader",value:function(){this.mediaIndex=null,this.syncPoint_=null,this.abort()}},{key:"remove",value:function(e,t,a){if(this.sourceUpdater_&&this.sourceUpdater_.remove(e,t,a),$e(e,t,this.segmentMetadataTrack_),this.inbandTextTracks_)for(var i in this.inbandTextTracks_)$e(e,t,this.inbandTextTracks_[i])}},{key:"monitorBuffer_",value:function(){this.checkBufferTimeout_&&h.clearTimeout(this.checkBufferTimeout_),this.checkBufferTimeout_=h.setTimeout(this.monitorBufferTick_.bind(this),1)}},{key:"monitorBufferTick_",value:function(){"READY"===this.state&&this.fillBuffer_(),this.checkBufferTimeout_&&h.clearTimeout(this.checkBufferTimeout_),this.checkBufferTimeout_=h.setTimeout(this.monitorBufferTick_.bind(this),500)}},{key:"fillBuffer_",value:function(){if(!this.sourceUpdater_.updating()){this.syncPoint_||(this.syncPoint_=this.syncController_.getSyncPoint(this.playlist_,this.duration_(),this.currentTimeline_,this.currentTime_()));var e=this.checkBuffer_(this.buffered_(),this.playlist_,this.mediaIndex,this.hasPlayed_(),this.currentTime_(),this.syncPoint_);return e?this.isEndOfStream_(e.mediaIndex)?void this.endOfStream():void(e.mediaIndex===this.playlist_.segments.length-1&&"ended"===this.mediaSource_.readyState&&!this.seeking_()||(e.timeline!==this.currentTimeline_&&(this.syncController_.reset(),e.timestampOffset=e.startOfSegment,this.captionParser_&&this.captionParser_.clearAllCaptions()),this.loadSegment_(e))):void 0}}},{key:"isEndOfStream_",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:this.playlist_;return Zi(t,this.mediaSource_,e)&&!this.sourceUpdater_.updating()}},{key:"checkBuffer_",value:function(e,t,a,i,n,r){var s=0,d=void 0;e.length&&(s=e.end(e.length-1));var o=Math.max(0,s-n);if(!t.segments.length)return null;if(o>=this.goalBufferLength_())return null;if(!i&&1<=o)return null;if(null===r)return a=this.getSyncSegmentCandidate_(t),this.generateSegmentInfo_(t,a,null,!0);if(null!==a){t.segments[a];return d=s,this.generateSegmentInfo_(t,a+1,d,!1)}if(this.fetchAtBuffer_){var l=oe.getMediaInfoForTime(t,s,r.segmentIndex,r.time);a=l.mediaIndex,d=l.startTime}else{var u=oe.getMediaInfoForTime(t,n,r.segmentIndex,r.time);a=u.mediaIndex,d=u.startTime}return this.generateSegmentInfo_(t,a,d,!1)}},{key:"getSyncSegmentCandidate_",value:function(e){var t=this;if(-1===this.currentTimeline_)return 0;var a=e.segments.map(function(e,t){return{timeline:e.timeline,segmentIndex:t}}).filter(function(e){return e.timeline===t.currentTimeline_});return a.length?a[Math.min(a.length-1,1)].segmentIndex:Math.max(e.segments.length-1,0)}},{key:"generateSegmentInfo_",value:function(e,t,a,i){if(0>t||t>=e.segments.length)return null;var n=e.segments[t];return{requestId:"segment-loader-"+Math.random(),uri:n.resolvedUri,mediaIndex:t,isSyncRequest:i,startOfSegment:a,playlist:e,bytes:null,encryptedBytes:null,timestampOffset:null,timeline:n.timeline,duration:n.duration,segment:n}}},{key:"abortRequestEarly_",value:function(e){if(this.hls_.tech_.paused()||!this.xhrOptions_.timeout||!this.playlist_.attributes.BANDWIDTH)return!1;if(1e3>Date.now()-(e.firstBytesReceivedAt||Date.now()))return!1;var t=this.currentTime_(),a=e.bandwidth,i=this.pendingSegment_.duration,n=oe.estimateSegmentRequestTime(i,a,this.playlist_,e.bytesReceived),r=Qe(this.buffered_(),t,this.hls_.tech_.playbackRate())-1;if(n<=r)return!1;var s=Oi({master:this.hls_.playlists.master,currentTime:t,bandwidth:a,duration:this.duration_(),segmentDuration:i,timeUntilRebuffer:r,currentTimeline:this.currentTimeline_,syncController:this.syncController_});if(s){var d=n-r-s.rebufferingImpact,o=.5;return(r<=We&&(o=1),s.playlist&&s.playlist.uri!==this.playlist_.uri&&!(d<o))&&(this.bandwidth=s.playlist.attributes.BANDWIDTH*ri.BANDWIDTH_VARIANCE+1,this.abort(),this.trigger("earlyabort"),!0)}}},{key:"handleProgress_",value:function(e,t){!this.pendingSegment_||t.requestId!==this.pendingSegment_.requestId||this.abortRequestEarly_(t.stats)||this.trigger("progress")}},{key:"loadSegment_",value:function(e){this.state="WAITING",this.pendingSegment_=e,this.trimBackBuffer_(e),e.abortRequests=Ii(this.hls_.xhr,this.xhrOptions_,this.decrypter_,this.captionParser_,this.createSimplifiedSegmentObj_(e),this.handleProgress_.bind(this),this.segmentRequestFinished_.bind(this))}},{key:"trimBackBuffer_",value:function(){var e=tn(this.seekable_(),this.currentTime_(),this.playlist_.targetDuration||10);0<e&&this.remove(0,e)}},{key:"createSimplifiedSegmentObj_",value:function(e){var t=e.segment,a={resolvedUri:t.resolvedUri,byterange:t.byterange,requestId:e.requestId};if(t.key){var i=t.key.iv||new Uint32Array([0,0,0,e.mediaIndex+e.playlist.mediaSequence]);a.key=this.segmentKey(t.key),a.key.iv=i}return t.map&&(a.map=this.initSegment(t.map)),a}},{key:"segmentRequestFinished_",value:function(e,t){return this.mediaRequests+=1,t.stats&&(this.mediaBytesTransferred+=t.stats.bytesReceived,this.mediaTransferDuration+=t.stats.roundTripTime),this.pendingSegment_?t.requestId===this.pendingSegment_.requestId?e?(this.pendingSegment_=null,this.state="READY",e.code===ci.ABORTED)?void(this.mediaRequestsAborted+=1):(this.pause(),e.code===ci.TIMEOUT)?(this.mediaRequestsTimedout+=1,this.bandwidth=1,this.roundTrip=NaN,void this.trigger("bandwidthupdate")):(this.mediaRequestsErrored+=1,this.error(e),void this.trigger("error")):void(this.bandwidth=t.stats.bandwidth,this.roundTrip=t.stats.roundTripTime,t.map&&(t.map=this.initSegment(t.map,!0)),t.key&&this.segmentKey(t.key,!0),this.processSegmentResponse_(t)):void 0:void(this.mediaRequestsAborted+=1)}},{key:"processSegmentResponse_",value:function(e){var t=this.pendingSegment_;t.bytes=e.bytes,e.map&&(t.segment.map.bytes=e.map.bytes),t.endOfAllRequests=e.endOfAllRequests,e.fmp4Captions&&(Ri(this.inbandTextTracks_,this.hls_.tech_,e.captionStreams),Di({inbandTextTracks:this.inbandTextTracks_,captionArray:e.fmp4Captions,timestampOffset:0}),this.captionParser_&&this.captionParser_.clearParsedCaptions()),this.handleSegment_()}},{key:"handleSegment_",value:function(){var e=this;if(!this.pendingSegment_)return void(this.state="READY");var t=this.pendingSegment_,a=t.segment,i=this.syncController_.probeSegmentInfo(t);"undefined"==typeof this.startingMedia_&&i&&(i.containsAudio||i.containsVideo)&&(this.startingMedia_={containsAudio:i.containsAudio,containsVideo:i.containsVideo});var n=en(this.loaderType_,this.startingMedia_,i);if(n)return this.error({message:n,blacklistDuration:1/0}),void this.trigger("error");if(t.isSyncRequest)return this.trigger("syncinfoupdate"),this.pendingSegment_=null,void(this.state="READY");if(null!==t.timestampOffset&&t.timestampOffset!==this.sourceUpdater_.timestampOffset()){if(i&&i.segmentTimestampInfo){var r=i.segmentTimestampInfo[0].ptsTime,s=i.segmentTimestampInfo[0].dtsTime;t.timestampOffset-=r-s}this.sourceUpdater_.timestampOffset(t.timestampOffset),this.trigger("timestampoffset")}var d=this.syncController_.mappingForTimeline(t.timeline);if(null!==d&&this.trigger({type:"segmenttimemapping",mapping:d}),this.state="APPENDING",a.map){var o=Oe(a.map);if(!this.activeInitSegmentId_||this.activeInitSegmentId_!==o){var l=this.initSegment(a.map);this.sourceUpdater_.appendBuffer({bytes:l.bytes},function(){e.activeInitSegmentId_=o})}}t.byteLength=t.bytes.byteLength,this.mediaSecondsLoaded+="number"==typeof a.start&&"number"==typeof a.end?a.end-a.start:a.duration,this.logger_(an(t)),this.sourceUpdater_.appendBuffer({bytes:t.bytes,videoSegmentTimingInfoCallback:this.handleVideoSegmentTimingInfo_.bind(this,t.requestId)},this.handleUpdateEnd_.bind(this))}},{key:"handleVideoSegmentTimingInfo_",value:function(e,t){if(this.pendingSegment_&&e===this.pendingSegment_.requestId){var a=this.pendingSegment_.segment;a.videoTimingInfo||(a.videoTimingInfo={}),a.videoTimingInfo.transmuxerPrependedSeconds=t.videoSegmentTimingInfo.prependedContentDuration||0,a.videoTimingInfo.transmuxedPresentationStart=t.videoSegmentTimingInfo.start.presentation,a.videoTimingInfo.transmuxedPresentationEnd=t.videoSegmentTimingInfo.end.presentation,a.videoTimingInfo.baseMediaDecodeTime=t.videoSegmentTimingInfo.baseMediaDecodeTime}}},{key:"handleUpdateEnd_",value:function(){if(!this.pendingSegment_)return this.state="READY",void(this.paused()||this.monitorBuffer_());var e=this.pendingSegment_,t=e.segment,a=null!==this.mediaIndex;return this.pendingSegment_=null,this.recordThroughput_(e),this.addSegmentMetadataCue_(e),this.state="READY",this.mediaIndex=e.mediaIndex,this.fetchAtBuffer_=!0,this.currentTimeline_=e.timeline,this.trigger("syncinfoupdate"),t.end&&this.currentTime_()-t.end>3*e.playlist.targetDuration?void this.resetEverything():void(a&&this.trigger("bandwidthupdate"),this.trigger("progress"),this.isEndOfStream_(e.mediaIndex+1,e.playlist)&&this.endOfStream(),!this.paused()&&this.monitorBuffer_())}},{key:"recordThroughput_",value:function(e){var t=this.throughput.rate,a=Date.now()-e.endOfAllRequests+1,i=Math.floor(1e3*(8*(e.byteLength/a)));this.throughput.rate+=(i-t)/++this.throughput.count}},{key:"addSegmentMetadataCue_",value:function(e){if(this.segmentMetadataTrack_){var t=e.segment,a=t.start,i=t.end;if($i(a)&&$i(i)){$e(a,i,this.segmentMetadataTrack_);var n=h.WebKitDataCue||h.VTTCue,r={custom:t.custom,dateTimeObject:t.dateTimeObject,dateTimeString:t.dateTimeString,bandwidth:e.playlist.attributes.BANDWIDTH,resolution:e.playlist.attributes.RESOLUTION,codecs:e.playlist.attributes.CODECS,byteLength:e.byteLength,uri:e.uri,timeline:e.timeline,playlist:e.playlist.uri,start:a,end:i},s=JSON.stringify(r),d=new n(a,i,s);d.value=r,this.segmentMetadataTrack_.addCue(d)}}}}]),a}(t.EventTarget),rn=function(e){return decodeURIComponent(escape(String.fromCharCode.apply(null,e)))},sn=new Uint8Array(["\n","\n"].map(function(e){return e.charCodeAt(0)})),dn=function(e){function a(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};P(this,a);var i=R(this,(a.__proto__||Object.getPrototypeOf(a)).call(this,e,t));return i.mediaSource_=null,i.subtitlesTrack_=null,i}return O(a,e),U(a,[{key:"buffered_",value:function(){if(!this.subtitlesTrack_||!this.subtitlesTrack_.cues.length)return t.createTimeRanges();var e=this.subtitlesTrack_.cues,a=e[0].startTime,i=e[e.length-1].startTime;return t.createTimeRanges([[a,i]])}},{key:"initSegment",value:function(e){var t=!!(1<arguments.length&&void 0!==arguments[1])&&arguments[1];if(!e)return null;var a=Oe(e),i=this.initSegments_[a];if(t&&!i&&e.bytes){var n=sn.byteLength+e.bytes.byteLength,r=new Uint8Array(n);r.set(e.bytes),r.set(sn,e.bytes.byteLength),this.initSegments_[a]=i={resolvedUri:e.resolvedUri,byterange:e.byterange,bytes:r}}return i||e}},{key:"couldBeginLoading_",value:function(){return this.playlist_&&this.subtitlesTrack_&&!this.paused()}},{key:"init_",value:function(){return this.state="READY",this.resetEverything(),this.monitorBuffer_()}},{key:"track",value:function(e){return"undefined"==typeof e?this.subtitlesTrack_:(this.subtitlesTrack_=e,"INIT"===this.state&&this.couldBeginLoading_()&&this.init_(),this.subtitlesTrack_)}},{key:"remove",value:function(e,t){$e(e,t,this.subtitlesTrack_)}},{key:"fillBuffer_",value:function(){var e=this;this.syncPoint_||(this.syncPoint_=this.syncController_.getSyncPoint(this.playlist_,this.duration_(),this.currentTimeline_,this.currentTime_()));var t=this.checkBuffer_(this.buffered_(),this.playlist_,this.mediaIndex,this.hasPlayed_(),this.currentTime_(),this.syncPoint_);if(t=this.skipEmptySegments_(t),!!t){if(null===this.syncController_.timestampOffsetForTimeline(t.timeline)){var a=function(){e.state="READY",e.paused()||e.monitorBuffer_()};return this.syncController_.one("timestampoffset",a),void(this.state="WAITING_ON_TIMELINE")}this.loadSegment_(t)}}},{key:"skipEmptySegments_",value:function(e){for(;e&&e.segment.empty;)e=this.generateSegmentInfo_(e.playlist,e.mediaIndex+1,e.startOfSegment+e.duration,e.isSyncRequest);return e}},{key:"handleSegment_",value:function(){var e=this;if(!this.pendingSegment_||!this.subtitlesTrack_)return void(this.state="READY");this.state="APPENDING";var t=this.pendingSegment_,a=t.segment;if("function"!=typeof h.WebVTT&&this.subtitlesTrack_&&this.subtitlesTrack_.tech_){var i=void 0,n=function(){e.subtitlesTrack_.tech_.off("vttjsloaded",i),e.error({message:"Error loading vtt.js"}),e.state="READY",e.pause(),e.trigger("error")};return i=function(){e.subtitlesTrack_.tech_.off("vttjserror",n),e.handleSegment_()},this.state="WAITING_ON_VTTJS",this.subtitlesTrack_.tech_.one("vttjsloaded",i),void this.subtitlesTrack_.tech_.one("vttjserror",n)}a.requested=!0;try{this.parseVTTCues_(t)}catch(t){return this.error({message:t.message}),this.state="READY",this.pause(),this.trigger("error")}return this.updateTimeMapping_(t,this.syncController_.timelines[t.timeline],this.playlist_),t.isSyncRequest?(this.trigger("syncinfoupdate"),this.pendingSegment_=null,void(this.state="READY")):void(t.byteLength=t.bytes.byteLength,this.mediaSecondsLoaded+=a.duration,t.cues.length&&this.remove(t.cues[0].endTime,t.cues[t.cues.length-1].endTime),t.cues.forEach(function(t){e.subtitlesTrack_.addCue(t)}),this.handleUpdateEnd_())}},{key:"parseVTTCues_",value:function(e){var a=void 0,i=!1;"function"==typeof h.TextDecoder?a=new h.TextDecoder("utf8"):(a=h.WebVTT.StringDecoder(),i=!0);var n=new h.WebVTT.Parser(h,h.vttjs,a);if(e.cues=[],e.timestampmap={MPEGTS:0,LOCAL:0},n.oncue=e.cues.push.bind(e.cues),n.ontimestampmap=function(t){return e.timestampmap=t},n.onparsingerror=function(e){t.log.warn("Error encountered when parsing cues: "+e.message)},e.segment.map){var r=e.segment.map.bytes;i&&(r=rn(r)),n.parse(r)}var s=e.bytes;i&&(s=rn(s)),n.parse(s),n.flush()}},{key:"updateTimeMapping_",value:function(e,t,a){var i=e.segment;if(t){if(!e.cues.length)return void(i.empty=!0);var n=e.timestampmap,r=n.MPEGTS/9e4-n.LOCAL+t.mapping;if(e.cues.forEach(function(e){e.startTime+=r,e.endTime+=r}),!a.syncInfo){var s=e.cues[0].startTime,d=e.cues[e.cues.length-1].startTime;a.syncInfo={mediaSequence:a.mediaSequence+e.mediaIndex,time:Math.min(s,d-i.duration)}}}}}]),a}(nn),on=function(e,t){for(var a=e.cues,n=0,r;n<a.length;n++)if(r=a[n],t>=r.adStartTime&&t<=r.adEndTime)return r;return null},ln=function(e,t){var a=2<arguments.length&&arguments[2]!==void 0?arguments[2]:0;if(e.segments)for(var n=a,r=void 0,s=0,d;s<e.segments.length;s++){if(d=e.segments[s],r||(r=on(t,n+d.duration/2)),r){if("cueIn"in d){r.endTime=n,r.adEndTime=n,n+=d.duration,r=null;continue}if(n<r.endTime){n+=d.duration;continue}r.endTime+=d.duration}else if("cueOut"in d&&(r=new h.VTTCue(n,n+d.duration,d.cueOut),r.adStartTime=n,r.adEndTime=n+parseFloat(d.cueOut),t.addCue(r)),"cueOutCont"in d){var o=void 0,l=void 0,u=d.cueOutCont.split("/").map(parseFloat),p=D(u,2);o=p[0],l=p[1],r=new h.VTTCue(n,n+d.duration,""),r.adStartTime=n-o,r.adEndTime=r.adStartTime+l,t.addCue(r)}n+=d.duration}},un={H264_STREAM_TYPE:27,ADTS_STREAM_TYPE:15,METADATA_STREAM_TYPE:21},pn="shared",mn=function(e,t){var a=1;for(e>t&&(a=-1);Math.abs(t-e)>4294967296;)e+=a*8589934592;return e},gn=function e(t){var a,i;e.prototype.init.call(this),this.type_=t||pn,this.push=function(e){this.type_!==pn&&e.type!==this.type_||(i===void 0&&(i=e.dts),e.dts=mn(e.dts,i),e.pts=mn(e.pts,i),a=e.dts,this.trigger("data",e))},this.flush=function(){i=a,this.trigger("done")},this.endTimeline=function(){this.flush(),this.trigger("endedtimeline")},this.discontinuity=function(){i=void 0,a=void 0},this.reset=function(){this.discontinuity(),this.trigger("reset")}};gn.prototype=new Mi;var cn=function(e){var t=31&e[1];return t<<=8,t|=e[2],t},yn=function(e){return!!(64&e[1])},fn=function(e){var t=0;return 1<(48&e[3])>>>4&&(t+=e[4]+1),t},_n=function(e){return 5===e?"slice_layer_without_partitioning_rbsp_idr":6===e?"sei_rbsp":7===e?"seq_parameter_set_rbsp":8===e?"pic_parameter_set_rbsp":9===e?"access_unit_delimiter_rbsp":null},hn=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350],bn=function(e){return e[0]<<21|e[1]<<14|e[2]<<7|e[3]},Tn=function(e,t,a){var n="",r;for(r=t;r<a;r++)n+="%"+("00"+e[r].toString(16)).slice(-2);return n},Sn=function(e,t,a){return unescape(Tn(e,t,a))},kn=9e4,vn,Ln,In,En,Pn,Un,Cn;vn=function(e){return e*kn},Ln=function(e,t){return e*t},In=function(e){return e/kn},En=function(e,t){return e/t},Pn=function(e,t){return vn(En(e,t))},Un=function(e,t){return Ln(In(e),t)},Cn=function(e,t,a){return In(a?e:e-t)};var On={ONE_SECOND_IN_TS:kn,secondsToVideoTs:vn,secondsToAudioTs:Ln,videoTsToSeconds:In,audioTsToSeconds:En,audioTsToVideoTs:Pn,videoTsToAudioTs:Un,metadataTsToSeconds:Cn},Rn={TimestampRolloverStream:gn,handleRollover:mn}.handleRollover,Dn={};Dn.ts={parseType:function(e,t){var a=cn(e);if(0===a)return"pat";return a===t?"pmt":t?"pes":null},parsePat:function(e){var t=yn(e),a=4+fn(e);return t&&(a+=e[a]+1),(31&e[a+10])<<8|e[a+11]},parsePmt:function(e){var t={},a=yn(e),n=4+fn(e);if(a&&(n+=e[n]+1),!!(1&e[n+5])){var r,s,d;r=(15&e[n+1])<<8|e[n+2],s=3+r-4,d=(15&e[n+10])<<8|e[n+11];for(var o=12+d,l;o<s;)l=n+o,t[(31&e[l+1])<<8|e[l+2]]=e[l],o+=((15&e[l+3])<<8|e[l+4])+5;return t}},parsePayloadUnitStartIndicator:yn,parsePesType:function(e,t){var a=cn(e),i=t[a];return i===un.H264_STREAM_TYPE?"video":i===un.ADTS_STREAM_TYPE?"audio":i===un.METADATA_STREAM_TYPE?"timed-metadata":null},parsePesTime:function(e){var t=yn(e);if(!t)return null;var a=4+fn(e);if(a>=e.byteLength)return null;var i=null,n;return n=e[a+7],192&n&&(i={},i.pts=(14&e[a+9])<<27|(255&e[a+10])<<20|(254&e[a+11])<<12|(255&e[a+12])<<5|(254&e[a+13])>>>3,i.pts*=4,i.pts+=(6&e[a+13])>>>1,i.dts=i.pts,64&n&&(i.dts=(14&e[a+14])<<27|(255&e[a+15])<<20|(254&e[a+16])<<12|(255&e[a+17])<<5|(254&e[a+18])>>>3,i.dts*=4,i.dts+=(6&e[a+18])>>>1)),i},videoPacketContainsKeyFrame:function(e){for(var t=4+fn(e),a=e.subarray(t),i=0,n=0,r=!1,s;n<a.byteLength-3;n++)if(1===a[n+2]){i=n+5;break}for(;i<a.byteLength;)switch(a[i]){case 0:if(0!==a[i-1]){i+=2;break}else if(0!==a[i-2]){i++;break}n+3!==i-2&&(s=_n(31&a[n+3]),"slice_layer_without_partitioning_rbsp_idr"===s&&(r=!0));do i++;while(1!==a[i]&&i<a.length);n=i-2,i+=3;break;case 1:if(0!==a[i-1]||0!==a[i-2]){i+=3;break}s=_n(31&a[n+3]),"slice_layer_without_partitioning_rbsp_idr"===s&&(r=!0),n=i-2,i+=3;break;default:i+=3;}return a=a.subarray(n),i-=n,n=0,a&&3<a.byteLength&&(s=_n(31&a[n+3]),"slice_layer_without_partitioning_rbsp_idr"===s&&(r=!0)),r}},Dn.aac={isLikelyAacData:function(e){return!(73!==e[0]||68!==e[1]||51!==e[2])},parseId3TagSize:function(e,t){var a=e[t+6]<<21|e[t+7]<<14|e[t+8]<<7|e[t+9],i=e[t+5];return(16&i)>>4?a+20:a+10},parseAdtsSize:function(e,t){var a=(224&e[t+5])>>5,i=e[t+4]<<3,n=e[t+3]&6144;return n|i|a},parseType:function(e,t){if(e[t]===73&&e[t+1]===68&&e[t+2]===51)return"timed-metadata";return!0&e[t]&&240==(240&e[t+1])?"audio":null},parseSampleRate:function(e){for(var t=0;t+5<e.length;){if(255!==e[t]||240!=(246&e[t+1])){t++;continue}return hn[(60&e[t+2])>>>2]}return null},parseAacTimestamp:function(e){var t,a,n,r;t=10,64&e[5]&&(t+=4,t+=bn(e.subarray(10,14)));do{if(a=bn(e.subarray(t+4,t+8)),1>a)return null;if(r=String.fromCharCode(e[t],e[t+1],e[t+2],e[t+3]),"PRIV"===r){n=e.subarray(t+10,t+a+10);for(var s=0;s<n.byteLength;s++)if(0===n[s]){var o=Sn(n,0,s);if("com.apple.streaming.transportStreamTimestamp"===o){var l=n.subarray(s+1),d=(1&l[3])<<30|l[4]<<22|l[5]<<14|l[6]<<6|l[7]>>>2;return d*=4,d+=3&l[7],d}break}}t+=10,t+=a}while(t<e.byteLength);return null}};var An=On.ONE_SECOND_IN_TS,xn=188,Bn=71,Mn=function(e,t){for(var a=0,i=xn,n,r;i<e.byteLength;){if(e[a]===Bn&&e[i]===Bn){switch(n=e.subarray(a,i),r=Dn.ts.parseType(n,t.pid),r){case"pat":t.pid||(t.pid=Dn.ts.parsePat(n));break;case"pmt":t.table||(t.table=Dn.ts.parsePmt(n));break;default:}if(t.pid&&t.table)return;a+=xn,i+=xn;continue}a++,i++}},wn=function(e,t,a){for(var i=0,n=xn,r=!1,s,d,o,l,u;n<=e.byteLength;){if(e[i]===Bn&&(e[n]===Bn||n===e.byteLength)){switch(s=e.subarray(i,n),d=Dn.ts.parseType(s,t.pid),d){case"pes":o=Dn.ts.parsePesType(s,t.table),l=Dn.ts.parsePayloadUnitStartIndicator(s),"audio"===o&&l&&(u=Dn.ts.parsePesTime(s),u&&(u.type="audio",a.audio.push(u),r=!0));break;default:}if(r)break;i+=xn,n+=xn;continue}i++,n++}for(n=e.byteLength,i=n-xn,r=!1;0<=i;){if(e[i]===Bn&&(e[n]===Bn||n===e.byteLength)){switch(s=e.subarray(i,n),d=Dn.ts.parseType(s,t.pid),d){case"pes":o=Dn.ts.parsePesType(s,t.table),l=Dn.ts.parsePayloadUnitStartIndicator(s),"audio"===o&&l&&(u=Dn.ts.parsePesTime(s),u&&(u.type="audio",a.audio.push(u),r=!0));break;default:}if(r)break;i-=xn,n-=xn;continue}i--,n--}},Nn=function(e,t,a){for(var n=0,r=xn,s=!1,d={data:[],size:0},o,l,u,p,m,g,c,y;r<e.byteLength;){if(e[n]===Bn&&e[r]===Bn){switch(o=e.subarray(n,r),l=Dn.ts.parseType(o,t.pid),l){case"pes":if(u=Dn.ts.parsePesType(o,t.table),p=Dn.ts.parsePayloadUnitStartIndicator(o),"video"===u&&(p&&!s&&(m=Dn.ts.parsePesTime(o),m&&(m.type="video",a.video.push(m),s=!0)),!a.firstKeyFrame)){if(p&&0!==d.size){for(g=new Uint8Array(d.size),c=0;d.data.length;)y=d.data.shift(),g.set(y,c),c+=y.byteLength;if(Dn.ts.videoPacketContainsKeyFrame(g)){var f=Dn.ts.parsePesTime(g);f?(a.firstKeyFrame=f,a.firstKeyFrame.type="video"):console.warn("Failed to extract PTS/DTS from PES at first keyframe. This could be an unusual TS segment, or else mux.js did not parse your TS segment correctly. If you know your TS segments do contain PTS/DTS on keyframes please file a bug report! You can try ffprobe to double check for yourself.")}d.size=0}d.data.push(o),d.size+=o.byteLength}break;default:}if(s&&a.firstKeyFrame)break;n+=xn,r+=xn;continue}n++,r++}for(r=e.byteLength,n=r-xn,s=!1;0<=n;){if(e[n]===Bn&&e[r]===Bn){switch(o=e.subarray(n,r),l=Dn.ts.parseType(o,t.pid),l){case"pes":u=Dn.ts.parsePesType(o,t.table),p=Dn.ts.parsePayloadUnitStartIndicator(o),"video"===u&&p&&(m=Dn.ts.parsePesTime(o),m&&(m.type="video",a.video.push(m),s=!0));break;default:}if(s)break;n-=xn,r-=xn;continue}n--,r--}},qn=function(e,t){if(e.audio&&e.audio.length){var a=t;"undefined"==typeof a&&(a=e.audio[0].dts),e.audio.forEach(function(e){e.dts=Rn(e.dts,a),e.pts=Rn(e.pts,a),e.dtsTime=e.dts/An,e.ptsTime=e.pts/An})}if(e.video&&e.video.length){var i=t;if("undefined"==typeof i&&(i=e.video[0].dts),e.video.forEach(function(e){e.dts=Rn(e.dts,i),e.pts=Rn(e.pts,i),e.dtsTime=e.dts/An,e.ptsTime=e.pts/An}),e.firstKeyFrame){var n=e.firstKeyFrame;n.dts=Rn(n.dts,i),n.pts=Rn(n.pts,i),n.dtsTime=n.dts/An,n.ptsTime=n.dts/An}}},Fn=function(e){for(var t=!1,a=0,i=null,n=null,r=0,s=0,d;3<=e.length-s;){var o=Dn.aac.parseType(e,s);switch(o){case"timed-metadata":if(10>e.length-s){t=!0;break}if(r=Dn.aac.parseId3TagSize(e,s),r>e.length){t=!0;break}null===n&&(d=e.subarray(s,s+r),n=Dn.aac.parseAacTimestamp(d)),s+=r;break;case"audio":if(7>e.length-s){t=!0;break}if(r=Dn.aac.parseAdtsSize(e,s),r>e.length){t=!0;break}null===i&&(d=e.subarray(s,s+r),i=Dn.aac.parseSampleRate(d)),a++,s+=r;break;default:s++;}if(t)return null}if(null===i||null===n)return null;var l=An/i,u={audio:[{type:"audio",dts:n,pts:n},{type:"audio",dts:n+1024*a*l,pts:n+1024*a*l}]};return u},Gn=function(e){var t={pid:null,table:null},a={};for(var i in Mn(e,t),t.table)if(t.table.hasOwnProperty(i)){var n=t.table[i];switch(n){case un.H264_STREAM_TYPE:a.video=[],Nn(e,t,a),0===a.video.length&&delete a.video;break;case un.ADTS_STREAM_TYPE:a.audio=[],wn(e,t,a),0===a.audio.length&&delete a.audio;break;default:}}return a},Hn={inspect:function(e,t){var a=Dn.aac.isLikelyAacData(e),i;return(i=a?Fn(e):Gn(e),!i||!i.audio&&!i.video)?null:(qn(i,t),i)},parseAudioPes_:wn}.inspect,Wn=[{name:"VOD",run:function(e,t,a){if(a!==1/0){return{time:0,segmentIndex:0}}return null}},{name:"ProgramDateTime",run:function(e,t,a,n,r){if(!e.datetimeToDisplayTime)return null;var s=t.segments||[],d=null,o=null;r=r||0;for(var l=0,u;l<s.length;l++)if(u=s[l],u.dateTimeObject){var p=u.dateTimeObject.getTime()/1e3,m=p+e.datetimeToDisplayTime,g=Math.abs(r-m);if(null!==o&&(0===g||o<g))break;o=g,d={time:m,segmentIndex:l}}return d}},{name:"Segment",run:function(e,t,a,n,r){var s=t.segments||[],d=null,o=null;r=r||0;for(var l=0,u;l<s.length;l++)if(u=s[l],u.timeline===n&&"undefined"!=typeof u.start){var p=Math.abs(r-u.start);if(null!==o&&o<p)break;(!d||null===o||o>=p)&&(o=p,d={time:u.start,segmentIndex:l})}return d}},{name:"Discontinuity",run:function(e,t,a,n,r){var s=null;if(r=r||0,t.discontinuityStarts&&t.discontinuityStarts.length)for(var d=null,o=0;o<t.discontinuityStarts.length;o++){var l=t.discontinuityStarts[o],u=t.discontinuitySequence+o+1,p=e.discontinuities[u];if(p){var m=Math.abs(r-p.time);if(null!==d&&d<m)break;(!s||null===d||d>=m)&&(d=m,s={time:p.time,segmentIndex:l})}}return s}},{name:"Playlist",run:function(e,t){if(t.syncInfo){var a={time:t.syncInfo.time,segmentIndex:t.syncInfo.mediaSequence-t.mediaSequence};return a}return null}}],Vn=function(e){function t(){P(this,t);var e=R(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.inspectCache_=void 0,e.timelines=[],e.discontinuities=[],e.datetimeToDisplayTime=null,e.logger_=ii("SyncController"),e}return O(t,e),U(t,[{key:"getSyncPoint",value:function(e,t,a,i){var n=this.runStrategies_(e,t,a,i);return n.length?this.selectSyncPoint_(n,{key:"time",value:i}):null}},{key:"getExpiredTime",value:function(e,t){if(!e||!e.segments)return null;var a=this.runStrategies_(e,t,e.discontinuitySequence,0);if(!a.length)return null;var i=this.selectSyncPoint_(a,{key:"segmentIndex",value:0});return 0<i.segmentIndex&&(i.time*=-1),Math.abs(i.time+K(e,i.segmentIndex,0))}},{key:"runStrategies_",value:function(e,t,a,n){for(var r=[],s=0;s<Wn.length;s++){var d=Wn[s],o=d.run(this,e,t,a,n);o&&(o.strategy=d.name,r.push({strategy:d.name,syncPoint:o}))}return r}},{key:"selectSyncPoint_",value:function(e,t){for(var a=e[0].syncPoint,n=Math.abs(e[0].syncPoint[t.key]-t.value),r=e[0].strategy,s=1,d;s<e.length;s++)d=Math.abs(e[s].syncPoint[t.key]-t.value),d<n&&(n=d,a=e[s].syncPoint,r=e[s].strategy);return this.logger_("syncPoint for ["+t.key+": "+t.value+"] chosen with strategy"+(" ["+r+"]: [time:"+a.time+",")+(" segmentIndex:"+a.segmentIndex+"]")),a}},{key:"saveExpiredSegmentInfo",value:function(e,t){for(var a=t.mediaSequence-e.mediaSequence,n=a-1,r;0<=n;n--)if(r=e.segments[n],r&&"undefined"!=typeof r.start){t.syncInfo={mediaSequence:e.mediaSequence+n,time:r.start},this.logger_("playlist refresh sync: [time:"+t.syncInfo.time+","+(" mediaSequence: "+t.syncInfo.mediaSequence+"]")),this.trigger("syncinfoupdate");break}}},{key:"setDateTimeMapping",value:function(e){if(!this.datetimeToDisplayTime&&e.segments&&e.segments.length&&e.segments[0].dateTimeObject){var t=e.segments[0].dateTimeObject.getTime()/1e3;this.datetimeToDisplayTime=-t}}},{key:"reset",value:function(){this.inspectCache_=void 0}},{key:"probeSegmentInfo",value:function(e){var t=e.segment,a=e.playlist,i=void 0;return i=t.map?this.probeMp4Segment_(e):this.probeTsSegment_(e),i&&this.calculateSegmentTimeMapping_(e,i)&&(this.saveDiscontinuitySyncInfo_(e),!a.syncInfo&&(a.syncInfo={mediaSequence:a.mediaSequence+e.mediaIndex,time:t.start})),i}},{key:"probeMp4Segment_",value:function(e){var t=e.segment,a=gi.timescale(t.map.bytes),i=gi.compositionStartTime(a,e.bytes);return null!==e.timestampOffset&&(e.timestampOffset-=i),{start:i,end:i+t.duration}}},{key:"probeTsSegment_",value:function(e){var t=Hn(e.bytes,this.inspectCache_),a=void 0,i=void 0,n=void 0;if(!t)return null;t.video&&2===t.video.length?(this.inspectCache_=t.video[1].dts,a=t.video[0].dtsTime,i=t.video[1].dtsTime,n=t.video):t.audio&&2===t.audio.length&&(this.inspectCache_=t.audio[1].dts,a=t.audio[0].dtsTime,i=t.audio[1].dtsTime,n=t.audio);var r={segmentTimestampInfo:n,start:a,end:i,containsVideo:t.video&&2===t.video.length,containsAudio:t.audio&&2===t.audio.length};return r}},{key:"timestampOffsetForTimeline",value:function(e){return"undefined"==typeof this.timelines[e]?null:this.timelines[e].time}},{key:"mappingForTimeline",value:function(e){return"undefined"==typeof this.timelines[e]?null:this.timelines[e].mapping}},{key:"calculateSegmentTimeMapping_",value:function(e,t){var a=e.segment,i=this.timelines[e.timeline];if(null!==e.timestampOffset)i={time:e.startOfSegment,mapping:e.startOfSegment-t.start},this.timelines[e.timeline]=i,this.trigger("timestampoffset"),this.logger_("time mapping for timeline "+e.timeline+": "+("[time: "+i.time+"] [mapping: "+i.mapping+"]")),a.start=e.startOfSegment,a.end=t.end+i.mapping;else if(i)a.start=t.start+i.mapping,a.end=t.end+i.mapping;else return!1;return!0}},{key:"saveDiscontinuitySyncInfo_",value:function(e){var t=e.playlist,a=e.segment;if(a.discontinuity)this.discontinuities[a.timeline]={time:a.start,accuracy:0};else if(t.discontinuityStarts&&t.discontinuityStarts.length)for(var n=0;n<t.discontinuityStarts.length;n++){var r=t.discontinuityStarts[n],s=t.discontinuitySequence+n+1,d=r-e.mediaIndex,o=Math.abs(d);if(!this.discontinuities[s]||this.discontinuities[s].accuracy>o){var l=void 0;l=0>d?a.start-K(t,e.mediaIndex,r):a.end+K(t,e.mediaIndex+1,r),this.discontinuities[s]={time:l,accuracy:o}}}}}]),t}(t.EventTarget),zn=new d("./decrypter-worker.worker.js",function(){var e=this,t=function(){function t(e){return e.subarray(0,e.byteLength-e[e.byteLength-1])}var a=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},i=function(){function e(e,t){for(var a=0,n;a<t.length;a++)n=t[a],n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}return function(t,a,i){return a&&e(t.prototype,a),i&&e(t,i),t}}(),n=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)},r=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t&&("object"==typeof t||"function"==typeof t)?t:e},s=function(){var e=[[[],[],[],[],[]],[[],[],[],[],[]]],t=e[0],a=e[1],n=t[4],r=a[4],o=void 0,l=void 0,u=void 0,p=[],d=[],m=void 0,g=void 0,c=void 0,y=void 0,f=void 0,_=void 0;for(o=0;256>o;o++)d[(p[o]=o<<1^283*(o>>7))^o]=o;for(l=u=0;!n[l];l^=m||1,u=d[u]||1)for(y=u^u<<1^u<<2^u<<3^u<<4,y=99^(y>>8^255&y),n[l]=y,r[y]=l,c=p[g=p[m=p[l]]],_=16843009*c^65537*g^257*m^16843008*l,f=257*p[y]^16843008*y,o=0;4>o;o++)t[o][l]=f=f<<24^f>>>8,a[o][y]=_=_<<24^_>>>8;for(o=0;5>o;o++)t[o]=t[o].slice(0),a[o]=a[o].slice(0);return e},d=null,o=function(){function e(t){a(this,e),d||(d=s()),this._tables=[[d[0][0].slice(),d[0][1].slice(),d[0][2].slice(),d[0][3].slice(),d[0][4].slice()],[d[1][0].slice(),d[1][1].slice(),d[1][2].slice(),d[1][3].slice(),d[1][4].slice()]];var n=void 0,r=void 0,o=void 0,l=void 0,u=void 0,p=this._tables[0][4],m=this._tables[1],g=t.length,c=1;if(4!==g&&6!==g&&8!==g)throw new Error("Invalid aes key size");for(l=t.slice(0),u=[],this._key=[l,u],n=g;n<4*g+28;n++)o=l[n-1],(0==n%g||8===g&&4==n%g)&&(o=p[o>>>24]<<24^p[255&o>>16]<<16^p[255&o>>8]<<8^p[255&o],0==n%g&&(o=o<<8^o>>>24^c<<24,c=c<<1^283*(c>>7))),l[n]=l[n-g]^o;for(r=0;n;r++,n--)o=l[3&r?n:n-4],u[r]=4>=n||4>r?o:m[0][p[o>>>24]]^m[1][p[255&o>>16]]^m[2][p[255&o>>8]]^m[3][p[255&o]]}return e.prototype.decrypt=function(e,t,n,r,s,o){var l=this._key[1],u=e^l[0],p=r^l[1],m=n^l[2],g=t^l[3],y=void 0,f=void 0,_=void 0,h=l.length/4-2,T=void 0,S=4,k=this._tables[1],v=k[0],L=k[1],I=k[2],E=k[3],P=k[4];for(T=0;T<h;T++)y=v[u>>>24]^L[255&p>>16]^I[255&m>>8]^E[255&g]^l[S],f=v[p>>>24]^L[255&m>>16]^I[255&g>>8]^E[255&u]^l[S+1],_=v[m>>>24]^L[255&g>>16]^I[255&u>>8]^E[255&p]^l[S+2],g=v[g>>>24]^L[255&u>>16]^I[255&p>>8]^E[255&m]^l[S+3],S+=4,u=y,p=f,m=_;for(T=0;4>T;T++)s[(3&-T)+o]=P[u>>>24]<<24^P[255&p>>16]<<16^P[255&m>>8]<<8^P[255&g]^l[S++],y=u,u=p,p=m,m=g,g=y},e}(),l=function(){function e(){a(this,e),this.listeners={}}return e.prototype.on=function(e,t){this.listeners[e]||(this.listeners[e]=[]),this.listeners[e].push(t)},e.prototype.off=function(e,t){if(!this.listeners[e])return!1;var a=this.listeners[e].indexOf(t);return this.listeners[e].splice(a,1),-1<a},e.prototype.trigger=function(e){var t=this.listeners[e];if(t)if(2===arguments.length)for(var a=t.length,n=0;n<a;++n)t[n].call(this,arguments[1]);else for(var r=Array.prototype.slice.call(arguments,1),s=t.length,d=0;d<s;++d)t[d].apply(this,r)},e.prototype.dispose=function(){this.listeners={}},e.prototype.pipe=function(e){this.on("data",function(t){e.push(t)})},e}(),u=function(e){function t(){a(this,t);var i=r(this,e.call(this,l));return i.jobs=[],i.delay=1,i.timeout_=null,i}return n(t,e),t.prototype.processJob_=function(){this.jobs.shift()(),this.timeout_=this.jobs.length?setTimeout(this.processJob_.bind(this),this.delay):null},t.prototype.push=function(e){this.jobs.push(e),this.timeout_||(this.timeout_=setTimeout(this.processJob_.bind(this),this.delay))},t}(l),p=function(e){return e<<24|(65280&e)<<8|(16711680&e)>>8|e>>>24},m=function(e,t,a){var i=new Int32Array(e.buffer,e.byteOffset,e.byteLength>>2),n=new o(Array.prototype.slice.call(t)),r=new Uint8Array(e.byteLength),s=new Int32Array(r.buffer),d=void 0,l=void 0,u=void 0,m=void 0,g=void 0,c=void 0,y=void 0,f=void 0,_=void 0;for(d=a[0],l=a[1],u=a[2],m=a[3],_=0;_<i.length;_+=4)g=p(i[_]),c=p(i[_+1]),y=p(i[_+2]),f=p(i[_+3]),n.decrypt(g,c,y,f,s,_),s[_]=p(s[_]^d),s[_+1]=p(s[_+1]^l),s[_+2]=p(s[_+2]^u),s[_+3]=p(s[_+3]^m),d=g,l=c,u=y,m=f;return r},g=function(){function e(n,r,s,d){a(this,e);var o=e.STEP,l=new Int32Array(n.buffer),m=new Uint8Array(n.byteLength),g=0;for(this.asyncStream_=new u,this.asyncStream_.push(this.decryptChunk_(l.subarray(g,g+o),r,s,m)),g=o;g<l.length;g+=o)s=new Uint32Array([p(l[g-4]),p(l[g-3]),p(l[g-2]),p(l[g-1])]),this.asyncStream_.push(this.decryptChunk_(l.subarray(g,g+o),r,s,m));this.asyncStream_.push(function(){d(null,t(m))})}return e.prototype.decryptChunk_=function(e,t,a,i){return function(){var n=m(e,t,a);i.set(n,e.byteOffset)}},i(e,null,[{key:"STEP",get:function(){return 32e3}}]),e}(),c=function(e){var t={};return Object.keys(e).forEach(function(a){var i=e[a];t[a]=ArrayBuffer.isView(i)?{bytes:i.buffer,byteOffset:i.byteOffset,byteLength:i.byteLength}:i}),t},y=new function(e){e.onmessage=function(t){var a=t.data,i=new Uint8Array(a.encrypted.bytes,a.encrypted.byteOffset,a.encrypted.byteLength),n=new Uint32Array(a.key.bytes,a.key.byteOffset,a.key.byteLength/4),r=new Uint32Array(a.iv.bytes,a.iv.byteOffset,a.iv.byteLength/4);new g(i,n,r,function(t,i){e.postMessage(c({source:a.source,decrypted:i}),[i.buffer])})}}(e);return y}()}),jn=function(e){var t=e.default?"main":"alternative";return e.characteristics&&0<=e.characteristics.indexOf("public.accessibility.describes-video")&&(t="main-desc"),t},Yn=function(e,t){e.abort(),e.pause(),t&&t.activePlaylistLoader&&(t.activePlaylistLoader.pause(),t.activePlaylistLoader=null)},Xn=function(e,t){t.activePlaylistLoader=e,e.load()},Kn=function(e,t){return function(){var a=t.segmentLoaders,i=a[e],n=a.main,r=t.mediaTypes[e],s=r.activeTrack(),d=r.activeGroup(s),o=r.activePlaylistLoader;return Yn(i,r),d?d.playlistLoader?void(i.resyncLoader(),Xn(d.playlistLoader,r)):void(o&&n.resetEverything()):void 0}},Qn=function(e,t){return function(){var a=t.segmentLoaders,i=a[e],n=a.main,r=t.mediaTypes[e],s=r.activeTrack(),d=r.activeGroup(s),o=r.activePlaylistLoader;return Yn(i,r),d?d.playlistLoader?o===d.playlistLoader?void Xn(d.playlistLoader,r):void(i.track&&i.track(s),i.resetEverything(),Xn(d.playlistLoader,r)):void n.resetEverything():void 0}},Jn={AUDIO:function(e,a){return function(){var i=a.segmentLoaders[e],n=a.mediaTypes[e],r=a.blacklistCurrentPlaylist;Yn(i,n);var s=n.activeTrack(),d=n.activeGroup(),o=(d.filter(function(e){return e.default})[0]||d[0]).id,l=n.tracks[o];if(s===l)return void r({message:"Problem encountered loading the default audio track."});for(var u in t.log.warn("Problem encountered loading the alternate audio track.Switching back to default."),n.tracks)n.tracks[u].enabled=n.tracks[u]===l;n.onTrackChanged()}},SUBTITLES:function(e,a){return function(){var i=a.segmentLoaders[e],n=a.mediaTypes[e];t.log.warn("Problem encountered loading the subtitle track.Disabling subtitle track."),Yn(i,n);var r=n.activeTrack();r&&(r.mode="disabled"),n.onTrackChanged()}}},Zn={AUDIO:function(e,t,a){if(t){var i=a.tech,n=a.requestOptions,r=a.segmentLoaders[e];t.on("loadedmetadata",function(){var e=t.media();r.playlist(e,n),(!i.paused()||e.endList&&"none"!==i.preload())&&r.load()}),t.on("loadedplaylist",function(){r.playlist(t.media(),n),i.paused()||r.load()}),t.on("error",Jn[e](e,a))}},SUBTITLES:function(e,t,a){var i=a.tech,n=a.requestOptions,r=a.segmentLoaders[e],s=a.mediaTypes[e];t.on("loadedmetadata",function(){var e=t.media();r.playlist(e,n),r.track(s.activeTrack()),(!i.paused()||e.endList&&"none"!==i.preload())&&r.load()}),t.on("loadedplaylist",function(){r.playlist(t.media(),n),i.paused()||r.load()}),t.on("error",Jn[e](e,a))}},$n={AUDIO:function(e,a){var i=a.hls,n=a.sourceType,r=a.segmentLoaders[e],s=a.requestOptions,d=a.master.mediaGroups,o=a.mediaTypes[e],l=o.groups,u=o.tracks,p=a.masterPlaylistLoader;for(var m in d[e]&&0!==Object.keys(d[e]).length||(d[e]={main:{default:{default:!0}}}),d[e])for(var g in l[m]||(l[m]=[]),d[e][m]){var c=d[e][m][g],y=void 0;if(y=c.resolvedUri?new W(c.resolvedUri,i,s):c.playlists&&"dash"===n?new ai(c.playlists[0],i,s,p):null,c=t.mergeOptions({id:g,playlistLoader:y},c),Zn[e](e,c.playlistLoader,a),l[m].push(c),"undefined"==typeof u[g]){var f=new t.AudioTrack({id:g,kind:jn(c),enabled:!1,language:c.language,default:c.default,label:g});u[g]=f}}r.on("error",Jn[e](e,a))},SUBTITLES:function(e,a){var i=a.tech,n=a.hls,r=a.sourceType,s=a.segmentLoaders[e],d=a.requestOptions,o=a.master.mediaGroups,l=a.mediaTypes[e],u=l.groups,p=l.tracks,m=a.masterPlaylistLoader;for(var g in o[e])for(var c in u[g]||(u[g]=[]),o[e][g])if(!o[e][g][c].forced){var y=o[e][g][c],f=void 0;if("hls"===r?f=new W(y.resolvedUri,n,d):"dash"===r&&(f=new ai(y.playlists[0],n,d,m)),y=t.mergeOptions({id:c,playlistLoader:f},y),Zn[e](e,y.playlistLoader,a),u[g].push(y),"undefined"==typeof p[c]){var _=i.addRemoteTextTrack({id:c,kind:"subtitles",default:y.default&&y.autoselect,language:y.language,label:c},!1).track;p[c]=_}}s.on("error",Jn[e](e,a))},"CLOSED-CAPTIONS":function(e,a){var i=a.tech,n=a.master.mediaGroups,r=a.mediaTypes[e],s=r.groups,d=r.tracks;for(var o in n[e])for(var l in s[o]||(s[o]=[]),n[e][o]){var u=n[e][o][l];if(u.instreamId.match(/CC\d/)&&(s[o].push(t.mergeOptions({id:l},u)),"undefined"==typeof d[l])){var p=i.addRemoteTextTrack({id:u.instreamId,kind:"captions",default:u.default&&u.autoselect,language:u.language,label:l},!1).track;d[l]=p}}}},er=function(e,t){return function(a){var i=t.masterPlaylistLoader,n=t.mediaTypes[e].groups,r=i.media();if(!r)return null;var s=null;return r.attributes[e]&&(s=n[r.attributes[e]]),s=s||n.main,"undefined"==typeof a?s:null===a?null:s.filter(function(e){return e.id===a.id})[0]||null}},tr={AUDIO:function(e,t){return function(){var a=t.mediaTypes[e].tracks;for(var i in a)if(a[i].enabled)return a[i];return null}},SUBTITLES:function(e,t){return function(){var a=t.mediaTypes[e].tracks;for(var i in a)if("showing"===a[i].mode)return a[i];return null}}},ar=function(e){["AUDIO","SUBTITLES","CLOSED-CAPTIONS"].forEach(function(t){$n[t](t,e)});var t=e.mediaTypes,a=e.masterPlaylistLoader,i=e.tech,n=e.hls;["AUDIO","SUBTITLES"].forEach(function(a){t[a].activeGroup=er(a,e),t[a].activeTrack=tr[a](a,e),t[a].onGroupChanged=Kn(a,e),t[a].onTrackChanged=Qn(a,e)});var r=t.AUDIO.activeGroup(),s=(r.filter(function(e){return e.default})[0]||r[0]).id;t.AUDIO.tracks[s].enabled=!0,t.AUDIO.onTrackChanged(),a.on("mediachange",function(){["AUDIO","SUBTITLES"].forEach(function(e){return t[e].onGroupChanged()})});var d=function(){t.AUDIO.onTrackChanged(),i.trigger({type:"usage",name:"hls-audio-change"})};for(var o in i.audioTracks().addEventListener("change",d),i.remoteTextTracks().addEventListener("change",t.SUBTITLES.onTrackChanged),n.on("dispose",function(){i.audioTracks().removeEventListener("change",d),i.remoteTextTracks().removeEventListener("change",t.SUBTITLES.onTrackChanged)}),i.clearTracks("audio"),t.AUDIO.tracks)i.audioTracks().addTrack(t.AUDIO.tracks[o])},ir=function(){var e={};return["AUDIO","SUBTITLES","CLOSED-CAPTIONS"].forEach(function(t){e[t]={groups:{},tracks:{},activePlaylistLoader:null,activeGroup:p,activeTrack:p,onGroupChanged:p,onTrackChanged:p}}),e},nr=void 0,rr=["mediaRequests","mediaRequestsAborted","mediaRequestsTimedout","mediaRequestsErrored","mediaTransferDuration","mediaBytesTransferred"],sr=function(e){return this.audioSegmentLoader_[e]+this.mainSegmentLoader_[e]},dr=function(e){function a(e){P(this,a);var i=R(this,(a.__proto__||Object.getPrototypeOf(a)).call(this)),n=e.url,r=e.handleManifestRedirects,s=e.withCredentials,d=e.tech,o=e.bandwidth,l=e.externHls,u=e.useCueTags,p=e.blacklistDuration,m=e.enableLowInitialPlaylist,g=e.sourceType,c=e.seekTo,y=e.cacheEncryptionKeys;if(!n)throw new Error("A non-empty playlist URL is required");nr=l,i.withCredentials=s,i.tech_=d,i.hls_=d.hls,i.seekTo_=c,i.sourceType_=g,i.useCueTags_=u,i.blacklistDuration=p,i.enableLowInitialPlaylist=m,i.useCueTags_&&(i.cueTagsTrack_=i.tech_.addTextTrack("metadata","ad-cues"),i.cueTagsTrack_.inBandMetadataTrackDispatchType=""),i.requestOptions_={withCredentials:s,handleManifestRedirects:r,timeout:null},i.mediaTypes_=ir(),i.mediaSource=new t.MediaSource,i.mediaSource.addEventListener("sourceopen",i.handleSourceOpen_.bind(i)),i.seekable_=t.createTimeRanges(),i.hasPlayed_=function(){return!1},i.syncController_=new Vn(e),i.segmentMetadataTrack_=d.addRemoteTextTrack({kind:"metadata",label:"segment-metadata"},!1).track,i.decrypter_=new zn,i.inbandTextTracks_={};var f={hls:i.hls_,mediaSource:i.mediaSource,currentTime:i.tech_.currentTime.bind(i.tech_),seekable:function(){return i.seekable()},seeking:function(){return i.tech_.seeking()},duration:function(){return i.mediaSource.duration},hasPlayed:function(){return i.hasPlayed_()},goalBufferLength:function(){return i.goalBufferLength()},bandwidth:o,syncController:i.syncController_,decrypter:i.decrypter_,sourceType:i.sourceType_,inbandTextTracks:i.inbandTextTracks_,cacheEncryptionKeys:y};return i.masterPlaylistLoader_="dash"===i.sourceType_?new ai(n,i.hls_,i.requestOptions_):new W(n,i.hls_,i.requestOptions_),i.setupMasterPlaylistLoaderListeners_(),i.mainSegmentLoader_=new nn(t.mergeOptions(f,{segmentMetadataTrack:i.segmentMetadataTrack_,loaderType:"main"}),e),i.audioSegmentLoader_=new nn(t.mergeOptions(f,{loaderType:"audio"}),e),i.subtitleSegmentLoader_=new dn(t.mergeOptions(f,{loaderType:"vtt"}),e),i.setupSegmentLoaderListeners_(),rr.forEach(function(e){i[e+"_"]=sr.bind(i,e)}),i.logger_=ii("MPC"),i.masterPlaylistLoader_.load(),i}return O(a,e),U(a,[{key:"setupMasterPlaylistLoaderListeners_",value:function(){var a=this;this.masterPlaylistLoader_.on("loadedmetadata",function(){var e=a.masterPlaylistLoader_.media(),i=1e3*(1.5*e.targetDuration);a.requestOptions_.timeout=de(a.masterPlaylistLoader_.master,a.masterPlaylistLoader_.media())?0:i,e.endList&&"none"!==a.tech_.preload()&&(a.mainSegmentLoader_.playlist(e,a.requestOptions_),a.mainSegmentLoader_.load()),ar({sourceType:a.sourceType_,segmentLoaders:{AUDIO:a.audioSegmentLoader_,SUBTITLES:a.subtitleSegmentLoader_,main:a.mainSegmentLoader_},tech:a.tech_,requestOptions:a.requestOptions_,masterPlaylistLoader:a.masterPlaylistLoader_,hls:a.hls_,master:a.master(),mediaTypes:a.mediaTypes_,blacklistCurrentPlaylist:a.blacklistCurrentPlaylist.bind(a)}),a.triggerPresenceUsage_(a.master(),e);try{a.setupSourceBuffers_()}catch(i){return t.log.warn("Failed to create SourceBuffers",i),a.mediaSource.endOfStream("decode")}a.setupFirstPlay(),!a.mediaTypes_.AUDIO.activePlaylistLoader||a.mediaTypes_.AUDIO.activePlaylistLoader.media()?a.trigger("selectedinitialmedia"):a.mediaTypes_.AUDIO.activePlaylistLoader.one("loadedmetadata",function(){a.trigger("selectedinitialmedia")})}),this.masterPlaylistLoader_.on("loadedplaylist",function(){var e=a.masterPlaylistLoader_.media();if(!e){a.excludeUnsupportedVariants_();var t;return a.enableLowInitialPlaylist&&(t=a.selectInitialPlaylist()),t||(t=a.selectPlaylist()),a.initialMedia_=t,void a.masterPlaylistLoader_.media(a.initialMedia_)}if(a.useCueTags_&&a.updateAdCues_(e),a.mainSegmentLoader_.playlist(e,a.requestOptions_),a.updateDuration(),a.tech_.paused()||(a.mainSegmentLoader_.load(),a.audioSegmentLoader_&&a.audioSegmentLoader_.load()),!e.endList){var i=function(){var e=a.seekable();0!==e.length&&a.mediaSource.addSeekableRange_(e.start(0),e.end(0))};if(a.duration()!==1/0){var n=function e(){a.duration()===1/0?i():a.tech_.one("durationchange",e)};a.tech_.one("durationchange",n)}else i()}}),this.masterPlaylistLoader_.on("error",function(){a.blacklistCurrentPlaylist(a.masterPlaylistLoader_.error)}),this.masterPlaylistLoader_.on("mediachanging",function(){a.mainSegmentLoader_.abort(),a.mainSegmentLoader_.pause()}),this.masterPlaylistLoader_.on("mediachange",function(){var e=a.masterPlaylistLoader_.media(),t=1e3*(1.5*e.targetDuration);a.requestOptions_.timeout=de(a.masterPlaylistLoader_.master,a.masterPlaylistLoader_.media())?0:t,a.mainSegmentLoader_.playlist(e,a.requestOptions_),a.mainSegmentLoader_.load(),a.tech_.trigger({type:"mediachange",bubbles:!0})}),this.masterPlaylistLoader_.on("playlistunchanged",function(){var e=a.masterPlaylistLoader_.media(),t=a.stuckAtPlaylistEnd_(e);t&&(a.blacklistCurrentPlaylist({message:"Playlist no longer updating."}),a.tech_.trigger("playliststuck"))}),this.masterPlaylistLoader_.on("renditiondisabled",function(){a.tech_.trigger({type:"usage",name:"hls-rendition-disabled"})}),this.masterPlaylistLoader_.on("renditionenabled",function(){a.tech_.trigger({type:"usage",name:"hls-rendition-enabled"})})}},{key:"triggerPresenceUsage_",value:function(e,t){var a=e.mediaGroups||{},i=!0,n=Object.keys(a.AUDIO);for(var r in a.AUDIO)for(var s in a.AUDIO[r]){var d=a.AUDIO[r][s];d.uri||(i=!1)}i&&this.tech_.trigger({type:"usage",name:"hls-demuxed"}),Object.keys(a.SUBTITLES).length&&this.tech_.trigger({type:"usage",name:"hls-webvtt"}),nr.Playlist.isAes(t)&&this.tech_.trigger({type:"usage",name:"hls-aes"}),nr.Playlist.isFmp4(t)&&this.tech_.trigger({type:"usage",name:"hls-fmp4"}),n.length&&1<Object.keys(a.AUDIO[n[0]]).length&&this.tech_.trigger({type:"usage",name:"hls-alternate-audio"}),this.useCueTags_&&this.tech_.trigger({type:"usage",name:"hls-playlist-cue-tags"})}},{key:"setupSegmentLoaderListeners_",value:function(){var e=this;this.mainSegmentLoader_.on("bandwidthupdate",function(){var t=e.selectPlaylist(),a=e.masterPlaylistLoader_.media(),i=e.tech_.buffered(),n=i.length?i.end(i.length-1)-e.tech_.currentTime():0,r=e.bufferLowWaterLine();(!a.endList||e.duration()<ri.MAX_BUFFER_LOW_WATER_LINE||t.attributes.BANDWIDTH<a.attributes.BANDWIDTH||n>=r)&&e.masterPlaylistLoader_.media(t),e.tech_.trigger("bandwidthupdate")}),this.mainSegmentLoader_.on("progress",function(){e.trigger("progress")}),this.mainSegmentLoader_.on("error",function(){e.blacklistCurrentPlaylist(e.mainSegmentLoader_.error())}),this.mainSegmentLoader_.on("syncinfoupdate",function(){e.onSyncInfoUpdate_()}),this.mainSegmentLoader_.on("timestampoffset",function(){e.tech_.trigger({type:"usage",name:"hls-timestamp-offset"})}),this.audioSegmentLoader_.on("syncinfoupdate",function(){e.onSyncInfoUpdate_()}),this.mainSegmentLoader_.on("ended",function(){e.onEndOfStream()}),this.mainSegmentLoader_.on("earlyabort",function(){e.blacklistCurrentPlaylist({message:"Aborted early because there isn't enough bandwidth to complete the request without rebuffering."},120)}),this.mainSegmentLoader_.on("reseteverything",function(){e.tech_.trigger("hls-reset")}),this.mainSegmentLoader_.on("segmenttimemapping",function(t){e.tech_.trigger({type:"hls-segment-time-mapping",mapping:t.mapping})}),this.audioSegmentLoader_.on("ended",function(){e.onEndOfStream()})}},{key:"mediaSecondsLoaded_",value:function(){return Math.max(this.audioSegmentLoader_.mediaSecondsLoaded+this.mainSegmentLoader_.mediaSecondsLoaded)}},{key:"load",value:function(){this.mainSegmentLoader_.load(),this.mediaTypes_.AUDIO.activePlaylistLoader&&this.audioSegmentLoader_.load(),this.mediaTypes_.SUBTITLES.activePlaylistLoader&&this.subtitleSegmentLoader_.load()}},{key:"smoothQualityChange_",value:function(){var e=this.selectPlaylist();e!==this.masterPlaylistLoader_.media()&&(this.masterPlaylistLoader_.media(e),this.mainSegmentLoader_.resetLoader())}},{key:"fastQualityChange_",value:function(){var e=this,a=this.selectPlaylist();a===this.masterPlaylistLoader_.media()||(this.masterPlaylistLoader_.media(a),this.mainSegmentLoader_.resetEverything(function(){t.browser.IE_VERSION||t.browser.IS_EDGE?e.tech_.setCurrentTime(e.tech_.currentTime()+.04):e.tech_.setCurrentTime(e.tech_.currentTime())}))}},{key:"play",value:function(){if(!this.setupFirstPlay()){this.tech_.ended()&&this.seekTo_(0),this.hasPlayed_()&&this.load();var e=this.tech_.seekable();if(this.tech_.duration()===1/0&&this.tech_.currentTime()<e.start(0))return this.seekTo_(e.end(e.length-1))}}},{key:"setupFirstPlay",value:function(){var e=this,a=this.masterPlaylistLoader_.media();if(!a||this.tech_.paused()||this.hasPlayed_())return!1;if(!a.endList){var i=this.seekable();if(!i.length)return!1;if(t.browser.IE_VERSION&&0===this.tech_.readyState())return this.tech_.one("loadedmetadata",function(){e.trigger("firstplay"),e.seekTo_(i.end(0)),e.hasPlayed_=function(){return!0}}),!1;this.trigger("firstplay"),this.seekTo_(i.end(0))}return this.hasPlayed_=function(){return!0},this.load(),!0}},{key:"handleSourceOpen_",value:function(){try{this.setupSourceBuffers_()}catch(a){return t.log.warn("Failed to create Source Buffers",a),this.mediaSource.endOfStream("decode")}if(this.tech_.autoplay()){var e=this.tech_.play();"undefined"!=typeof e&&"function"==typeof e.then&&e.then(null,function(){})}this.trigger("sourceopen")}},{key:"onEndOfStream",value:function(){var e=this.mainSegmentLoader_.ended_;if(this.mediaTypes_.AUDIO.activePlaylistLoader&&(!this.mainSegmentLoader_.startingMedia_||this.mainSegmentLoader_.startingMedia_.containsVideo?e=e&&this.audioSegmentLoader_.ended_:e=this.audioSegmentLoader_.ended_),!!e){this.logger_("calling mediaSource.endOfStream()");try{this.mediaSource.endOfStream()}catch(a){t.log.warn("Failed to call media source endOfStream",a)}}}},{key:"stuckAtPlaylistEnd_",value:function(e){var t=this.seekable();if(!t.length)return!1;var a=this.syncController_.getExpiredTime(e,this.mediaSource.duration);if(null===a)return!1;var i=nr.Playlist.playlistEnd(e,a),n=this.tech_.currentTime(),r=this.tech_.buffered();if(!r.length)return i-n<=Ve;var s=r.end(r.length-1);return s-n<=Ve&&i-s<=Ve}},{key:"blacklistCurrentPlaylist",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},a=arguments[1],i=void 0,n=void 0;if(i=e.playlist||this.masterPlaylistLoader_.media(),a=a||e.blacklistDuration||this.blacklistDuration,!i){this.error=e;try{return this.mediaSource.endOfStream("network")}catch(t){return this.trigger("error")}}var r=1===this.masterPlaylistLoader_.master.playlists.filter(re).length,s=this.masterPlaylistLoader_.master.playlists;return 1===s.length?(t.log.warn("Problem encountered with the current HLS playlist. Trying again since it is the only playlist."),this.tech_.trigger("retryplaylist"),this.masterPlaylistLoader_.load(r)):(r&&(t.log.warn("Removing all playlists from the blacklist because the last rendition is about to be blacklisted."),s.forEach(function(e){e.excludeUntil!==1/0&&delete e.excludeUntil}),this.tech_.trigger("retryplaylist")),i.excludeUntil=Date.now()+1e3*a,this.tech_.trigger("blacklistplaylist"),this.tech_.trigger({type:"usage",name:"hls-rendition-blacklisted"}),n=this.selectPlaylist(),t.log.warn("Problem encountered with the current HLS playlist."+(e.message?" "+e.message:"")+" Switching to another playlist."),this.masterPlaylistLoader_.media(n,r))}},{key:"pauseLoading",value:function(){this.mainSegmentLoader_.pause(),this.mediaTypes_.AUDIO.activePlaylistLoader&&this.audioSegmentLoader_.pause(),this.mediaTypes_.SUBTITLES.activePlaylistLoader&&this.subtitleSegmentLoader_.pause()}},{key:"setCurrentTime",value:function(e){var t=je(this.tech_.buffered(),e);return this.masterPlaylistLoader_&&this.masterPlaylistLoader_.media()?this.masterPlaylistLoader_.media().segments?t&&t.length?e:void(this.mainSegmentLoader_.resetEverything(),this.mainSegmentLoader_.abort(),this.mediaTypes_.AUDIO.activePlaylistLoader&&(this.audioSegmentLoader_.resetEverything(),this.audioSegmentLoader_.abort()),this.mediaTypes_.SUBTITLES.activePlaylistLoader&&(this.subtitleSegmentLoader_.resetEverything(),this.subtitleSegmentLoader_.abort()),this.load()):0:0}},{key:"duration",value:function(){return this.masterPlaylistLoader_?this.mediaSource?this.mediaSource.duration:nr.Playlist.duration(this.masterPlaylistLoader_.media()):0}},{key:"seekable",value:function(){return this.seekable_}},{key:"onSyncInfoUpdate_",value:function(){var e=void 0,a=void 0;if(this.masterPlaylistLoader_){var i=this.masterPlaylistLoader_.media();if(i){var n=this.syncController_.getExpiredTime(i,this.mediaSource.duration);if(null!==n&&(e=nr.Playlist.seekable(i,n),0!==e.length)){if(this.mediaTypes_.AUDIO.activePlaylistLoader){if(i=this.mediaTypes_.AUDIO.activePlaylistLoader.media(),n=this.syncController_.getExpiredTime(i,this.mediaSource.duration),null===n)return;if(a=nr.Playlist.seekable(i,n),0===a.length)return}var r=void 0,s=void 0;this.seekable_&&this.seekable_.length&&(r=this.seekable_.end(0),s=this.seekable_.start(0)),this.seekable_=a?a.start(0)>e.end(0)||e.start(0)>a.end(0)?e:t.createTimeRanges([[a.start(0)>e.start(0)?a.start(0):e.start(0),a.end(0)<e.end(0)?a.end(0):e.end(0)]]):e,this.seekable_&&this.seekable_.length&&this.seekable_.end(0)===r&&this.seekable_.start(0)===s||(this.logger_("seekable updated ["+Ke(this.seekable_)+"]"),this.tech_.trigger("seekablechanged"))}}}}},{key:"updateDuration",value:function(){var e=this,a=this.mediaSource.duration,i=nr.Playlist.duration(this.masterPlaylistLoader_.media()),n=this.tech_.buffered(),r=function a(){e.logger_("Setting duration from "+e.mediaSource.duration+" => "+i);try{e.mediaSource.duration=i}catch(a){t.log.warn("Failed to set media source duration",a)}e.tech_.trigger("durationchange"),e.mediaSource.removeEventListener("sourceopen",a)};0<n.length&&(i=Math.max(i,n.end(n.length-1))),a!==i&&("open"===this.mediaSource.readyState?r():this.mediaSource.addEventListener("sourceopen",r))}},{key:"dispose",value:function(){var e=this;this.decrypter_.terminate(),this.masterPlaylistLoader_.dispose(),this.mainSegmentLoader_.dispose(),["AUDIO","SUBTITLES"].forEach(function(t){var a=e.mediaTypes_[t].groups;for(var i in a)a[i].forEach(function(e){e.playlistLoader&&e.playlistLoader.dispose()})}),this.audioSegmentLoader_.dispose(),this.subtitleSegmentLoader_.dispose()}},{key:"master",value:function(){return this.masterPlaylistLoader_.master}},{key:"media",value:function(){return this.masterPlaylistLoader_.media()||this.initialMedia_}},{key:"setupSourceBuffers_",value:function(){var e=this.masterPlaylistLoader_.media(),t=void 0;if(e&&"open"===this.mediaSource.readyState)return t=Tt(this.masterPlaylistLoader_.master,e),1>t.length?(this.error="No compatible SourceBuffer configuration for the variant stream:"+e.resolvedUri,this.mediaSource.endOfStream("decode")):void(this.configureLoaderMimeTypes_(t),this.excludeIncompatibleVariants_(e))}},{key:"configureLoaderMimeTypes_",value:function(e){var a=1<e.length&&-1===e[0].indexOf(",")&&e[0]!==e[1]?new t.EventTarget:null;this.mainSegmentLoader_.mimeType(e[0],a),e[1]&&this.audioSegmentLoader_.mimeType(e[1],a)}},{key:"excludeUnsupportedVariants_",value:function(){this.master().playlists.forEach(function(e){e.attributes.CODECS&&h.MediaSource&&h.MediaSource.isTypeSupported&&!h.MediaSource.isTypeSupported("video/mp4; codecs=\""+yt(e.attributes.CODECS)+"\"")&&(e.excludeUntil=1/0)})}},{key:"excludeIncompatibleVariants_",value:function(e){var t=2,a=null,i=void 0;e.attributes.CODECS&&(i=ct(e.attributes.CODECS),a=i.videoCodec,t=i.codecCount),this.master().playlists.forEach(function(e){var i={codecCount:2,videoCodec:null};e.attributes.CODECS&&(i=ct(e.attributes.CODECS)),i.codecCount!==t&&(e.excludeUntil=1/0),i.videoCodec!==a&&(e.excludeUntil=1/0)})}},{key:"updateAdCues_",value:function(e){var t=0,a=this.seekable();a.length&&(t=a.start(0)),ln(e,this.cueTagsTrack_,t)}},{key:"goalBufferLength",value:function(){var e=this.tech_.currentTime(),t=ri.GOAL_BUFFER_LENGTH,a=ri.GOAL_BUFFER_LENGTH_RATE,i=Math.max(t,ri.MAX_GOAL_BUFFER_LENGTH);return Math.min(t+e*a,i)}},{key:"bufferLowWaterLine",value:function(){var e=this.tech_.currentTime(),t=ri.BUFFER_LOW_WATER_LINE,a=ri.BUFFER_LOW_WATER_LINE_RATE,i=Math.max(t,ri.MAX_BUFFER_LOW_WATER_LINE);return Math.min(t+e*a,i)}}]),a}(t.EventTarget),or=function(e,t,a){return function(i){var n=e.master.playlists[t],r=ne(n),s=re(n);return"undefined"==typeof i?s:(i?delete n.disabled:n.disabled=!0,i===s||r||(a(),i?e.trigger("renditionenabled"):e.trigger("renditiondisabled")),i)}},lr=function e(t,a,i){P(this,e);var n=t.masterPlaylistController_,r=t.options_.smoothQualityChange,s=r?"smooth":"fast",d=n[s+"QualityChange_"].bind(n);if(a.attributes.RESOLUTION){var o=a.attributes.RESOLUTION;this.width=o.width,this.height=o.height}this.bandwidth=a.attributes.BANDWIDTH,this.id=i,this.enabled=or(t.playlists,a.uri,d)},ur=function(t){var a=t.playlists;t.representations=function(){return a.master.playlists.filter(function(e){return!ne(e)}).map(function(a){return new lr(t,a,a.uri)})}},pr=["seeking","seeked","pause","playing","error"],mr=function(){function e(t){var a=this;P(this,e),this.tech_=t.tech,this.seekable=t.seekable,this.seekTo=t.seekTo,this.allowSeeksWithinUnsafeLiveWindow=t.allowSeeksWithinUnsafeLiveWindow,this.media=t.media,this.consecutiveUpdates=0,this.lastRecordedTime=null,this.timer_=null,this.checkCurrentTimeTimeout_=null,this.logger_=ii("PlaybackWatcher"),this.logger_("initialize");var i=function(){return a.monitorCurrentTime_()},n=function(){return a.techWaiting_()},r=function(){return a.cancelTimer_()},s=function(){return a.fixesBadSeeks_()};this.tech_.on("seekablechanged",s),this.tech_.on("waiting",n),this.tech_.on(pr,r),this.tech_.on("canplay",i),this.dispose=function(){a.logger_("dispose"),a.tech_.off("seekablechanged",s),a.tech_.off("waiting",n),a.tech_.off(pr,r),a.tech_.off("canplay",i),a.checkCurrentTimeTimeout_&&h.clearTimeout(a.checkCurrentTimeTimeout_),a.cancelTimer_()}}return U(e,[{key:"monitorCurrentTime_",value:function(){this.checkCurrentTime_(),this.checkCurrentTimeTimeout_&&h.clearTimeout(this.checkCurrentTimeTimeout_),this.checkCurrentTimeTimeout_=h.setTimeout(this.monitorCurrentTime_.bind(this),250)}},{key:"checkCurrentTime_",value:function(){if(this.tech_.seeking()&&this.fixesBadSeeks_())return this.consecutiveUpdates=0,void(this.lastRecordedTime=this.tech_.currentTime());if(!(this.tech_.paused()||this.tech_.seeking())){var e=this.tech_.currentTime(),t=this.tech_.buffered();return this.lastRecordedTime===e&&(!t.length||e+Ve>=t.end(t.length-1))?this.techWaiting_():void(5<=this.consecutiveUpdates&&e===this.lastRecordedTime?(this.consecutiveUpdates++,this.waiting_()):e===this.lastRecordedTime?this.consecutiveUpdates++:(this.consecutiveUpdates=0,this.lastRecordedTime=e))}}},{key:"cancelTimer_",value:function(){this.consecutiveUpdates=0,this.timer_&&(this.logger_("cancelTimer_"),clearTimeout(this.timer_)),this.timer_=null}},{key:"fixesBadSeeks_",value:function(){var e=this.tech_.seeking();if(!e)return!1;var t=this.seekable(),a=this.tech_.currentTime(),i=this.afterSeekableWindow_(t,a,this.media(),this.allowSeeksWithinUnsafeLiveWindow),n=void 0;if(i){var r=t.end(t.length-1);n=r}if(this.beforeSeekableWindow_(t,a)){var s=t.start(0);n=s+Ve}return"undefined"!=typeof n&&(this.logger_("Trying to seek outside of seekable at time "+a+" with "+("seekable range "+Ke(t)+". Seeking to ")+(n+".")),this.seekTo(n),!0)}},{key:"waiting_",value:function(){if(!this.techWaiting_()){var e=this.tech_.currentTime(),t=this.tech_.buffered(),a=je(t,e);if(a.length&&e+3<=a.end(0))return this.cancelTimer_(),this.seekTo(e),this.logger_("Stopped at "+e+" while inside a buffered region "+("["+a.start(0)+" -> "+a.end(0)+"]. Attempting to resume playback by seeking to the current time.")),void this.tech_.trigger({type:"usage",name:"hls-unknown-waiting"})}}},{key:"techWaiting_",value:function(){var e=this.seekable(),t=this.tech_.currentTime();if(this.tech_.seeking()&&this.fixesBadSeeks_())return!0;if(this.tech_.seeking()||null!==this.timer_)return!0;if(this.beforeSeekableWindow_(e,t)){var a=e.end(e.length-1);return this.logger_("Fell out of live window at time "+t+". Seeking to "+("live point (seekable end) "+a)),this.cancelTimer_(),this.seekTo(a),this.tech_.trigger({type:"usage",name:"hls-live-resync"}),!0}var i=this.tech_.buffered(),n=Ye(i,t);if(this.videoUnderflow_(n,i,t))return this.cancelTimer_(),this.seekTo(t),this.tech_.trigger({type:"usage",name:"hls-video-underflow"}),!0;if(0<n.length){var r=n.start(0)-t;return this.logger_("Stopped at "+t+", setting timer for "+r+", seeking "+("to "+n.start(0))),this.timer_=setTimeout(this.skipTheGap_.bind(this),1e3*r,t),!0}return!1}},{key:"afterSeekableWindow_",value:function(e,t,a){var i=!!(3<arguments.length&&void 0!==arguments[3])&&arguments[3];if(!e.length)return!1;var n=e.end(e.length-1)+Ve,r=!a.endList;return r&&i&&(n=e.end(e.length-1)+3*a.targetDuration),!!(t>n)}},{key:"beforeSeekableWindow_",value:function(e,t){return!!(e.length&&0<e.start(0)&&t<e.start(0)-Ve)}},{key:"videoUnderflow_",value:function(e,t,a){if(0===e.length){var i=this.gapFromVideoUnderflow_(t,a);if(i)return this.logger_("Encountered a gap in video from "+i.start+" to "+i.end+". "+("Seeking to current time "+a)),!0}return!1}},{key:"skipTheGap_",value:function(e){var t=this.tech_.buffered(),a=this.tech_.currentTime(),i=Ye(t,a);this.cancelTimer_(),0===i.length||a!==e||(this.logger_("skipTheGap_:","currentTime:",a,"scheduled currentTime:",e,"nextRange start:",i.start(0)),this.seekTo(i.start(0)+We),this.tech_.trigger({type:"usage",name:"hls-gap-skip"}))}},{key:"gapFromVideoUnderflow_",value:function(e,t){for(var a=Xe(e),n=0;n<a.length;n++){var r=a.start(n),s=a.end(n);if(4>t-r&&2<t-r)return{start:r,end:s}}return null}}]),e}(),gr={errorInterval:30,getSource:function(e){var t=this.tech({IWillNotUseThisInPlugins:!0}),a=t.currentSource_;return e(a)}},cr=function e(a,i){var n=0,r=0,s=t.mergeOptions(gr,i);a.ready(function(){a.trigger({type:"usage",name:"hls-error-reload-initialized"})});var d=function(){r&&a.currentTime(r)},o=function(e){null===e||void 0===e||(r=a.duration()!==1/0&&a.currentTime()||0,a.one("loadedmetadata",d),a.src(e),a.trigger({type:"usage",name:"hls-error-reload"}),a.play())},l=function(){return Date.now()-n<1e3*s.errorInterval?void a.trigger({type:"usage",name:"hls-error-reload-canceled"}):s.getSource&&"function"==typeof s.getSource?(n=Date.now(),s.getSource.call(a,o)):void t.log.error("ERROR: reloadSourceOnError - The option getSource must be a function!")},u=function e(){a.off("loadedmetadata",d),a.off("error",l),a.off("dispose",e)};a.on("error",l),a.on("dispose",u),a.reloadSourceOnError=function(t){u(),e(a,t)}},yr=function(e){cr(this,e)};t.use("*",function(e){return{setSource:function(e,t){t(null,e)},setCurrentTime:function(t){return e.vhs&&e.currentSource().src===e.vhs.source_.src&&e.vhs.setCurrentTime(t),t},play:function(){e.vhs&&e.currentSource().src===e.vhs.source_.src&&e.vhs.setCurrentTime(e.tech_.currentTime())}}});var fr={PlaylistLoader:W,Playlist:oe,Decrypter:Ie,AsyncStream:ke,decrypt:Le,utils:Ae,STANDARD_PLAYLIST_SELECTOR:function(){return Ci(this.playlists.master,this.systemBandwidth,parseInt(Ei(this.tech_.el(),"width"),10),parseInt(Ei(this.tech_.el(),"height"),10),this.limitRenditionByPlayerDimensions)},INITIAL_PLAYLIST_SELECTOR:function(){var e=this.playlists.master.playlists.filter(oe.isEnabled);Pi(e,function(e,t){return Ui(e,t)});var t=e.filter(function(e){return ct(e.attributes.CODECS).videoCodec});return t[0]||null},comparePlaylistBandwidth:Ui,comparePlaylistResolution:function(e,t){var a=void 0,i=void 0;return e.attributes.RESOLUTION&&e.attributes.RESOLUTION.width&&(a=e.attributes.RESOLUTION.width),a=a||h.Number.MAX_VALUE,t.attributes.RESOLUTION&&t.attributes.RESOLUTION.width&&(i=t.attributes.RESOLUTION.width),i=i||h.Number.MAX_VALUE,a===i&&e.attributes.BANDWIDTH&&t.attributes.BANDWIDTH?e.attributes.BANDWIDTH-t.attributes.BANDWIDTH:a-i},xhr:pe()};["GOAL_BUFFER_LENGTH","MAX_GOAL_BUFFER_LENGTH","GOAL_BUFFER_LENGTH_RATE","BUFFER_LOW_WATER_LINE","MAX_BUFFER_LOW_WATER_LINE","BUFFER_LOW_WATER_LINE_RATE","BANDWIDTH_VARIANCE"].forEach(function(e){Object.defineProperty(fr,e,{get:function(){return t.log.warn("using Hls."+e+" is UNSAFE be sure you know what you are doing"),ri[e]},set:function(a){return t.log.warn("using Hls."+e+" is UNSAFE be sure you know what you are doing"),"number"!=typeof a||0>a?void t.log.warn("value of Hls."+e+" must be greater than or equal to 0"):void(ri[e]=a)}})});var _r=function(e){var t=/^(audio|video|application)\/(x-|vnd\.apple\.)?mpegurl/i;if(t.test(e))return"hls";var a=/^application\/dash\+xml/i;return a.test(e)?"dash":null},hr=function(e,t){for(var a=t.media(),n=-1,r=0;r<e.length;r++)if(e[r].id===a.uri){n=r;break}e.selectedIndex_=n,e.trigger({selectedIndex:n,type:"change"})},br=function(e,t){t.representations().forEach(function(t){e.addQualityLevel(t)}),hr(e,t.playlists)};fr.canPlaySource=function(){return t.log.warn("HLS is no longer a tech. Please remove it from your player's techOrder.")};var Tr=function(e,a,i){if(!e)return e;var n=void 0,r=void 0;if(i.mimeType_)n=a.mimeType_,r=i.mimeType_;else{var s=St(a.mimeType_),d=s.parameters.codecs.split(","),o=void 0,l=void 0;d.forEach(function(e){e=e.trim(),kt(e)?o=e:vt(e)&&(l=e)}),n=s.type+"; codecs=\""+l+"\"",r=s.type.replace("video","audio")+"; codecs=\""+o+"\""}var u={},p=a.playlist_;for(var m in e)u[m]={audioContentType:r,videoContentType:n},p.contentProtection&&p.contentProtection[m]&&p.contentProtection[m].pssh&&(u[m].pssh=p.contentProtection[m].pssh),"string"==typeof e[m]&&(u[m].url=e[m]);return t.mergeOptions(e,u)},Sr=function(e){var a=e.masterPlaylistController_.mainSegmentLoader_,i=e.masterPlaylistController_.audioSegmentLoader_,n=t.players[e.tech_.options_.playerId];if(n.eme){var r=Tr(e.source_.keySystems,a,i);r&&(n.currentSource().keySystems=r,11!==t.browser.IE_VERSION&&n.eme.initializeMediaKeys&&n.eme.initializeMediaKeys())}},kr=function(){if(!window.localStorage)return null;var e=window.localStorage.getItem("videojs-vhs");if(!e)return null;try{return JSON.parse(e)}catch(t){return null}},vr=function(e){if(!window.localStorage)return!1;var a=kr();a=a?t.mergeOptions(a,e):e;try{window.localStorage.setItem("videojs-vhs",JSON.stringify(a))}catch(t){return!1}return a};fr.supportsNativeHls=function(){var e=y.createElement("video");if(!t.getTech("Html5").isSupported())return!1;return["application/vnd.apple.mpegurl","audio/mpegurl","audio/x-mpegurl","application/x-mpegurl","video/x-mpegurl","video/mpegurl","application/mpegurl"].some(function(t){return /maybe|probably/i.test(e.canPlayType(t))})}(),fr.supportsNativeDash=function(){return!!t.getTech("Html5").isSupported()&&/maybe|probably/i.test(y.createElement("video").canPlayType("application/dash+xml"))}(),fr.supportsTypeNatively=function(e){return"hls"===e?fr.supportsNativeHls:!("dash"!==e)&&fr.supportsNativeDash},fr.isSupported=function(){return t.log.warn("HLS is no longer a tech. Please remove it from your player's techOrder.")};var Lr=t.getComponent("Component"),Ir=function(e){function a(e,i,n){P(this,a);var r=R(this,(a.__proto__||Object.getPrototypeOf(a)).call(this,i,n.hls));if(i.options_&&i.options_.playerId){var s=t(i.options_.playerId);s.hasOwnProperty("hls")||Object.defineProperty(s,"hls",{get:function(){return t.log.warn("player.hls is deprecated. Use player.tech().hls instead."),i.trigger({type:"usage",name:"hls-player-access"}),r},configurable:!0}),s.vhs=r,s.dash=r,r.player_=s}if(r.tech_=i,r.source_=e,r.stats={},r.setOptions_(),r.options_.overrideNative&&i.overrideNativeAudioTracks&&i.overrideNativeVideoTracks)i.overrideNativeAudioTracks(!0),i.overrideNativeVideoTracks(!0);else if(r.options_.overrideNative&&(i.featuresNativeVideoTracks||i.featuresNativeAudioTracks))throw new Error("Overriding native HLS requires emulated tracks. See https://git.io/vMpjB");return r.on(y,["fullscreenchange","webkitfullscreenchange","mozfullscreenchange","MSFullscreenChange"],function(){var e=y.fullscreenElement||y.webkitFullscreenElement||y.mozFullScreenElement||y.msFullscreenElement;e&&e.contains(r.tech_.el())&&r.masterPlaylistController_.smoothQualityChange_()}),r.on(r.tech_,"seeking",function(){0===this.tech_.currentTime()&&this.tech_.player_.loop()&&this.setCurrentTime(0)}),r.on(r.tech_,"error",function(){this.masterPlaylistController_&&this.masterPlaylistController_.pauseLoading()}),r.on(r.tech_,"play",r.play),r}return O(a,e),U(a,[{key:"setOptions_",value:function(){var e=this;if(this.options_.withCredentials=this.options_.withCredentials||!1,this.options_.handleManifestRedirects=this.options_.handleManifestRedirects||!1,this.options_.limitRenditionByPlayerDimensions=!1!==this.options_.limitRenditionByPlayerDimensions,this.options_.smoothQualityChange=this.options_.smoothQualityChange||!1,this.options_.useBandwidthFromLocalStorage="undefined"==typeof this.source_.useBandwidthFromLocalStorage?this.options_.useBandwidthFromLocalStorage||!1:this.source_.useBandwidthFromLocalStorage,this.options_.customTagParsers=this.options_.customTagParsers||[],this.options_.customTagMappers=this.options_.customTagMappers||[],this.options_.cacheEncryptionKeys=this.options_.cacheEncryptionKeys||!1,"number"!=typeof this.options_.blacklistDuration&&(this.options_.blacklistDuration=300),"number"!=typeof this.options_.bandwidth&&this.options_.useBandwidthFromLocalStorage){var t=kr();t&&t.bandwidth&&(this.options_.bandwidth=t.bandwidth,this.tech_.trigger({type:"usage",name:"hls-bandwidth-from-local-storage"})),t&&t.throughput&&(this.options_.throughput=t.throughput,this.tech_.trigger({type:"usage",name:"hls-throughput-from-local-storage"}))}"number"!=typeof this.options_.bandwidth&&(this.options_.bandwidth=ri.INITIAL_BANDWIDTH),this.options_.enableLowInitialPlaylist=this.options_.enableLowInitialPlaylist&&this.options_.bandwidth===ri.INITIAL_BANDWIDTH,["withCredentials","limitRenditionByPlayerDimensions","bandwidth","smoothQualityChange","customTagParsers","customTagMappers","handleManifestRedirects","cacheEncryptionKeys"].forEach(function(t){"undefined"!=typeof e.source_[t]&&(e.options_[t]=e.source_[t])}),this.limitRenditionByPlayerDimensions=this.options_.limitRenditionByPlayerDimensions}},{key:"src",value:function(e,a){var i=this;e&&(this.setOptions_(),this.options_.url=this.source_.src,this.options_.tech=this.tech_,this.options_.externHls=fr,this.options_.sourceType=_r(a),this.options_.seekTo=function(e){i.tech_.setCurrentTime(e),i.setCurrentTime(e)},this.masterPlaylistController_=new dr(this.options_),this.playbackWatcher_=new mr(t.mergeOptions(this.options_,{seekable:function(){return i.seekable()},media:function(){return i.masterPlaylistController_.media()}})),this.masterPlaylistController_.on("error",function(){var e=t.players[i.tech_.options_.playerId];e.error(i.masterPlaylistController_.error)}),this.masterPlaylistController_.selectPlaylist=this.selectPlaylist?this.selectPlaylist.bind(this):fr.STANDARD_PLAYLIST_SELECTOR.bind(this),this.masterPlaylistController_.selectInitialPlaylist=fr.INITIAL_PLAYLIST_SELECTOR.bind(this),this.playlists=this.masterPlaylistController_.masterPlaylistLoader_,this.mediaSource=this.masterPlaylistController_.mediaSource,Object.defineProperties(this,{selectPlaylist:{get:function(){return this.masterPlaylistController_.selectPlaylist},set:function(e){this.masterPlaylistController_.selectPlaylist=e.bind(this)}},throughput:{get:function(){return this.masterPlaylistController_.mainSegmentLoader_.throughput.rate},set:function(e){this.masterPlaylistController_.mainSegmentLoader_.throughput.rate=e,this.masterPlaylistController_.mainSegmentLoader_.throughput.count=1}},bandwidth:{get:function(){return this.masterPlaylistController_.mainSegmentLoader_.bandwidth},set:function(e){this.masterPlaylistController_.mainSegmentLoader_.bandwidth=e,this.masterPlaylistController_.mainSegmentLoader_.throughput={rate:0,count:0}}},systemBandwidth:{get:function(){var e=1/(this.bandwidth||1),t=void 0;t=0<this.throughput?1/this.throughput:0;var a=Math.floor(1/(e+t));return a},set:function(){t.log.error("The \"systemBandwidth\" property is read-only")}}}),this.options_.bandwidth&&(this.bandwidth=this.options_.bandwidth),this.options_.throughput&&(this.throughput=this.options_.throughput),Object.defineProperties(this.stats,{bandwidth:{get:function(){return i.bandwidth||0},enumerable:!0},mediaRequests:{get:function(){return i.masterPlaylistController_.mediaRequests_()||0},enumerable:!0},mediaRequestsAborted:{get:function(){return i.masterPlaylistController_.mediaRequestsAborted_()||0},enumerable:!0},mediaRequestsTimedout:{get:function(){return i.masterPlaylistController_.mediaRequestsTimedout_()||0},enumerable:!0},mediaRequestsErrored:{get:function(){return i.masterPlaylistController_.mediaRequestsErrored_()||0},enumerable:!0},mediaTransferDuration:{get:function(){return i.masterPlaylistController_.mediaTransferDuration_()||0},enumerable:!0},mediaBytesTransferred:{get:function(){return i.masterPlaylistController_.mediaBytesTransferred_()||0},enumerable:!0},mediaSecondsLoaded:{get:function(){return i.masterPlaylistController_.mediaSecondsLoaded_()||0},enumerable:!0},buffered:{get:function(){return Je(i.tech_.buffered())},enumerable:!0},currentTime:{get:function(){return i.tech_.currentTime()},enumerable:!0},currentSource:{get:function(){return i.tech_.currentSource_},enumerable:!0},currentTech:{get:function(){return i.tech_.name_},enumerable:!0},duration:{get:function(){return i.tech_.duration()},enumerable:!0},master:{get:function(){return i.playlists.master},enumerable:!0},playerDimensions:{get:function(){return i.tech_.currentDimensions()},enumerable:!0},seekable:{get:function(){return Je(i.tech_.seekable())},enumerable:!0},timestamp:{get:function(){return Date.now()},enumerable:!0},videoPlaybackQuality:{get:function(){return i.tech_.getVideoPlaybackQuality()},enumerable:!0}}),this.tech_.one("canplay",this.masterPlaylistController_.setupFirstPlay.bind(this.masterPlaylistController_)),this.tech_.on("bandwidthupdate",function(){i.options_.useBandwidthFromLocalStorage&&vr({bandwidth:i.bandwidth,throughput:Math.round(i.throughput)})}),this.masterPlaylistController_.on("selectedinitialmedia",function(){ur(i),Sr(i)}),this.on(this.masterPlaylistController_,"progress",function(){this.tech_.trigger("progress")}),this.tech_.ready(function(){return i.setupQualityLevels_()}),this.tech_.el()&&this.tech_.src(t.URL.createObjectURL(this.masterPlaylistController_.mediaSource)))}},{key:"setupQualityLevels_",value:function(){var e=this,a=t.players[this.tech_.options_.playerId];a&&a.qualityLevels&&(this.qualityLevels_=a.qualityLevels(),this.masterPlaylistController_.on("selectedinitialmedia",function(){br(e.qualityLevels_,e)}),this.playlists.on("mediachange",function(){hr(e.qualityLevels_,e.playlists)}))}},{key:"play",value:function(){this.masterPlaylistController_.play()}},{key:"setCurrentTime",value:function(e){this.masterPlaylistController_.setCurrentTime(e)}},{key:"duration",value:function(){return this.masterPlaylistController_.duration()}},{key:"seekable",value:function(){return this.masterPlaylistController_.seekable()}},{key:"dispose",value:function(){this.playbackWatcher_&&this.playbackWatcher_.dispose(),this.masterPlaylistController_&&this.masterPlaylistController_.dispose(),this.qualityLevels_&&this.qualityLevels_.dispose(),this.player_&&(delete this.player_.vhs,delete this.player_.dash,delete this.player_.hls),this.tech_&&this.tech_.hls&&delete this.tech_.hls,C(a.prototype.__proto__||Object.getPrototypeOf(a.prototype),"dispose",this).call(this)}},{key:"convertToProgramTime",value:function(e,t){return Ge({playlist:this.masterPlaylistController_.media(),time:e,callback:t})}},{key:"seekToProgramTime",value:function(e,t){var a=!(2<arguments.length&&void 0!==arguments[2])||arguments[2],i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:2;return He({programTime:e,playlist:this.masterPlaylistController_.media(),retryCount:i,pauseAfterSeek:a,seekTo:this.options_.seekTo,tech:this.options_.tech,callback:t})}}]),a}(Lr),Er={name:"videojs-http-streaming",VERSION:"1.11.2",canHandleSource:function(e){var a=1<arguments.length&&arguments[1]!==void 0?arguments[1]:{},i=t.mergeOptions(t.options,a);return Er.canPlayType(e.type,i)},handleSource:function(e,a){var i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{},n=t.mergeOptions(t.options,i);return a.hls=new Ir(e,a,n),a.hls.xhr=pe(),a.hls.src(e.src,e.type),a.hls},canPlayType:function(e){var a=1<arguments.length&&arguments[1]!==void 0?arguments[1]:{},i=t.mergeOptions(t.options,a),n=i.hls.overrideNative,r=_r(e),s=r&&(!fr.supportsTypeNatively(r)||n);return s?"maybe":""}};("undefined"==typeof t.MediaSource||"undefined"==typeof t.URL)&&(t.MediaSource=Bt,t.URL=Mt),Bt.supportsNativeMediaSources()&&t.getTech("Html5").registerSourceHandler(Er,0),t.HlsHandler=Ir,t.HlsSourceHandler=Er,t.Hls=fr,t.use||t.registerComponent("Hls",fr),t.options.hls=t.options.hls||{},t.registerPlugin?t.registerPlugin("reloadSourceOnError",yr):t.plugin("reloadSourceOnError",yr),e.LOCAL_STORAGE_KEY="videojs-vhs",e.Hls=fr,e.HlsHandler=Ir,e.HlsSourceHandler=Er,e.emeKeySystems=Tr,e.simpleTypeFromSourceType=_r,Object.defineProperty(e,"__esModule",{value:!0})});