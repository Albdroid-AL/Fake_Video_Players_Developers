/**
 * videojs-dvr
 * @version 1.3.3
 * @copyright 2019 ff.fernandez.facundo <ff.fernandez.facundo@gmail.com>
 * @license MIT
 */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("video.js")):"function"==typeof define&&define.amd?define(["video.js"],t):e.videojsDvr=t(e.videojs)}(this,function(a){"use strict";a=a&&a.hasOwnProperty("default")?a.default:a;var e,t="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},r={},n=Object.freeze({default:r}),o=n&&r||n,i=void 0!==t?t:"undefined"!=typeof window?window:{};"undefined"!=typeof document?e=document:(e=i["__GLOBAL_DOCUMENT_CACHE@4"])||(e=i["__GLOBAL_DOCUMENT_CACHE@4"]=o);var d=e,s=(function(){function u(e){this.value=e}function e(o){var i,a;function s(e,t){try{var r=o[e](t),n=r.value;n instanceof u?Promise.resolve(n.value).then(function(e){s("next",e)},function(e){s("throw",e)}):l(r.done?"return":"normal",r.value)}catch(e){l("throw",e)}}function l(e,t){switch(e){case"return":i.resolve({value:t,done:!0});break;case"throw":i.reject(t);break;default:i.resolve({value:t,done:!1})}(i=i.next)?s(i.key,i.arg):a=null}this._invoke=function(n,o){return new Promise(function(e,t){var r={key:n,arg:o,resolve:e,reject:t,next:null};a?a=a.next=r:(i=a=r,s(n,o))})},"function"!=typeof o.return&&(this.return=void 0)}"function"==typeof Symbol&&Symbol.asyncIterator&&(e.prototype[Symbol.asyncIterator]=function(){return this}),e.prototype.next=function(e){return this._invoke("next",e)},e.prototype.throw=function(e){return this._invoke("throw",e)},e.prototype.return=function(e){return this._invoke("return",e)}}(),{startTime:0,timeLive:3600}),l=0,u=s.timeLive,c=a.registerPlugin||a.plugin,h=a.getComponent("Button"),f=a.getComponent("Component"),p=function(e){return e.tech_&&e.tech_.shakaPlayer?e.tech_.shakaPlayer.seekRange():{start:e.seekable().start(0),end:e.seekable().end(0)}},v=function(e,t){var r=p(e);r&&r.end&&(r.end-e.currentTime()<20?e.controlBar.liveButton.addClass("onair"):e.controlBar.liveButton.removeClass("onair"),e.duration(p(e).end-p(e).start),e.getChild("ControlBar").getChild("RemainingTimeDisplay").updateContent(),l||(l=u=p(e).end-p(e).start))},y=function(e){var t=this;e||(e=s),this.on("timeupdate",function(e){v(t)}),this.on("durationchange",function(e){this.duration()===Number.POSITIVE_INFINITY&&v(this)}),this.on("pause",function(e){t.controlBar.liveButton.removeClass("onair")}),this.ready(function(){!function(e,t){e.addClass("vjs-dvr"),e.controlBar.addClass("vjs-dvr-control-bar");var r=e.controlBar.progressControl.seekBar,n=r.getChild("mouseTimeDisplay"),o=r.getChild("playProgressBar"),i=r.getChild("loadProgressBar");r.update=function(){if(this.el_){var e=void 0;e="VolumeBar"===this.name_?this.getPercent():1-(this.player_.duration()-this.player_.currentTime())/u;var t=this.bar;if(t){("number"!=typeof e||e!=e||e<0||e===1/0)&&(e=0),1<e&&(e=1);var r=(100*e).toFixed(2)+"%",n=t.el().style;return 0!==e&&(this.vertical()?n.height=r:n.width=r),e}}},r.update_=function(e,t){var r=this.player_.duration(),n=this.player_.scrubbing()?this.player_.getCache().currentTime:this.player_.currentTime();this.el_.setAttribute("aria-valuenow",(100*t).toFixed(2)),r!==Number.POSITIVE_INFINITY&&this.el_.setAttribute("aria-valuetext","-"+a.formatTime(r-n,r)),this.bar.update(a.dom.getBoundingClientRect(this.el_),t)},r.handleMouseMove=function(e){var t=1-this.calculateDistance(e),r=p(this.player_).end-t*u;r===this.player_.duration()&&(r-=.1),this.player_.currentTime(r),this.update()},n&&(n.update=function(t,r){var n=this;this.rafId_&&this.cancelAnimationFrame(this.rafId_),this.rafId_=this.requestAnimationFrame(function(){var e=a.formatTime(u-r*u,u);n.el_.style.left=t.width*r+"px",0!==r&&n.player_.duration()!==Number.POSITIVE_INFINITY&&n.getChild("timeTooltip").update(t,r,"-"+e)})}),i.update=function(e){var t=this.player_.buffered(),r=this.player_.duration(),n=this.player_.bufferedEnd(),o=this.partEls_,i=function(e,t){var r=e/t||0;return 100*(1<=r?1:r)+"%"};0!==i(n,r)&&(this.el_.style.width=i(n,r));for(var a=0;a<t.length;a++){var s=t.start(a),l=t.end(a),u=o[a];u||(u=this.el_.appendChild(d.createElement("div")),o[a]=u),0!==i(s,n)&&(u.style.left=i(s,n)),0!==i(l-s,n)&&(u.style.width=i(l-s,n))}for(var c=o.length;c>t.length;c--)this.el_.removeChild(o[c-1]);o.length=t.length},o.update=function(r,n){var o=this,i=this.player_.duration();this.rafId_&&this.cancelAnimationFrame(this.rafId_),this.rafId_=this.requestAnimationFrame(function(){var e=o.player_.scrubbing()?o.player_.getCache().currentTime:o.player_.currentTime(),t=a.formatTime(i-e,i);0!==n&&i!==Number.POSITIVE_INFINITY&&o.getChild("timeTooltip").update(r,n,"-"+t)})},e.controlBar.progressControl&&e.controlBar.progressControl.addClass("vjs-dvr-progress-control"),e.controlBar.liveButton=e.controlBar.addChild("liveButton"),e.controlBar.el().insertBefore(e.controlBar.liveButton.el(),e.controlBar.progressControl.el())}(t,a.mergeOptions(s,e))})},m=function(n){function o(e,t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,o);var r=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,n.call(this,e,t));return r.el().innerHTML='<span class="liveCircle"></span><span class="liveText">LIVE</span>',e.paused()||r.addClass("onair"),r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(o,n),o.prototype.buildCSSClass=function(){return"vjs-live-button "+n.prototype.buildCSSClass.call(this)},o.prototype.handleClick=function(e){var t=p(this.player_).end;this.player_.currentTime(t),this.player_.play()},o}(h);return f.registerComponent("LiveButton",m),c("dvr",y),y.VERSION="1.3.3",y});